(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{454:function(a,t,s){"use strict";s.r(t);var n=s(25),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"一、单次计划任务（at）"}},[s("strong",[a._v("一、单次计划任务（at）")])]),a._v(" "),s("h3",{attrs:{id:"_1-1-命令用法"}},[s("strong",[a._v("1.1 命令用法")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("at [选项] [时间]\n")])])]),s("p",[s("img",{attrs:{src:"https://pic2.zhimg.com/v2-941b065435d41096c2732478db7d4f0e_b.jpg",alt:""}})]),a._v(" "),s("p",[a._v("在添加计划任务时，"),s("code",[a._v("at")]),a._v(" 会从标准输入读取任务内容，可以输入多条命令，输入完成后，另起一个空行，按 "),s("code",[a._v("Ctrl+D")]),a._v(" 结束输入。输入的命令会被自动转化为脚本。详情请看下面的例子。")]),a._v(" "),s("ul",[s("li",[a._v("请确保 "),s("code",[a._v("atd")]),a._v(" 服务已经启用，否则计划任务不能执行。")])]),a._v(" "),s("h3",{attrs:{id:"_1-2-常用的时间格式（精确到分钟）"}},[s("strong",[a._v("1.2 常用的时间格式（精确到分钟）")])]),a._v(" "),s("p",[s("strong",[a._v("1.2.1 绝对时间")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("<时>:<分>\n")])])]),s("p",[a._v("或")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("<时>:<分> <年>-<月>-<日>\n")])])]),s("p",[a._v("例")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("12:00\n")])])]),s("p",[a._v("或")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("05:20 2017-05-20\n")])])]),s("p",[s("strong",[a._v("1.2.2 相对时间")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("<绝对时间> +<偏移量> <偏移单位>\n#偏移单位有：minutes, hours, days, weeks\n")])])]),s("p",[a._v("例")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("now +2 hours    #两小时后\n23:00 +30 minutes   #23:00 再过 30 分钟\n")])])]),s("h3",{attrs:{id:"_1-3-举例"}},[s("strong",[a._v("1.3 举例")])]),a._v(" "),s("p",[a._v("添加计划任务")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("[root: ~]# at 08:24\n\nat> sleep 5    \nat> <EOT>   #输入完成后另起一个空行，然后输入 Ctrl+D\n\njob 3 at Tue May 16 08:24:00 2017\n#计划任务被指定为 3 号\n")])])]),s("p",[a._v("查看计划任务")]),a._v(" "),s("p",[a._v("列出所有的计划任务")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("[root: ~]# at -l\n\n3   Tue May 16 08:24:00 2017 a root\n")])])]),s("p",[a._v("查看指定序号计划任务的脚本内容")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("[root: ~]# at -c 3\n\n#!/bin/sh\n# atrun uid=0 gid=0\n# mail root 0\numask 22\n\n... #省略多行\n\n\ncd /root || {\n     echo 'Execution directory inaccessible' >&2\n     exit 1\n}\n${SHELL:-/bin/sh} << 'marcinDELIMITER38168611'\nsleep 5\n\nmarcinDELIMITER38168611\n#真正的任务内容在最后面\n")])])]),s("p",[a._v("删除计划任务")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("[root: ~]# at -d 3\n")])])]),s("p",[a._v("确认是否删除成功")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("[root: ~]# at -c 3\n\nCannot find jobid 3 #不能找到相应编号的计划任务说明成功了\n")])])]),s("h2",{attrs:{id:"二、周期计划任务（crontab）"}},[s("strong",[a._v("二、周期计划任务（crontab）")])]),a._v(" "),s("h3",{attrs:{id:"_2-1-命令用法"}},[s("strong",[a._v("2.1 命令用法")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("crontab [选项]\n")])])]),s("p",[s("img",{attrs:{src:"https://pic3.zhimg.com/v2-68f18644d18ed3b8182830847cc01e2f_b.jpg",alt:""}})]),a._v(" "),s("p",[a._v("如果不加任何选项直接运行 "),s("code",[a._v("crontab")]),a._v("，就会跟上面的 "),s("code",[a._v("at")]),a._v(" 命令一样从标准输入接收配置，但是这会导致已存在的计划任务列表被覆盖，这是非常危险的事情！不推荐使用此方法添加计划任务，除非计划任务列表为空。")]),a._v(" "),s("ul",[s("li",[a._v("请确保 "),s("code",[a._v("crond")]),a._v(" 服务已经启用，否则计划任务不能执行。")])]),a._v(" "),s("p",[a._v("计划任务条目格式")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://pic2.zhimg.com/v2-0cb40a83262738254799b44c62bf43a4_b.jpg",alt:""}})]),a._v(" "),s("p",[a._v("第一列至第五列为时间段，"),s("code",[a._v("*")]),a._v(" 表示所有时间，"),s("code",[a._v("-")]),a._v(" 表示一段连续的时间，"),s("code",[a._v(",")]),a._v(" 表示不连续的时间，"),s("code",[a._v("/")]),a._v(" 表示间隔的时间。")]),a._v(" "),s("p",[a._v("时间格式举例")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://picb.zhimg.com/v2-645f2be172e9148f0515836fc83d4c7d_b.jpg",alt:""}})]),a._v(" "),s("p",[s("strong",[a._v("2.2 举例")])]),a._v(" "),s("p",[a._v("列出计划任务")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("[root: ~]# crontab -l\n\n1   *   *   *   *   python /opt/iredapd/tools/cleanup_db.py >/dev/null  #每小时 01 分执行\n*/30   *   *   *   *   python /opt/iredapd/tools/spf_to_greylist_whitelists.py >/dev/null   #每半小时执行\n1   2   *   *   *   python /var/www/iredadmin/tools/cleanup_amavisd_db.py >/dev/null    #每天 2:01 执行\n1   *   *   *   *   python /var/www/iredadmin/tools/cleanup_db.py >/dev/null 2>&1   #每小时 01 分执行\n2   2   *   *   *   /usr/bin/php /var/www/roundcubemail/bin/cleandb.sh >/dev/null   #每天 2:02 执行\n2   2   *   *   *   /usr/bin/php /var/www/roundcubemail/bin/gc.sh >/dev/null    #每天 2:02 执行\n1   */1   *   *   *   /usr/bin/perl /usr/share/awstats/wwwroot/cgi-bin/awstats.pl -update -config=web >/dev/null    #每小时 01 分执行\n1   */1   *   *   *   /usr/bin/perl /usr/share/awstats/wwwroot/cgi-bin/awstats.pl -update -config=smtp >/dev/null   #每小时 01 分执行\n")])])]),s("p",[a._v("编辑计划任务")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("[root: ~]# crontab -e\n")])])]),s("p",[a._v("执行完该命令之后，系统会打开一个 vi 文本编辑器来编辑计划任务列表，编辑完成之后请记得保存。")]),a._v(" "),s("p",[a._v("如果没有语法错误，系统会给出提示。")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("crontab: installing new crontab\n")])])]),s("p",[a._v("这样计划任务就生效了。")])])}),[],!1,null,null,null);t.default=e.exports}}]);