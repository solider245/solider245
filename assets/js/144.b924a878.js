(window.webpackJsonp=window.webpackJsonp||[]).push([[144],{434:function(e,s,a){"use strict";a.r(s);var t=a(25),n=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("blockquote",[a("p",[e._v("我们可以从Docker Hub上下载官方仓库中的镜像，我自己就下载了ubuntu镜像，只有"),a("code",[e._v("188M")]),e._v("左右，很小巧了。但是看了下，里面的软件源还是官方的，而且没有安装"),a("code",[e._v("vim")]),e._v("，所以就打算自己写一个"),a("code",[e._v("Dockerfile")]),e._v("，用它来构建适合自己的ubuntu基础镜像。")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("deb http://archive.ubuntu.com/ubuntu/ trusty main restricted\ndeb-src http://archive.ubuntu.com/ubuntu/ trusty main restricted\n...................\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("h2",{attrs:{id:"构建上下文"}},[e._v("构建上下文")]),e._v(" "),a("p",[a("code",[e._v("build context")]),e._v("，一个自定义的文件夹，里面放置Dockerfile和一些需要的文件。比如我的：")]),e._v(" "),a("ul",[a("li",[e._v("Dockerfile...这个是必须的")]),e._v(" "),a("li",[e._v("sources.list...自己在官方社区找的"),a("a",{attrs:{href:"http://wiki.ubuntu.org.cn/Template:14.04source",target:"_blank",rel:"noopener noreferrer"}},[e._v("ubuntu14.04"),a("OutboundLink")],1),e._v("的源")]),e._v(" "),a("li",[e._v("vimrc...安装好vim后用到的配置文件。我事先配置好的，都是些基础的配置。")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(".\n├── baseimage\n│   ├── Dockerfile\n│   ├── README.md\n│   ├── sources.list\n│   └── vimrc\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("h2",{attrs:{id:"dokerfile"}},[e._v("Dokerfile")]),e._v(" "),a("p",[e._v("制作image有两种方法：")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("从现有容器通过"),a("code",[e._v("commit")]),e._v("命令创建")]),e._v(" "),a("ul",[a("li",[e._v("dockerfile中不方便的操作可以在容器中操作然后提交")]),e._v(" "),a("li",[e._v("没有批量启动容器的需要")]),e._v(" "),a("li",[e._v("自己学、习练习，不需要移植")])])]),e._v(" "),a("li",[a("p",[e._v("利用Dockerfile构建")]),e._v(" "),a("ul",[a("li",[e._v("方便，灵活，可移植")]),e._v(" "),a("li",[e._v("适合部署大量的镜像和容器")])])])]),e._v(" "),a("h3",{attrs:{id:"dockerfile基础"}},[e._v("Dockerfile基础")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("'#'表示注释，一般Dockerfile第一行注释容器的基本信息和版本。")])]),e._v(" "),a("li",[a("p",[e._v("Dockerfile以"),a("code",[e._v("命令：参数")]),e._v("为基本构建语句，命令全部大写，后面的参数视命令而定")])]),e._v(" "),a("li",[a("p",[e._v("FROM，必须是第一个命令项，表示我的镜像是以哪个镜像为基础构建的")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("FROM ubuntu\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("MAINTAINER，后面接构建这的姓名和邮箱，方便联系")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("MAINTAINER adolphlwq <kenan3015@gmail.com>\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("LABEL，用键值对的方式来指定image的元数据")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('LABEL Description="it is used as a basic image for DuoHuoStudio and my study.I will update and install vim." Vendor="Basic image"\n\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("ADD，在构建时向Docker daemon传递文件")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ADD sources.list /etc/apt/\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("RUN，接操作和命令"),a("code",[e._v("sudo apt-get install -y vim")]),e._v("等")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ADD sources.list /etc/apt/\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("CMD，构建成功的镜像第一次启动时默认启动的命令")]),e._v(" "),a("ul",[a("li",[e._v("CMD只有1条，一般默认在Dockerfile的最后")]),e._v(" "),a("li",[e._v("如果有多个CMD，只有最后一个起作用")]),e._v(" "),a("li",[e._v("CMD会被"),a("code",[e._v("docker run ..")]),e._v("后面的命令覆盖")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('CMD ["/bin/bash"]\n\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("ENV，设置环境变量")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ENV REFRESHED_AT 2015-05-18\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])])]),e._v(" "),a("h3",{attrs:{id:"构建命令"}},[e._v("构建命令")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('cd baseimage(构建上下文文件夹)\ndocker build -t="duohuosrudio/ubuntu:14.04_64_base_image" .\n\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[a("code",[e._v("docker build")]),e._v("中"),a("code",[e._v("-t")]),e._v("表示容器的名字\n"),a("code",[e._v("duohuosrudio/ubuntu")]),e._v("中"),a("code",[e._v("duohuostudio")]),e._v("表示仓库名（不允许大写），"),a("code",[e._v("ubuntu")]),e._v("表示镜像名。\n"),a("code",[e._v("ubuntu:14.04_64_base_image")]),e._v("后的"),a("code",[e._v("14.04_64_base_image")]),e._v("是标签，如果没有指定，默认的是"),a("code",[e._v("latest")])]),e._v(" "),a("p",[e._v("构建过程：")]),e._v(" "),a("p",[a("img",{attrs:{src:"http://7vihfm.com1.z0.glb.clouddn.com/2015-05-19-base-image.gif",alt:""}})]),e._v(" "),a("h3",{attrs:{id:"实践中遇到的错误"}},[e._v("实践中遇到的错误")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("apt-get upgrade")]),e._v("和"),a("code",[e._v("apt-get install vim")]),e._v("都要加上** -y**选项，不然会报错")]),e._v(" "),a("li",[e._v("ADD后面必须接两个参数，"),a("code",[e._v("ADD <src>... <dest>")]),e._v("表示要添加的文件，表示文件添加到哪里。")]),e._v(" "),a("li",[e._v("ADD添加的文件必须以"),a("code",[e._v("构建上下文")]),e._v("为根目录来找，不能超出构建上下文的范围。")])]),e._v(" "),a("p",[e._v("如果除错停止构建了也不要担心，Docker会把构建过程中的文件都缓存起来，再次构建时会从缓存的地方开始，节省时间。")]),e._v(" "),a("p",[e._v("除错停止后"),a("code",[e._v("docker images")]),e._v("会出现一个只有"),a("code",[e._v("IMAGE ID")]),e._v("的镜像，这个就是构建失败后留下的缓存，我们可以通过image id来运行这个镜像，然后执行除错的命令来检查为什么出错！（下图的最后1行）")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("adolph@geek:~/programs/DockerWorkspace/dockerfile/baseimage$ docker images\nREPOSITORY               TAG                   IMAGE ID            CREATED             VIRTUAL SIZE\ntest/ubuntu              14.04_64_base_image   e9390454465c        14 hours ago        269.1 MB\ntest2/ubuntu             14.04_64_base_image   e9390454465c        14 hours ago        269.1 MB\nduohuostudio/ubuntu      14.04_64_base_image   e9390454465c        14 hours ago        269.1 MB\n<none>                   <none>                f6efc4dac25a        16 hours ago        269.1 MB\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("h2",{attrs:{id:"总结"}},[e._v("总结")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('docker build -t="duohuostudio/ubuntu:14.04_64_base_image" .\n\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("这条命令的"),a("strong",[e._v("最后一个参数是用来指定Dockerfile的路径")]),e._v("，千万不要忘记。")]),e._v(" "),a("p",[e._v("dockerfile已经上传到 "),a("a",{attrs:{href:"https://github.com/adolphlwq/DockerfileHub",target:"_blank",rel:"noopener noreferrer"}},[e._v("github 地址"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("镜像也已经上传到"),a("code",[e._v("Docker Hub")]),e._v("上了，可以通过下列命令下载镜像")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("docker pull adolphlwq/ubuntu\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);