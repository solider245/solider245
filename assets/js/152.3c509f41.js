(window.webpackJsonp=window.webpackJsonp||[]).push([[152],{372:function(e,s,n){"use strict";n.r(s);var a=n(25),r=Object(a.a)({},(function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#参考和准则-🔗-reference-and-guidelines"}},[e._v("参考和准则 🔗")])]),n("li",[n("a",{attrs:{href:"#撰写和docker兼容性矩阵-🔗-compose-and-docker-compatibility-matrix"}},[e._v("撰写和Docker兼容性矩阵 🔗")])]),n("li",[n("a",{attrs:{href:"#撰写文件结构和示例-🔗-compose-file-structure-and-examples"}},[e._v("撰写文件结构和示例 🔗")])]),n("li",[n("a",{attrs:{href:"#服务配置参考-🔗-service-configuration-reference"}},[e._v("服务配置参考 🔗")]),n("ul",[n("li",[n("a",{attrs:{href:"#建立-🔗-build"}},[e._v("建立 🔗")]),n("ul",[n("li",[n("a",{attrs:{href:"#语境"}},[e._v("语境")])]),n("li",[n("a",{attrs:{href:"#docker文件"}},[e._v("docker文件")])]),n("li",[n("a",{attrs:{href:"#args"}},[e._v("args")])]),n("li",[n("a",{attrs:{href:"#cache-from"}},[e._v("cache_from")])]),n("li",[n("a",{attrs:{href:"#标签"}},[e._v("标签")])]),n("li",[n("a",{attrs:{href:"#网络"}},[e._v("网络")])]),n("li",[n("a",{attrs:{href:"#shm-size"}},[e._v("shm_size")])]),n("li",[n("a",{attrs:{href:"#目标"}},[e._v("目标")])])])]),n("li",[n("a",{attrs:{href:"#cap-add，-cap-drop🔗-cap-add-cap-drop"}},[e._v("cap_add， cap_drop🔗")])]),n("li",[n("a",{attrs:{href:"#cgroup-parent-🔗-cgroup-parent"}},[e._v("cgroup_parent 🔗")])]),n("li",[n("a",{attrs:{href:"#命令-🔗-command"}},[e._v("命令 🔗")])]),n("li",[n("a",{attrs:{href:"#配置-🔗-configs"}},[e._v("配置 🔗")]),n("ul",[n("li",[n("a",{attrs:{href:"#短语法"}},[e._v("短语法")])]),n("li",[n("a",{attrs:{href:"#长语法"}},[e._v("长语法")])])])]),n("li",[n("a",{attrs:{href:"#container-name-🔗-container-name"}},[e._v("CONTAINER_NAME 🔗")])]),n("li",[n("a",{attrs:{href:"#credential-spec-🔗-credential-spec"}},[e._v("credential_spec 🔗")]),n("ul",[n("li",[n("a",{attrs:{href:"#gmsa配置示例"}},[e._v("gMSA配置示例")])])])]),n("li",[n("a",{attrs:{href:"#取决于-🔗-depends-on"}},[e._v("取决于 _🔗")])]),n("li",[n("a",{attrs:{href:"#部署-🔗-deploy"}},[e._v("部署 🔗")]),n("ul",[n("li",[n("a",{attrs:{href:"#端点模式"}},[e._v("端点模式")])]),n("li",[n("a",{attrs:{href:"#标签"}},[e._v("标签")])]),n("li",[n("a",{attrs:{href:"#模式"}},[e._v("模式")])]),n("li",[n("a",{attrs:{href:"#放置"}},[e._v("放置")])]),n("li",[n("a",{attrs:{href:"#max-replicas-per-node"}},[e._v("max_replicas_per_node")])]),n("li",[n("a",{attrs:{href:"#复制品"}},[e._v("复制品")])]),n("li",[n("a",{attrs:{href:"#资源"}},[e._v("资源")])]),n("li",[n("a",{attrs:{href:"#restart-policy"}},[e._v("restart_policy")])]),n("li",[n("a",{attrs:{href:"#rollback-config"}},[e._v("rollback_config")])]),n("li",[n("a",{attrs:{href:"#update-config"}},[e._v("update_config")])]),n("li",[n("a",{attrs:{href:"#不支持-docker-stack-deploy"}},[e._v("不支持 docker stack deploy")])])])]),n("li",[n("a",{attrs:{href:"#设备-🔗-devices"}},[e._v("设备 🔗")])]),n("li",[n("a",{attrs:{href:"#dns-🔗-dns"}},[e._v("DNS 🔗")])]),n("li",[n("a",{attrs:{href:"#dns-search-🔗-dns-search"}},[e._v("dns_search 🔗")])]),n("li",[n("a",{attrs:{href:"#入口点-🔗-entrypoint"}},[e._v("入口点 🔗")])]),n("li",[n("a",{attrs:{href:"#env-file-🔗-env-file"}},[e._v("env_file 🔗")])]),n("li",[n("a",{attrs:{href:"#环境-🔗-environment"}},[e._v("环境 🔗")])]),n("li",[n("a",{attrs:{href:"#暴露-🔗-expose"}},[e._v("暴露 🔗")])]),n("li",[n("a",{attrs:{href:"#external-links-🔗-external-links"}},[e._v("external_links 🔗")])]),n("li",[n("a",{attrs:{href:"#extra-hosts-🔗-extra-hosts"}},[e._v("extra_hosts 🔗")])]),n("li",[n("a",{attrs:{href:"#健康-检查🔗-healthcheck"}},[e._v("健康 检查🔗")])]),n("li",[n("a",{attrs:{href:"#图片-🔗-image"}},[e._v("图片 🔗")])]),n("li",[n("a",{attrs:{href:"#初始化-🔗-init"}},[e._v("初始化 🔗")])]),n("li",[n("a",{attrs:{href:"#隔离-🔗-isolation"}},[e._v("隔离 🔗")])]),n("li",[n("a",{attrs:{href:"#标签-🔗-labels-2"}},[e._v("标签 🔗")])]),n("li",[n("a",{attrs:{href:"#链接-🔗-links"}},[e._v("链接 🔗")])]),n("li",[n("a",{attrs:{href:"#记录-🔗-logging"}},[e._v("记录 🔗")])]),n("li",[n("a",{attrs:{href:"#network-mode-🔗-network-mode"}},[e._v("network_mode 🔗")])]),n("li",[n("a",{attrs:{href:"#网络-🔗-networks"}},[e._v("网络 🔗")]),n("ul",[n("li",[n("a",{attrs:{href:"#别名"}},[e._v("别名")])]),n("li",[n("a",{attrs:{href:"#ipv4-address，ipv6-address"}},[e._v("ipv4_address，ipv6_address")])])])]),n("li",[n("a",{attrs:{href:"#pid-🔗-pid"}},[e._v("PID 🔗")])]),n("li",[n("a",{attrs:{href:"#港口-🔗-ports"}},[e._v("港口 🔗")]),n("ul",[n("li",[n("a",{attrs:{href:"#短语法"}},[e._v("短语法")])]),n("li",[n("a",{attrs:{href:"#长语法"}},[e._v("长语法")])])])]),n("li",[n("a",{attrs:{href:"#重新启动-🔗-restart"}},[e._v("重新启动 🔗")])]),n("li",[n("a",{attrs:{href:"#秘密-🔗-secrets"}},[e._v("秘密 🔗")]),n("ul",[n("li",[n("a",{attrs:{href:"#短语法"}},[e._v("短语法")])]),n("li",[n("a",{attrs:{href:"#长语法"}},[e._v("长语法")])])])]),n("li",[n("a",{attrs:{href:"#security-opt-🔗-security-opt"}},[e._v("security_opt 🔗")])]),n("li",[n("a",{attrs:{href:"#stop-grace-period-🔗-stop-grace-period"}},[e._v("stop_grace_period 🔗")])]),n("li",[n("a",{attrs:{href:"#stop-signal-🔗-stop-signal"}},[e._v("stop_signal 🔗")])]),n("li",[n("a",{attrs:{href:"#的sysctl-🔗-sysctls"}},[e._v("的sysctl 🔗")])]),n("li",[n("a",{attrs:{href:"#tmpfs的-🔗-tmpfs"}},[e._v("tmpfs的 🔗")])]),n("li",[n("a",{attrs:{href:"#ulimits-🔗-ulimits"}},[e._v("ulimits 🔗")])]),n("li",[n("a",{attrs:{href:"#userns-mode-🔗-userns-mode"}},[e._v("userns_mode 🔗")])]),n("li",[n("a",{attrs:{href:"#卷-🔗-volumes"}},[e._v("卷 🔗")]),n("ul",[n("li",[n("a",{attrs:{href:"#短语法"}},[e._v("短语法")])]),n("li",[n("a",{attrs:{href:"#长语法"}},[e._v("长语法")])]),n("li",[n("a",{attrs:{href:"#服务，群集和堆栈文件的卷"}},[e._v("服务，群集和堆栈文件的卷")])]),n("li",[n("a",{attrs:{href:"#卷装载的缓存选项（适用于mac的docker桌面）"}},[e._v("卷装载的缓存选项（适用于Mac的Docker桌面）")])])])]),n("li",[n("a",{attrs:{href:"#域名，主机名，ipc，mac-address，特权，read-only，shm-size，stdin-open，tty用户，working-dir-🔗-domainname-hostname-ipc-mac-address-privileged-read-only-shm-size-stdin-open-tty-user-working-dir"}},[e._v("域名，主机名，IPC，MAC_ADDRESS，特权，READ_ONLY，shm_size，stdin_open，TTY用户，working_dir 🔗")])])])]),n("li",[n("a",{attrs:{href:"#指定持续时间-🔗-specifying-durations"}},[e._v("指定持续时间 🔗")])]),n("li",[n("a",{attrs:{href:"#指定字节值-🔗-specifying-byte-values"}},[e._v("指定字节值 🔗")])]),n("li",[n("a",{attrs:{href:"#卷配置参考-🔗-volume-configuration-reference"}},[e._v("卷配置参考 🔗")]),n("ul",[n("li",[n("a",{attrs:{href:"#司机-🔗-driver"}},[e._v("司机 🔗")])]),n("li",[n("a",{attrs:{href:"#driver-opts-🔗-driver-opts"}},[e._v("driver_opts 🔗")])]),n("li",[n("a",{attrs:{href:"#外部-🔗-external"}},[e._v("外部 🔗")])]),n("li",[n("a",{attrs:{href:"#标签-🔗-labels-3"}},[e._v("标签 🔗")])]),n("li",[n("a",{attrs:{href:"#命名-🔗-name"}},[e._v("命名 🔗")])])])]),n("li",[n("a",{attrs:{href:"#网络配置参考-🔗-network-configuration-reference"}},[e._v("网络配置参考 🔗")]),n("ul",[n("li",[n("a",{attrs:{href:"#司机-🔗-driver-1"}},[e._v("司机 🔗")]),n("ul",[n("li",[n("a",{attrs:{href:"#桥"}},[e._v("桥")])]),n("li",[n("a",{attrs:{href:"#覆盖"}},[e._v("覆盖")])]),n("li",[n("a",{attrs:{href:"#主机或无"}},[e._v("主机或无")])])])]),n("li",[n("a",{attrs:{href:"#driver-opts-🔗-driver-opts-1"}},[e._v("driver_opts 🔗")])]),n("li",[n("a",{attrs:{href:"#附-🔗-attachable"}},[e._v("附 🔗")])]),n("li",[n("a",{attrs:{href:"#enable-ipv6-🔗-enable-ipv6"}},[e._v("enable_ipv6 🔗")])]),n("li",[n("a",{attrs:{href:"#伊帕姆-🔗-ipam"}},[e._v("伊帕姆 🔗")])]),n("li",[n("a",{attrs:{href:"#内部-🔗-internal"}},[e._v("内部 🔗")])]),n("li",[n("a",{attrs:{href:"#标签-🔗-labels-4"}},[e._v("标签 🔗")])]),n("li",[n("a",{attrs:{href:"#外部-🔗-external-1"}},[e._v("外部 🔗")])]),n("li",[n("a",{attrs:{href:"#命名-🔗-name-1"}},[e._v("命名 🔗")])])])]),n("li",[n("a",{attrs:{href:"#configs配置参考-🔗-configs-configuration-reference"}},[e._v("configs配置参考 🔗")])]),n("li",[n("a",{attrs:{href:"#机密配置参考-🔗-secrets-configuration-reference"}},[e._v("机密配置参考 🔗")]),n("ul",[n("li",[n("a",{attrs:{href:"#撰写文件v3-5及更高版本-🔗-compose-file-v35-and-above"}},[e._v("撰写文件v3.5及更高版本 🔗")])]),n("li",[n("a",{attrs:{href:"#撰写文件v3-4和-🔗下-compose-file-v34-and-under"}},[e._v("撰写文件v3.4和 🔗下")])])])]),n("li",[n("a",{attrs:{href:"#变量替代-🔗-variable-substitution"}},[e._v("变量替代 🔗")])]),n("li",[n("a",{attrs:{href:"#扩展字段-🔗-extension-fields"}},[e._v("扩展字段 🔗")])]),n("li",[n("a",{attrs:{href:"#撰写文档-🔗-compose-documentation"}},[e._v("撰写文档 🔗")])])])]),n("p"),e._v(" "),n("h2",{attrs:{id:"参考和准则-🔗"}},[e._v("参考和准则 "),n("a",{attrs:{href:"#reference-and-guidelines"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("这些主题描述了Compose文件格式的版本3。 这是最新版本。")]),e._v(" "),n("h2",{attrs:{id:"撰写和docker兼容性矩阵-🔗"}},[e._v("撰写和Docker兼容性矩阵 "),n("a",{attrs:{href:"#compose-and-docker-compatibility-matrix"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("有多种版本的Compose文件格式– 1，2，2.x和3.x。 下表是快速浏览。 有关每个版本包括什么以及如何升级的完整详细信息，请参阅 "),n("strong",[n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/",target:"_blank",rel:"noopener noreferrer"}},[e._v("关于版本和升级"),n("OutboundLink")],1)]),e._v(" 。")]),e._v(" "),n("p",[e._v("下表显示了哪些Compose文件版本支持特定的Docker版本。")]),e._v(" "),n("table",[n("thead",[n("tr",[n("th",[n("strong",[e._v("撰写档案格式")])]),e._v(" "),n("th",[n("strong",[e._v("Docker Engine版本")])])])]),e._v(" "),n("tbody",[n("tr",[n("td",[e._v("3.8")]),e._v(" "),n("td",[e._v("19.03.0+")])]),e._v(" "),n("tr",[n("td",[e._v("3.7")]),e._v(" "),n("td",[e._v("18.06.0+")])]),e._v(" "),n("tr",[n("td",[e._v("3.6")]),e._v(" "),n("td",[e._v("18.02.0+")])]),e._v(" "),n("tr",[n("td",[e._v("3.5")]),e._v(" "),n("td",[e._v("17.12.0+")])]),e._v(" "),n("tr",[n("td",[e._v("3.4")]),e._v(" "),n("td",[e._v("17.09.0+")])]),e._v(" "),n("tr",[n("td",[e._v("3.3")]),e._v(" "),n("td",[e._v("17.06.0+")])]),e._v(" "),n("tr",[n("td",[e._v("3.2")]),e._v(" "),n("td",[e._v("17.04.0+")])]),e._v(" "),n("tr",[n("td",[e._v("3.1")]),e._v(" "),n("td",[e._v("1.13.1+")])]),e._v(" "),n("tr",[n("td",[e._v("3.0")]),e._v(" "),n("td",[e._v("1.13.0+")])]),e._v(" "),n("tr",[n("td",[e._v("2.4")]),e._v(" "),n("td",[e._v("17.12.0+")])]),e._v(" "),n("tr",[n("td",[e._v("2.3")]),e._v(" "),n("td",[e._v("17.06.0+")])]),e._v(" "),n("tr",[n("td",[e._v("2.2")]),e._v(" "),n("td",[e._v("1.13.0+")])]),e._v(" "),n("tr",[n("td",[e._v("2.1")]),e._v(" "),n("td",[e._v("1.12.0+")])]),e._v(" "),n("tr",[n("td",[e._v("2.0")]),e._v(" "),n("td",[e._v("1.10.0+")])]),e._v(" "),n("tr",[n("td",[e._v("1.0")]),e._v(" "),n("td",[e._v("1.9.1。+")])])])]),e._v(" "),n("p",[e._v("除了表中显示的Compose文件格式版本外，Compose本身也处于发布计划中，如 "),n("a",{attrs:{href:"https://github.com/docker/compose/releases/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Compose releases中"),n("OutboundLink")],1),e._v(" 所示 ，但是文件格式版本不一定随每个发行版增加。 例如，Compose文件格式3.0最初是在 "),n("a",{attrs:{href:"https://github.com/docker/compose/releases/tag/1.10.0",target:"_blank",rel:"noopener noreferrer"}},[e._v("Compose版本1.10.0中"),n("OutboundLink")],1),e._v(" 引入的 ，并在随后的版本中逐渐版本化。")]),e._v(" "),n("h2",{attrs:{id:"撰写文件结构和示例-🔗"}},[e._v("撰写文件结构和示例 "),n("a",{attrs:{href:"#compose-file-structure-and-examples"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("这是 "),n("a",{attrs:{href:"https://github.com/docker/labs/tree/master/beginner/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker for Beginners实验"),n("OutboundLink")],1),e._v(" 主题中 使用的投票应用程序示例的Compose文件示例，该 主题涉及 "),n("a",{attrs:{href:"https://github.com/docker/labs/blob/master/beginner/chapters/votingapp.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("将应用程序部署到Swarm"),n("OutboundLink")],1),e._v(" ：")]),e._v(" "),n("p",[e._v("示例撰写文件版本3")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('\nversion: "3.8"\nservices:\n\n  redis:\n    image: redis:alpine\n    ports:\n      - "6379"\n    networks:\n      - frontend\n    deploy:\n      replicas: 2\n      update_config:\n        parallelism: 2\n        delay: 10s\n      restart_policy:\n        condition: on-failure\n\n  db:\n    image: postgres:9.4\n    volumes:\n      - db-data:/var/lib/postgresql/data\n    networks:\n      - backend\n    deploy:\n      placement:\n        max_replicas_per_node: 1\n        constraints:\n          - "node.role==manager"\n\n  vote:\n    image: dockersamples/examplevotingapp_vote:before\n    ports:\n      - "5000:80"\n    networks:\n      - frontend\n    depends_on:\n      - redis\n    deploy:\n      replicas: 2\n      update_config:\n        parallelism: 2\n      restart_policy:\n        condition: on-failure\n\n  result:\n    image: dockersamples/examplevotingapp_result:before\n    ports:\n      - "5001:80"\n    networks:\n      - backend\n    depends_on:\n      - db\n    deploy:\n      replicas: 1\n      update_config:\n        parallelism: 2\n        delay: 10s\n      restart_policy:\n        condition: on-failure\n\n  worker:\n    image: dockersamples/examplevotingapp_worker\n    networks:\n      - frontend\n      - backend\n    deploy:\n      mode: replicated\n      replicas: 1\n      labels: [APP=VOTING]\n      restart_policy:\n        condition: on-failure\n        delay: 10s\n        max_attempts: 3\n        window: 120s\n      placement:\n        constraints:\n          - "node.role==manager"\n\n  visualizer:\n    image: dockersamples/visualizer:stable\n    ports:\n      - "8080:8080"\n    stop_grace_period: 1m30s\n    volumes:\n      - "/var/run/docker.sock:/var/run/docker.sock"\n    deploy:\n      placement:\n        constraints:\n          - "node.role==manager"\n\nnetworks:\n  frontend:\n  backend:\n\nvolumes:\n  db-data:\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br"),n("span",{staticClass:"line-number"},[e._v("27")]),n("br"),n("span",{staticClass:"line-number"},[e._v("28")]),n("br"),n("span",{staticClass:"line-number"},[e._v("29")]),n("br"),n("span",{staticClass:"line-number"},[e._v("30")]),n("br"),n("span",{staticClass:"line-number"},[e._v("31")]),n("br"),n("span",{staticClass:"line-number"},[e._v("32")]),n("br"),n("span",{staticClass:"line-number"},[e._v("33")]),n("br"),n("span",{staticClass:"line-number"},[e._v("34")]),n("br"),n("span",{staticClass:"line-number"},[e._v("35")]),n("br"),n("span",{staticClass:"line-number"},[e._v("36")]),n("br"),n("span",{staticClass:"line-number"},[e._v("37")]),n("br"),n("span",{staticClass:"line-number"},[e._v("38")]),n("br"),n("span",{staticClass:"line-number"},[e._v("39")]),n("br"),n("span",{staticClass:"line-number"},[e._v("40")]),n("br"),n("span",{staticClass:"line-number"},[e._v("41")]),n("br"),n("span",{staticClass:"line-number"},[e._v("42")]),n("br"),n("span",{staticClass:"line-number"},[e._v("43")]),n("br"),n("span",{staticClass:"line-number"},[e._v("44")]),n("br"),n("span",{staticClass:"line-number"},[e._v("45")]),n("br"),n("span",{staticClass:"line-number"},[e._v("46")]),n("br"),n("span",{staticClass:"line-number"},[e._v("47")]),n("br"),n("span",{staticClass:"line-number"},[e._v("48")]),n("br"),n("span",{staticClass:"line-number"},[e._v("49")]),n("br"),n("span",{staticClass:"line-number"},[e._v("50")]),n("br"),n("span",{staticClass:"line-number"},[e._v("51")]),n("br"),n("span",{staticClass:"line-number"},[e._v("52")]),n("br"),n("span",{staticClass:"line-number"},[e._v("53")]),n("br"),n("span",{staticClass:"line-number"},[e._v("54")]),n("br"),n("span",{staticClass:"line-number"},[e._v("55")]),n("br"),n("span",{staticClass:"line-number"},[e._v("56")]),n("br"),n("span",{staticClass:"line-number"},[e._v("57")]),n("br"),n("span",{staticClass:"line-number"},[e._v("58")]),n("br"),n("span",{staticClass:"line-number"},[e._v("59")]),n("br"),n("span",{staticClass:"line-number"},[e._v("60")]),n("br"),n("span",{staticClass:"line-number"},[e._v("61")]),n("br"),n("span",{staticClass:"line-number"},[e._v("62")]),n("br"),n("span",{staticClass:"line-number"},[e._v("63")]),n("br"),n("span",{staticClass:"line-number"},[e._v("64")]),n("br"),n("span",{staticClass:"line-number"},[e._v("65")]),n("br"),n("span",{staticClass:"line-number"},[e._v("66")]),n("br"),n("span",{staticClass:"line-number"},[e._v("67")]),n("br"),n("span",{staticClass:"line-number"},[e._v("68")]),n("br"),n("span",{staticClass:"line-number"},[e._v("69")]),n("br"),n("span",{staticClass:"line-number"},[e._v("70")]),n("br"),n("span",{staticClass:"line-number"},[e._v("71")]),n("br"),n("span",{staticClass:"line-number"},[e._v("72")]),n("br"),n("span",{staticClass:"line-number"},[e._v("73")]),n("br"),n("span",{staticClass:"line-number"},[e._v("74")]),n("br"),n("span",{staticClass:"line-number"},[e._v("75")]),n("br"),n("span",{staticClass:"line-number"},[e._v("76")]),n("br"),n("span",{staticClass:"line-number"},[e._v("77")]),n("br"),n("span",{staticClass:"line-number"},[e._v("78")]),n("br"),n("span",{staticClass:"line-number"},[e._v("79")]),n("br"),n("span",{staticClass:"line-number"},[e._v("80")]),n("br"),n("span",{staticClass:"line-number"},[e._v("81")]),n("br"),n("span",{staticClass:"line-number"},[e._v("82")]),n("br"),n("span",{staticClass:"line-number"},[e._v("83")]),n("br"),n("span",{staticClass:"line-number"},[e._v("84")]),n("br"),n("span",{staticClass:"line-number"},[e._v("85")]),n("br"),n("span",{staticClass:"line-number"},[e._v("86")]),n("br"),n("span",{staticClass:"line-number"},[e._v("87")]),n("br"),n("span",{staticClass:"line-number"},[e._v("88")]),n("br"),n("span",{staticClass:"line-number"},[e._v("89")]),n("br"),n("span",{staticClass:"line-number"},[e._v("90")]),n("br"),n("span",{staticClass:"line-number"},[e._v("91")]),n("br"),n("span",{staticClass:"line-number"},[e._v("92")]),n("br"),n("span",{staticClass:"line-number"},[e._v("93")]),n("br"),n("span",{staticClass:"line-number"},[e._v("94")]),n("br"),n("span",{staticClass:"line-number"},[e._v("95")]),n("br"),n("span",{staticClass:"line-number"},[e._v("96")]),n("br"),n("span",{staticClass:"line-number"},[e._v("97")]),n("br"),n("span",{staticClass:"line-number"},[e._v("98")]),n("br")])]),n("p",[e._v("此参考页上的主题按顶级键按字母顺序组织，以反映Compose文件本身的结构。 该配置文件，如在定义部分顶级键 "),n("code",[e._v("build")]),e._v(" ， "),n("code",[e._v("deploy")]),e._v(" ， "),n("code",[e._v("depends_on")]),e._v(" ， "),n("code",[e._v("networks")]),e._v(" ，等等，都列出了支持它们作为子课题的选项。 这映射到 "),n("code",[e._v("<key>: <option>: <value>")]),e._v(" Compose文件 的 缩进结构。")]),e._v(" "),n("h2",{attrs:{id:"服务配置参考-🔗"}},[e._v("服务配置参考 "),n("a",{attrs:{href:"#service-configuration-reference"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("Compose文件是一个 "),n("a",{attrs:{href:"http://yaml.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("YAML"),n("OutboundLink")],1),e._v(" 文件，用于定义 "),n("a",{attrs:{href:"#service-configuration-reference"}},[e._v("服务")]),e._v(" ， "),n("a",{attrs:{href:"#network-configuration-reference"}},[e._v("网络")]),e._v(" 和 "),n("a",{attrs:{href:"#volume-configuration-reference"}},[e._v("卷")]),e._v(" 。 撰写文件的默认路径为 "),n("code",[e._v("./docker-compose.yml")]),e._v(" 。")]),e._v(" "),n("blockquote",[n("p",[n("strong",[e._v("提示")]),e._v(" ：您可以 为此文件 使用a "),n("code",[e._v(".yml")]),e._v(" 或 "),n("code",[e._v(".yaml")]),e._v(" 扩展名。 他们俩都工作。")])]),e._v(" "),n("p",[e._v("服务定义包含应用于该服务启动的每个容器的配置，就像将命令行参数传递给一样 "),n("code",[e._v("docker run")]),e._v(" 。 同样，网络和卷定义类似于 "),n("code",[e._v("docker network create")]),e._v(" 和 "),n("code",[e._v("docker volume create")]),e._v(" 。")]),e._v(" "),n("p",[e._v("如 "),n("code",[e._v("docker run")]),e._v(" ，在Dockerfile指定的选项，如 "),n("code",[e._v("CMD")]),e._v(" ， "),n("code",[e._v("EXPOSE")]),e._v(" ， "),n("code",[e._v("VOLUME")]),e._v(" ， "),n("code",[e._v("ENV")]),e._v(" ，在默认情况下尊重-你不需要再次指定它们 "),n("code",[e._v("docker-compose.yml")]),e._v(" 。")]),e._v(" "),n("p",[e._v("您可以使用类似Bash的 "),n("code",[e._v("${VARIABLE}")]),e._v(" 语法 在配置值中使用环境变量 - 有关完整详细信息， 请参见 "),n("a",{attrs:{href:"#variable-substitution"}},[e._v("变量替换")]),e._v(" 。")]),e._v(" "),n("p",[e._v("本节包含版本3中的服务定义支持的所有配置选项的列表。")]),e._v(" "),n("h3",{attrs:{id:"建立-🔗"}},[e._v("建立 "),n("a",{attrs:{href:"#build"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("在构建时应用的配置选项。")]),e._v(" "),n("p",[n("code",[e._v("build")]),e._v(" 可以指定为包含构建上下文路径的字符串：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  webapp:\n    build: ./dir\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("p",[e._v("或者，作为具有 "),n("a",{attrs:{href:"#context"}},[e._v("上下文")]),e._v(" 和（可选） "),n("a",{attrs:{href:"#dockerfile"}},[e._v("Dockerfile")]),e._v(" 和 "),n("a",{attrs:{href:"#args"}},[e._v("args")]),e._v(" 下指定的路径的对象 ：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  webapp:\n    build:\n      context: ./dir\n      dockerfile: Dockerfile-alternate\n      args:\n        buildno: 1\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br")])]),n("p",[e._v("如果您指定 "),n("code",[e._v("image")]),e._v(" 以及 "),n("code",[e._v("build")]),e._v(" ，则Compose会使用中 指定 的 "),n("code",[e._v("webapp")]),e._v(" 和可选 名称来命名构建的图像 ： "),n("code",[e._v("tag")]),e._v(" "),n("code",[e._v("image")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("build: ./dir\nimage: webapp:tag\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("p",[e._v("这将产生一个名为 "),n("code",[e._v("webapp")]),e._v(" 并标记 为的图像，该图像 "),n("code",[e._v("tag")]),e._v(" 是从构建的 "),n("code",[e._v("./dir")]),e._v(" 。")]),e._v(" "),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在以群集模式部署堆栈"),n("OutboundLink")],1),e._v(" "),n("code",[e._v("build")]),e._v(" 时， "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("将"),n("OutboundLink")],1),e._v(" 忽略 该 选项。 该 "),n("code",[e._v("docker stack")]),e._v(" 命令不会在部署之前生成映像。")])]),e._v(" "),n("h4",{attrs:{id:"语境"}},[e._v("语境")]),e._v(" "),n("p",[e._v("包含Dockerfile的目录的路径，或者git存储库的URL。")]),e._v(" "),n("p",[e._v("当提供的值是相对路径时，它将被解释为相对于Compose文件的位置。 此目录也是发送到Docker守护程序的构建上下文。")]),e._v(" "),n("p",[e._v("Compose用生成的名称构建并标记它，然后使用该图像。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("build:\n  context: ./dir\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("h4",{attrs:{id:"docker文件"}},[e._v("docker文件")]),e._v(" "),n("p",[e._v("备用Dockerfile。")]),e._v(" "),n("p",[e._v("Compose使用替代文件进行构建。 还必须指定一个构建路径。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("build:\n  context: .\n  dockerfile: Dockerfile-alternate\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("h4",{attrs:{id:"args"}},[e._v("args")]),e._v(" "),n("p",[e._v("添加构建参数，这是只能在构建过程中访问的环境变量。")]),e._v(" "),n("p",[e._v("首先，在Dockerfile中指定参数：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('ARG buildno\nARG gitcommithash\n\nRUN echo "Build number: $buildno"\nRUN echo "Based on commit: $gitcommithash"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("然后在 "),n("code",[e._v("build")]),e._v(" 键 下指定参数 。 您可以传递映射或列表：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("build:\n  context: .\n  args:\n    buildno: 1\n    gitcommithash: cdc3b19\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("build:\n  context: .\n  args:\n    - buildno=1\n    - gitcommithash=cdc3b19\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("blockquote",[n("p",[e._v("build-args的范围")]),e._v(" "),n("p",[e._v("在Dockerfile中，如果您 "),n("code",[e._v("ARG")]),e._v(" 在 "),n("code",[e._v("FROM")]),e._v(" 指令 前 指定 ， "),n("code",[e._v("ARG")]),e._v(" 则在下方的构建指令中不可用 "),n("code",[e._v("FROM")]),e._v(" 。 如果您需要一个参数在两个地方都可用，请在 "),n("code",[e._v("FROM")]),e._v(" 说明中 也指定它 。 有关用法的详细信息， 请参阅 文档中 的“ "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#understand-how-arg-and-from-interact",target:"_blank",rel:"noopener noreferrer"}},[e._v("了解ARGS和FROM之间的交互方式”"),n("OutboundLink")],1),e._v(" 部分。")])]),e._v(" "),n("p",[e._v("您可以在指定构建参数时省略该值，在这种情况下，构建时的值就是运行Compose的环境中的值。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("args:\n  - buildno\n  - gitcommithash\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("blockquote",[n("p",[e._v("使用布尔值时的提示")]),e._v(" "),n("p",[e._v("YAML布尔值（ "),n("code",[e._v('"true"')]),e._v(" ， "),n("code",[e._v('"false"')]),e._v(" ， "),n("code",[e._v('"yes"')]),e._v(" ， "),n("code",[e._v('"no"')]),e._v(" ， "),n("code",[e._v('"on"')]),e._v(" ， "),n("code",[e._v('"off"')]),e._v(" ）必须用引号括起来，这样分析器会将它们解释为字符串。")])]),e._v(" "),n("h4",{attrs:{id:"cache-from"}},[e._v("cache_from")]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-32",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.2版"),n("OutboundLink")],1),e._v(" 文件格式添加")])]),e._v(" "),n("p",[e._v("引擎用于缓存解析的图像列表。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("build:\n  context: .\n  cache_from:\n    - alpine:latest\n    - corp/web_app:3.14\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("h4",{attrs:{id:"标签"}},[e._v("标签")]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-33",target:"_blank",rel:"noopener noreferrer"}},[e._v("版本3.3"),n("OutboundLink")],1),e._v(" 文件格式添加")])]),e._v(" "),n("p",[e._v("使用 "),n("a",{attrs:{href:"https://docs.docker.com/config/labels-custom-metadata/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker标签"),n("OutboundLink")],1),e._v(" 将元数据添加到生成的图像中 。 您可以使用数组或字典。")]),e._v(" "),n("p",[e._v("建议您使用反向DNS表示法，以防止标签与其他软件使用的标签冲突。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('build:\n  context: .\n  labels:\n    com.example.description: "Accounting webapp"\n    com.example.department: "Finance"\n    com.example.label-with-empty-value: ""\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('build:\n  context: .\n  labels:\n    - "com.example.description=Accounting webapp"\n    - "com.example.department=Finance"\n    - "com.example.label-with-empty-value"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br")])]),n("h4",{attrs:{id:"网络"}},[e._v("网络")]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-34",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.4版"),n("OutboundLink")],1),e._v(" 文件格式添加")])]),e._v(" "),n("p",[e._v("设置网络容器的连接以 "),n("code",[e._v("RUN")]),e._v(" 在构建过程中 进行 说明。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("build:\n  context: .\n  network: host\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("build:\n  context: .\n  network: custom_network_1\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("p",[e._v("用于 "),n("code",[e._v("none")]),e._v(" 在构建期间禁用联网：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("build:\n  context: .\n  network: none\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("h4",{attrs:{id:"shm-size"}},[e._v("shm_size")]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-35",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.5版"),n("OutboundLink")],1),e._v(" 文件格式添加")])]),e._v(" "),n("p",[e._v("设置 "),n("code",[e._v("/dev/shm")]),e._v(" 此构建容器 的 分区 大小 。 指定为表示字节数的整数值或表示 "),n("a",{attrs:{href:"#specifying-byte-values"}},[e._v("字节值")]),e._v(" 的字符串 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("build:\n  context: .\n  shm_size: '2gb'\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("build:\n  context: .\n  shm_size: 10000000\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("h4",{attrs:{id:"目标"}},[e._v("目标")]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-34",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.4版"),n("OutboundLink")],1),e._v(" 文件格式添加")])]),e._v(" "),n("p",[e._v("建立内定义的指定阶段 "),n("code",[e._v("Dockerfile")]),e._v(" 。 有关 详细信息， 请参见 "),n("a",{attrs:{href:"https://docs.docker.com/develop/develop-images/multistage-build/",target:"_blank",rel:"noopener noreferrer"}},[e._v("多阶段构建文档"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("build:\n  context: .\n  target: prod\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("h3",{attrs:{id:"cap-add，-cap-drop🔗"}},[e._v("cap_add， "),n("a",{attrs:{href:"#cap_add-cap_drop"}},[e._v("cap_drop🔗")])]),e._v(" "),n("p",[e._v("添加或删除容器功能。 请参阅 "),n("code",[e._v("man 7 capabilities")]),e._v(" 以获取完整列表。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("cap_add:\n  - ALL\n\ncap_drop:\n  - NET_ADMIN\n  - SYS_ADMIN\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br")])]),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在群模式下部署堆栈"),n("OutboundLink")],1),e._v(" 时 ， "),n("code",[e._v("cap_add")]),e._v(" 和 "),n("code",[e._v("cap_drop")]),e._v(" 选项将被忽略"),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1)])]),e._v(" "),n("h3",{attrs:{id:"cgroup-parent-🔗"}},[e._v("cgroup_parent "),n("a",{attrs:{href:"#cgroup_parent"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("为容器指定一个可选的父cgroup。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("cgroup_parent: m-executor-abcd\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在集群模式下部署堆栈"),n("OutboundLink")],1),e._v(" "),n("code",[e._v("cgroup_parent")]),e._v(" 时， "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("将"),n("OutboundLink")],1),e._v(" 忽略 该 选项"),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1)])]),e._v(" "),n("h3",{attrs:{id:"命令-🔗"}},[e._v("命令 "),n("a",{attrs:{href:"#command"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("覆盖默认命令。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("command: bundle exec thin -p 3000\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("p",[e._v("该命令也可以是列表，类似于 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#cmd",target:"_blank",rel:"noopener noreferrer"}},[e._v("dockerfile"),n("OutboundLink")],1),e._v(" ：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('command: ["bundle", "exec", "thin", "-p", "3000"]\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("h3",{attrs:{id:"配置-🔗"}},[e._v("配置 "),n("a",{attrs:{href:"#configs"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("使用按服务 "),n("code",[e._v("configs")]),e._v(" 配置 ，按服务授予对配置的访问权限 。 支持两种不同的语法变体。")]),e._v(" "),n("blockquote",[n("p",[n("strong",[e._v("注意")]),e._v(" ：该配置必须已经存在或已 "),n("a",{attrs:{href:"#configs-configuration-reference"}},[e._v("在 "),n("code",[e._v("configs")])]),e._v(" 此堆栈文件 "),n("a",{attrs:{href:"#configs-configuration-reference"}},[e._v("的顶级")]),e._v(" "),n("a",{attrs:{href:"#configs-configuration-reference"}},[e._v("配置")]),e._v(" 中 "),n("a",{attrs:{href:"#configs-configuration-reference"}},[e._v("定义")]),e._v(" ，否则堆栈部署失败。")])]),e._v(" "),n("p",[e._v("有关配置的更多信息，请参见 "),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/configs/",target:"_blank",rel:"noopener noreferrer"}},[e._v("configs"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("h4",{attrs:{id:"短语法"}},[e._v("短语法")]),e._v(" "),n("p",[e._v("简短的语法变体仅指定配置名称。 这将授予容器访问配置的权限，并将其安装在 "),n("code",[e._v("/<config_name>")]),e._v(" 容器内。 源名称和目标安装点都设置为配置名称。")]),e._v(" "),n("p",[e._v("以下示例使用短语法来授予 "),n("code",[e._v("redis")]),e._v(" 服务对 "),n("code",[e._v("my_config")]),e._v(" 和 "),n("code",[e._v("my_other_config")]),e._v(" 配置的 访问权限 。 的值 "),n("code",[e._v("my_config")]),e._v(" 设置为file的内容 "),n("code",[e._v("./my_config.txt")]),e._v(" ，并 "),n("code",[e._v("my_other_config")]),e._v(" 定义为外部资源，这意味着它已经在Docker中定义，可以通过运行 "),n("code",[e._v("docker config create")]),e._v(" 命令或通过其他堆栈部署进行定义。 如果外部配置不存在，则堆栈部署失败并显示 "),n("code",[e._v("config not found")]),e._v(" 错误。")]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-33",target:"_blank",rel:"noopener noreferrer"}},[e._v("版本3.3"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")]),e._v(" "),n("p",[n("code",[e._v("config")]),e._v(" 版本3.3和更高版本的撰写文件格式仅支持定义。")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  redis:\n    image: redis:latest\n    deploy:\n      replicas: 1\n    configs:\n      - my_config\n      - my_other_config\nconfigs:\n  my_config:\n    file: ./my_config.txt\n  my_other_config:\n    external: true\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br")])]),n("h4",{attrs:{id:"长语法"}},[e._v("长语法")]),e._v(" "),n("p",[e._v("长语法提供了在服务的任务容器中如何创建配置的更多粒度。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("source")]),e._v(" ：Docker中存在的配置名称。")]),e._v(" "),n("li",[n("code",[e._v("target")]),e._v(" ：要在服务的任务容器中挂载的文件的路径和名称。 "),n("code",[e._v("/<source>")]),e._v(" 如果未指定 ， 则 默认为 。")]),e._v(" "),n("li",[n("code",[e._v("uid")]),e._v(" 和 "),n("code",[e._v("gid")]),e._v(" ：拥有服务任务容器中已安装的配置文件的数字UID或GID。 "),n("code",[e._v("0")]),e._v(" 如果未指定，则 两者默认都 在Linux上。 Windows不支持。")]),e._v(" "),n("li",[n("code",[e._v("mode")]),e._v(" ：服务的任务容器中装入的文件的权限，以八进制表示法。 例如， "),n("code",[e._v("0444")]),e._v(" 表示世界可读。 默认值为 "),n("code",[e._v("0444")]),e._v(" 。 由于配置文件已挂载在临时文件系统中，因此它们不可写，因此，如果设置可写位，则将其忽略。 可执行位可以设置。 如果您不熟悉UNIX文件权限模式，则可能会发现此 "),n("a",{attrs:{href:"http://permissions-calculator.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("权限计算器"),n("OutboundLink")],1),e._v(" 很有用。")])]),e._v(" "),n("p",[e._v("下面的示例设置的名称 "),n("code",[e._v("my_config")]),e._v(" ，以 "),n("code",[e._v("redis_config")]),e._v(" 在容器内，将模式设定为 "),n("code",[e._v("0440")]),e._v(" （组可读），并且将所述用户和组 "),n("code",[e._v("103")]),e._v(" 。 该 "),n("code",[e._v("redis")]),e._v(" 服务无权访问该 "),n("code",[e._v("my_other_config")]),e._v(" 配置。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("version: \"3.8\"\nservices:\n  redis:\n    image: redis:latest\n    deploy:\n      replicas: 1\n    configs:\n      - source: my_config\n        target: /redis_config\n        uid: '103'\n        gid: '103'\n        mode: 0440\nconfigs:\n  my_config:\n    file: ./my_config.txt\n  my_other_config:\n    external: true\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br")])]),n("p",[e._v("您可以授予服务访问多个配置的权限，并且可以混合长短语法。 定义配置并不意味着授予对它的服务访问权限。")]),e._v(" "),n("h3",{attrs:{id:"container-name-🔗"}},[e._v("CONTAINER_NAME "),n("a",{attrs:{href:"#container_name"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("指定自定义容器名称，而不是生成的默认名称。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("container_name: my-web-container\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("p",[e._v("由于Docker容器名称必须唯一，因此如果您指定了自定义名称，则无法将服务扩展到超过1个容器。 尝试这样做会导致错误。")]),e._v(" "),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在集群模式下部署堆栈"),n("OutboundLink")],1),e._v(" "),n("code",[e._v("container_name")]),e._v(" 时， "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("将"),n("OutboundLink")],1),e._v(" 忽略 该 选项"),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1)])]),e._v(" "),n("h3",{attrs:{id:"credential-spec-🔗"}},[e._v("credential_spec "),n("a",{attrs:{href:"#credential_spec"}},[e._v("🔗")])]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-33",target:"_blank",rel:"noopener noreferrer"}},[e._v("版本3.3"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")]),e._v(" "),n("p",[e._v("该 "),n("code",[e._v("credential_spec")]),e._v(" 选项已在v3.3中添加。 文件格式版本3.8或更高版本支持将组托管服务帐户（gMSA）配置与撰写文件一起使用。")])]),e._v(" "),n("p",[e._v("配置托管服务帐户的凭据规范。 此选项仅用于使用Windows容器的服务。 在 "),n("code",[e._v("credential_spec")]),e._v(" 必须在格式 "),n("code",[e._v("file://<filename>")]),e._v(" 或 "),n("code",[e._v("registry://<value-name>")]),e._v(" 。")]),e._v(" "),n("p",[e._v("使用时 "),n("code",[e._v("file:")]),e._v(" ，引用的文件必须存在于 "),n("code",[e._v("CredentialSpecs")]),e._v(" Docker数据目录 的 子目录中，默认情况下 "),n("code",[e._v("C:\\ProgramData\\Docker\\")]),e._v(" 在Windows上。 以下示例从名为的文件中加载凭据规范 "),n("code",[e._v("C:\\ProgramData\\Docker\\CredentialSpecs\\my-credential-spec.json")]),e._v(" ：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("credential_spec:\n  file: my-credential-spec.json\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("p",[e._v("使用时 "),n("code",[e._v("registry:")]),e._v(" ，将从守护程序主机上的Windows注册表中读取凭据规范。 具有给定名称的注册表值必须位于：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Virtualization\\Containers\\CredentialSpecs\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("p",[e._v("以下示例从 "),n("code",[e._v("my-credential-spec")]),e._v(" 注册表中 命名的值加载凭据规范 ：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("credential_spec:\n  registry: my-credential-spec\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("h4",{attrs:{id:"gmsa配置示例"}},[e._v("gMSA配置示例")]),e._v(" "),n("p",[e._v("为服务配置gMSA凭据规范时，您只需使用即可指定凭据规范 "),n("code",[e._v("config")]),e._v(" ，如以下示例所示：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  myservice:\n    image: myimage:latest\n    credential_spec:\n      config: my_credential_spec\n\nconfigs:\n  my_credentials_spec:\n    file: ./my-credential-spec.json|\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br")])]),n("h3",{attrs:{id:"取决于-🔗"}},[e._v("取决于 "),n("a",{attrs:{href:"#depends_on"}},[e._v("_🔗")])]),e._v(" "),n("p",[e._v("表达服务之间的依赖性。 服务依赖项导致以下行为：")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("docker-compose up")]),e._v(" 以依赖性顺序启动服务。 在以下示例中， "),n("code",[e._v("db")]),e._v(" 和 "),n("code",[e._v("redis")]),e._v(" 在之前启动 "),n("code",[e._v("web")]),e._v(" 。")]),e._v(" "),n("li",[n("code",[e._v("docker-compose up SERVICE")]),e._v(" 自动包含 "),n("code",[e._v("SERVICE")]),e._v(" 的依赖项。 在下面的示例中， "),n("code",[e._v("docker-compose up web")]),e._v(" 还将创建并启动 "),n("code",[e._v("db")]),e._v(" 和 "),n("code",[e._v("redis")]),e._v(" 。")]),e._v(" "),n("li",[n("code",[e._v("docker-compose stop")]),e._v(" 按依赖关系顺序停止服务。 在以下示例中， "),n("code",[e._v("web")]),e._v(" 在 "),n("code",[e._v("db")]),e._v(" 和 之前停止 "),n("code",[e._v("redis")]),e._v(" 。")])]),e._v(" "),n("p",[e._v("简单的例子：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  web:\n    build: .\n    depends_on:\n      - db\n      - redis\n  redis:\n    image: redis\n  db:\n    image: postgres\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br")])]),n("blockquote",[n("p",[e._v("使用时有几件事要注意 "),n("code",[e._v("depends_on")]),e._v(" ：")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("depends_on")]),e._v(" 在启动之前 不等待 "),n("code",[e._v("db")]),e._v(" 并且 "),n("code",[e._v("redis")]),e._v(" “准备就绪” "),n("code",[e._v("web")]),e._v(" -仅 在启动 之前。 如果需要等待服务准备就绪，请参阅 "),n("a",{attrs:{href:"https://docs.docker.com/compose/startup-order/",target:"_blank",rel:"noopener noreferrer"}},[e._v("控制启动顺序以"),n("OutboundLink")],1),e._v(" 获取有关此问题的更多信息以及解决该问题的策略。")]),e._v(" "),n("li",[e._v("版本3不再支持的 "),n("code",[e._v("condition")]),e._v(" 形式 "),n("code",[e._v("depends_on")]),e._v(" 。")]),e._v(" "),n("li",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在以群体模式"),n("OutboundLink")],1),e._v(" 3版本的Compose文件 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("部署堆栈"),n("OutboundLink")],1),e._v(" "),n("code",[e._v("depends_on")]),e._v(" 时， "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("将"),n("OutboundLink")],1),e._v(" 忽略 该 选项 。")])])]),e._v(" "),n("h3",{attrs:{id:"部署-🔗"}},[e._v("部署 "),n("a",{attrs:{href:"#deploy"}},[e._v("🔗")])]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-3",target:"_blank",rel:"noopener noreferrer"}},[e._v("版本3"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")])]),e._v(" "),n("p",[e._v("指定与服务的部署和运行有关的配置。 这只能部署到时生效 "),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/",target:"_blank",rel:"noopener noreferrer"}},[e._v("群"),n("OutboundLink")],1),e._v(" 与 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("泊坞窗堆栈部署"),n("OutboundLink")],1),e._v(" ，并且被忽略 "),n("code",[e._v("docker-compose up")]),e._v(" 和 "),n("code",[e._v("docker-compose run")]),e._v(" 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  redis:\n    image: redis:alpine\n    deploy:\n      replicas: 6\n      placement:\n        max_replicas_per_node: 1\n      update_config:\n        parallelism: 2\n        delay: 10s\n      restart_policy:\n        condition: on-failure\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br")])]),n("p",[e._v("有几个子选项可用：")]),e._v(" "),n("h4",{attrs:{id:"端点模式"}},[e._v("端点模式")]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-32",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.2版"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")])]),e._v(" "),n("p",[e._v("为连接到群集的外部客户端指定服务发现方法。")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("endpoint_mode: vip")]),e._v(" -Docker为服务分配了一个虚拟IP（VIP），该虚拟IP充当客户端访问网络上服务的前端。 Docker在客户端和服务的可用工作程序节点之间路由请求，而无需客户端知道有多少节点正在参与服务或其IP地址或端口。 （这是默认设置。）")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("endpoint_mode: dnsrr")]),e._v(" -DNS轮询（DNSRR）服务发现不使用单个虚拟IP。 Docker设置服务的DNS条目，以便对服务名称的DNS查询返回IP地址列表，并且客户端直接连接到其中之一。 在想要使用自己的负载平衡器或混合Windows和Linux应用程序的情况下，DNS轮询很有用。")])])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\n\nservices:\n  wordpress:\n    image: wordpress\n    ports:\n      - "8080:80"\n    networks:\n      - overlay\n    deploy:\n      mode: replicated\n      replicas: 2\n      endpoint_mode: vip\n\n  mysql:\n    image: mysql\n    volumes:\n       - db-data:/var/lib/mysql/data\n    networks:\n       - overlay\n    deploy:\n      mode: replicated\n      replicas: 2\n      endpoint_mode: dnsrr\n\nvolumes:\n  db-data:\n\nnetworks:\n  overlay:\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br"),n("span",{staticClass:"line-number"},[e._v("27")]),n("br"),n("span",{staticClass:"line-number"},[e._v("28")]),n("br"),n("span",{staticClass:"line-number"},[e._v("29")]),n("br"),n("span",{staticClass:"line-number"},[e._v("30")]),n("br"),n("span",{staticClass:"line-number"},[e._v("31")]),n("br")])]),n("p",[e._v("的选项 "),n("code",[e._v("endpoint_mode")]),e._v(" 还可以在群集模式CLI命令 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/service_create/",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker service create"),n("OutboundLink")],1),e._v(" 上用作标志 。 有关所有swarm相关 "),n("code",[e._v("docker")]),e._v(" 命令 的快速列表 ，请参阅 "),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/#swarm-mode-key-concepts-and-tutorial",target:"_blank",rel:"noopener noreferrer"}},[e._v("Swarm模式CLI命令"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("p",[e._v("要了解有关在群集模式下进行服务发现和联网的更多信息，请参阅在群集模式下 "),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/networking/#configure-service-discovery",target:"_blank",rel:"noopener noreferrer"}},[e._v("配置服务发现"),n("OutboundLink")],1),e._v(" 主题。")]),e._v(" "),n("h4",{attrs:{id:"标签-2"}},[e._v("标签")]),e._v(" "),n("p",[e._v("指定服务标签。 这些标签 "),n("em",[e._v("仅")]),e._v(" 在服务上设置， "),n("em",[e._v("而不")]),e._v(" 在服务的任何容器上设置。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  web:\n    image: web\n    deploy:\n      labels:\n        com.example.description: "This label will appear on the web service"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br")])]),n("p",[e._v("在容器上的标签集代替，使用 "),n("code",[e._v("labels")]),e._v(" 的键外 "),n("code",[e._v("deploy")]),e._v(" ：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  web:\n    image: web\n    labels:\n      com.example.description: "This label will appear on all containers for the web service"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br")])]),n("h4",{attrs:{id:"模式"}},[e._v("模式")]),e._v(" "),n("p",[e._v("任一 "),n("code",[e._v("global")]),e._v(" （正好一个每群节点容器）或 "),n("code",[e._v("replicated")]),e._v(" （容器的指定数量）。 默认值为 "),n("code",[e._v("replicated")]),e._v(" 。 （要了解更多信息，请参阅 "),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/",target:"_blank",rel:"noopener noreferrer"}},[e._v("群集"),n("OutboundLink")],1),e._v(" 主题 中的 "),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/how-swarm-mode-works/services/#replicated-and-global-services",target:"_blank",rel:"noopener noreferrer"}},[e._v("复制服务和全局服务"),n("OutboundLink")],1),e._v(" 。）"),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1)]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  worker:\n    image: dockersamples/examplevotingapp_worker\n    deploy:\n      mode: global\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br")])]),n("h4",{attrs:{id:"放置"}},[e._v("放置")]),e._v(" "),n("p",[e._v("指定约束和首选项的位置。 有关语法以及 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/service_create/#specify-service-constraints---constraint",target:"_blank",rel:"noopener noreferrer"}},[e._v("约束"),n("OutboundLink")],1),e._v(" ， "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/service_create/#specify-service-placement-preferences---placement-pref",target:"_blank",rel:"noopener noreferrer"}},[e._v("首选项的"),n("OutboundLink")],1),e._v(" 可用类型的完整说明 ，以及 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/service_create/#specify-maximum-replicas-per-node---replicas-max-per-node",target:"_blank",rel:"noopener noreferrer"}},[e._v("指定每个节点的最大副本数"),n("OutboundLink")],1),e._v(" ， 请参阅docker服务create文档。"),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/service_create/#specify-maximum-replicas-per-node---replicas-max-per-node",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1)]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  db:\n    image: postgres\n    deploy:\n      placement:\n        constraints:\n          - "node.role==manager"\n          - "engine.labels.operatingsystem==ubuntu 18.04"\n        preferences:\n          - spread: node.labels.zone\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br")])]),n("h4",{attrs:{id:"max-replicas-per-node"}},[e._v("max_replicas_per_node")]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-38",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.8版"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")])]),e._v(" "),n("p",[e._v("如果服务是 "),n("code",[e._v("replicated")]),e._v(" （默认）服务，请 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/service_create/#specify-maximum-replicas-per-node---replicas-max-per-node",target:"_blank",rel:"noopener noreferrer"}},[e._v("限制"),n("OutboundLink")],1),e._v(" 可随时在节点上运行 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/service_create/#specify-maximum-replicas-per-node---replicas-max-per-node",target:"_blank",rel:"noopener noreferrer"}},[e._v("的副本数"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("p",[e._v("当请求的任务多于运行节点时，将 "),n("code",[e._v("no suitable node (max replicas per node limit exceed)")]),e._v(" 引发 错误 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  worker:\n    image: dockersamples/examplevotingapp_worker\n    networks:\n      - frontend\n      - backend\n    deploy:\n      mode: replicated\n      replicas: 6\n      placement:\n        max_replicas_per_node: 1\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br")])]),n("h4",{attrs:{id:"复制品"}},[e._v("复制品")]),e._v(" "),n("p",[e._v("如果服务是 "),n("code",[e._v("replicated")]),e._v(" （默认）服务，请指定在任何给定时间应运行的容器数。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  worker:\n    image: dockersamples/examplevotingapp_worker\n    networks:\n      - frontend\n      - backend\n    deploy:\n      mode: replicated\n      replicas: 6\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br")])]),n("h4",{attrs:{id:"资源"}},[e._v("资源")]),e._v(" "),n("p",[e._v("配置资源约束。")]),e._v(" "),n("blockquote",[n("p",[e._v("更改了撰写文件版本3")]),e._v(" "),n("p",[e._v("该 "),n("code",[e._v("resources")]),e._v(" 部分取代了 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-file-v2/#cpu-and-other-resources",target:"_blank",rel:"noopener noreferrer"}},[e._v("旧的资源约束选项"),n("OutboundLink")],1),e._v(" 在撰写第3版之前的文件（ "),n("code",[e._v("cpu_shares")]),e._v(" ， "),n("code",[e._v("cpu_quota")]),e._v(" ， "),n("code",[e._v("cpuset")]),e._v(" ， "),n("code",[e._v("mem_limit")]),e._v(" ， "),n("code",[e._v("memswap_limit")]),e._v(" ， "),n("code",[e._v("mem_swappiness")]),e._v(" ）。 请参阅 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#upgrading",target:"_blank",rel:"noopener noreferrer"}},[e._v("将版本2.x升级到3.x，"),n("OutboundLink")],1),e._v(" 以了解版本2和版本3的撰写文件格式之间的差异。")])]),e._v(" "),n("p",[e._v("其中每个都是一个值，类似于其 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/service_create/",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker服务create"),n("OutboundLink")],1),e._v(" 对应项。")]),e._v(" "),n("p",[e._v("在此一般示例中， "),n("code",[e._v("redis")]),e._v(" 服务被限制为使用不超过50M的内存和 "),n("code",[e._v("0.50")]),e._v(" （单核的50％）可用的处理时间（CPU），并且具有 保留 "),n("code",[e._v("20M")]),e._v(" 的内存和 "),n("code",[e._v("0.25")]),e._v(" CPU时间（始终可用）。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("version: \"3.8\"\nservices:\n  redis:\n    image: redis:alpine\n    deploy:\n      resources:\n        limits:\n          cpus: '0.50'\n          memory: 50M\n        reservations:\n          cpus: '0.25'\n          memory: 20M\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br")])]),n("p",[e._v("以下主题描述了可用于设置群中服务或容器的资源约束的可用选项。")]),e._v(" "),n("blockquote",[n("p",[e._v("寻找用于在非群模式容器上设置资源的选项吗？")]),e._v(" "),n("p",[e._v("此处描述的选项特定于 "),n("code",[e._v("deploy")]),e._v(" 键和群模式。 如果要在非群集部署中设置资源限制，请使用 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-file-v2/#cpu-and-other-resources",target:"_blank",rel:"noopener noreferrer"}},[e._v("Compose文件格式版本2 CPU，内存和其他资源选项"),n("OutboundLink")],1),e._v(" 。 如果您还有其他问题，请参阅有关GitHub问题 "),n("a",{attrs:{href:"https://github.com/docker/compose/issues/4513",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker / compose / 4513"),n("OutboundLink")],1),e._v(" 的讨论 。")])]),e._v(" "),n("h5",{attrs:{id:"内存不足异常（oome）"}},[e._v("内存不足异常（OOME）")]),e._v(" "),n("p",[e._v("如果您的服务或容器尝试使用的内存超过系统可用的内存，则可能会遇到内存不足异常（OOME），并且容器或Docker守护程序可能会被内核OOM杀手杀死。 为防止这种情况的发生，请确保您的应用程序在具有足够内存的主机上运行，​​请参阅 "),n("a",{attrs:{href:"https://docs.docker.com/config/containers/resource_constraints/#understand-the-risks-of-running-out-of-memory",target:"_blank",rel:"noopener noreferrer"}},[e._v("了解"),n("OutboundLink")],1),e._v(" 内存不足 "),n("a",{attrs:{href:"https://docs.docker.com/config/containers/resource_constraints/#understand-the-risks-of-running-out-of-memory",target:"_blank",rel:"noopener noreferrer"}},[e._v("的风险"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("h4",{attrs:{id:"restart-policy"}},[e._v("restart_policy")]),e._v(" "),n("p",[e._v("配置是否以及如何在退出容器时重新启动容器。 替换 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-file-v2/#orig-resources",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("restart")]),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("condition")]),e._v(" ：其一 "),n("code",[e._v("none")]),e._v(" ， "),n("code",[e._v("on-failure")]),e._v(" 或者 "),n("code",[e._v("any")]),e._v(" （默认值： "),n("code",[e._v("any")]),e._v(" ）。")]),e._v(" "),n("li",[n("code",[e._v("delay")]),e._v(" ：重新启动尝试之间等待的 "),n("a",{attrs:{href:"#specifying-durations"}},[e._v("时间")]),e._v(" ，指定为 "),n("a",{attrs:{href:"#specifying-durations"}},[e._v("持续时间")]),e._v(" （默认值：0）。")]),e._v(" "),n("li",[n("code",[e._v("max_attempts")]),e._v(" ：放弃之前尝试重新启动容器的次数（默认值：永不放弃）。 如果重启未在configure内成功完成 "),n("code",[e._v("window")]),e._v(" ，则此尝试不会计入配置 "),n("code",[e._v("max_attempts")]),e._v(" 值。 例如，如果 "),n("code",[e._v("max_attempts")]),e._v(" 设置为“ 2”，并且第一次尝试重启失败，则可能尝试两次以上重启。")]),e._v(" "),n("li",[n("code",[e._v("window")]),e._v(" ：决定重新启动是否成功之前要等待的 "),n("a",{attrs:{href:"#specifying-durations"}},[e._v("时间")]),e._v(" ，指定为 "),n("a",{attrs:{href:"#specifying-durations"}},[e._v("持续时间")]),e._v(" （默认值：立即决定）。")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  redis:\n    image: redis:alpine\n    deploy:\n      restart_policy:\n        condition: on-failure\n        delay: 5s\n        max_attempts: 3\n        window: 120s\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br")])]),n("h4",{attrs:{id:"rollback-config"}},[e._v("rollback_config")]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-37",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.7版"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")])]),e._v(" "),n("p",[e._v("配置在更新失败的情况下应如何回滚服务。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("parallelism")]),e._v(" ：一次要回滚的容器数。 如果设置为0，则所有容器将同时回滚。")]),e._v(" "),n("li",[n("code",[e._v("delay")]),e._v(" ：每个容器组回滚之间等待的时间（默认为0s）。")]),e._v(" "),n("li",[n("code",[e._v("failure_action")]),e._v(" ：如果回滚失败，该怎么办。 其中一个 "),n("code",[e._v("continue")]),e._v(" 或者 "),n("code",[e._v("pause")]),e._v(" （默认 "),n("code",[e._v("pause")]),e._v(" ）")]),e._v(" "),n("li",[n("code",[e._v("monitor")]),e._v(" ：更新每个任务以监视失败后的持续时间 "),n("code",[e._v("(ns|us|ms|s|m|h)")]),e._v(" （默认为0s）。")]),e._v(" "),n("li",[n("code",[e._v("max_failure_ratio")]),e._v(" ：在回滚期间可以容忍的故障率（默认为0）。")]),e._v(" "),n("li",[n("code",[e._v("order")]),e._v(" ：回滚期间的操作顺序。 其中一个 "),n("code",[e._v("stop-first")]),e._v(" （旧任务，开始新的一个前停止），或者 "),n("code",[e._v("start-first")]),e._v(" （新的任务首先启动，并且正在运行的任务简单地重叠）（默认 "),n("code",[e._v("stop-first")]),e._v(" ）。")])]),e._v(" "),n("h4",{attrs:{id:"update-config"}},[e._v("update_config")]),e._v(" "),n("p",[e._v("配置应如何更新服务。 对于配置滚动更新很有用。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("parallelism")]),e._v(" ：一次更新的容器数。")]),e._v(" "),n("li",[n("code",[e._v("delay")]),e._v(" ：在更新一组容器之间等待的时间。")]),e._v(" "),n("li",[n("code",[e._v("failure_action")]),e._v(" ：如果更新失败，该怎么办。 其中一个 "),n("code",[e._v("continue")]),e._v(" ， "),n("code",[e._v("rollback")]),e._v(" 或者 "),n("code",[e._v("pause")]),e._v(" （默认： "),n("code",[e._v("pause")]),e._v(" ）。")]),e._v(" "),n("li",[n("code",[e._v("monitor")]),e._v(" ：更新每个任务以监视失败后的持续时间 "),n("code",[e._v("(ns|us|ms|s|m|h)")]),e._v(" （默认为0s）。")]),e._v(" "),n("li",[n("code",[e._v("max_failure_ratio")]),e._v(" ：更新期间可以容忍的故障率。")]),e._v(" "),n("li",[n("code",[e._v("order")]),e._v(" ：更新期间的操作顺序。 其中一个 "),n("code",[e._v("stop-first")]),e._v(" （旧任务，开始新的一个前停止），或者 "),n("code",[e._v("start-first")]),e._v(" （新的任务首先启动，并且正在运行的任务简单重叠）（默认 "),n("code",[e._v("stop-first")]),e._v(" ） "),n("strong",[e._v("注")]),e._v(" ：仅支持V3.4及更高版本。")])]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-34",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.4版"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")]),e._v(" "),n("p",[n("code",[e._v("order")]),e._v(" v3.4及更高版本的撰写文件格式仅支持 该 选项。")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  vote:\n    image: dockersamples/examplevotingapp_vote:before\n    depends_on:\n      - redis\n    deploy:\n      replicas: 2\n      update_config:\n        parallelism: 2\n        delay: 10s\n        order: stop-first\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br")])]),n("h4",{attrs:{id:"不支持-docker-stack-deploy"}},[e._v("不支持 "),n("code",[e._v("docker stack deploy")])]),e._v(" "),n("p",[e._v("下面的子选项（支持 "),n("code",[e._v("docker-compose up")]),e._v(" 和 "),n("code",[e._v("docker-compose run")]),e._v(" ）是 "),n("em",[e._v("不支持")]),e._v(" 的 "),n("code",[e._v("docker stack deploy")]),e._v(" 或 "),n("code",[e._v("deploy")]),e._v(" 关键的。")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#build"}},[e._v("建立")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#cgroup_parent"}},[e._v("cgroup_parent")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#container_name"}},[e._v("container_name")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#devices"}},[e._v("设备")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#tmpfs"}},[e._v("tmpfs")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#external_links"}},[e._v("外部链接")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#links"}},[e._v("链接")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#network_mode"}},[e._v("网络模式")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#restart"}},[e._v("重新开始")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#security_opt"}},[e._v("security_opt")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#userns_mode"}},[e._v("userns_mode")])])]),e._v(" "),n("blockquote",[n("p",[e._v("小费")]),e._v(" "),n("p",[e._v("请参阅有关 "),n("a",{attrs:{href:"#volumes-for-services-swarms-and-stack-files"}},[e._v("如何为服务，群集和docker-stack.yml文件配置卷")]),e._v(" 的部分 。 卷 "),n("em",[e._v("是")]),e._v(" 受支持的，但是要与群集和服务一起使用，必须将它们配置为命名卷或与受约束于有权访问必需卷的节点的服务关联。")])]),e._v(" "),n("h3",{attrs:{id:"设备-🔗"}},[e._v("设备 "),n("a",{attrs:{href:"#devices"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("设备映射列表。 使用与 "),n("code",[e._v("--device")]),e._v(" docker client create选项 相同的格式 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('devices:\n  - "/dev/ttyUSB0:/dev/ttyUSB0"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在集群模式下部署堆栈"),n("OutboundLink")],1),e._v(" "),n("code",[e._v("devices")]),e._v(" 时， "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("将"),n("OutboundLink")],1),e._v(" 忽略 该 选项"),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1)])]),e._v(" "),n("h3",{attrs:{id:"dns-🔗"}},[e._v("DNS "),n("a",{attrs:{href:"#dns"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("自定义DNS服务器。 可以是单个值或列表。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("dns: 8.8.8.8\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("dns:\n  - 8.8.8.8\n  - 9.9.9.9\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("h3",{attrs:{id:"dns-search-🔗"}},[e._v("dns_search "),n("a",{attrs:{href:"#dns_search"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("自定义DNS搜索域。 可以是单个值或列表。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("dns_search: example.com\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("dns_search:\n  - dc1.example.com\n  - dc2.example.com\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("h3",{attrs:{id:"入口点-🔗"}},[e._v("入口点 "),n("a",{attrs:{href:"#entrypoint"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("覆盖默认入口点。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("entrypoint: /code/entrypoint.sh\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("p",[e._v("入口点也可以是列表，类似于 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#entrypoint",target:"_blank",rel:"noopener noreferrer"}},[e._v("dockerfile"),n("OutboundLink")],1),e._v(" ：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('entrypoint: ["php", "-d", "memory_limit=-1", "vendor/bin/phpunit"]\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("p",[e._v("设置 "),n("code",[e._v("entrypoint")]),e._v(" 两者都将使用 "),n("code",[e._v("ENTRYPOINT")]),e._v(" Dockerfile指令 覆盖服务映像上 设置的 任何默认入口点 ， "),n("em",[e._v("并")]),e._v(" 清除映像上的任何默认命令-这意味着如果 "),n("code",[e._v("CMD")]),e._v(" Dockerfile中 有 指令，则将其忽略。")])]),e._v(" "),n("h3",{attrs:{id:"env-file-🔗"}},[e._v("env_file "),n("a",{attrs:{href:"#env_file"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("从文件添加环境变量。 可以是单个值或列表。")]),e._v(" "),n("p",[e._v("如果您使用指定了Compose文件 "),n("code",[e._v("docker-compose -f FILE")]),e._v(" ，则in "),n("code",[e._v("env_file")]),e._v(" 的 路径 相对于该文件所在的目录。")]),e._v(" "),n("p",[e._v("在 "),n("a",{attrs:{href:"#environment"}},[e._v("环境")]),e._v(" 部分中 声明的环境变量将 "),n("em",[e._v("覆盖")]),e._v(" 这些值–即使这些值为空或未定义，也是如此。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("env_file: .env\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("env_file:\n  - ./common.env\n  - ./apps/web.env\n  - /opt/runtime_opts.env\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("p",[e._v("Compose期望环境文件中的每一行都采用 "),n("code",[e._v("VAR=VAL")]),e._v(" 格式。 以开头的行 "),n("code",[e._v("#")]),e._v(" 被视为注释，并被忽略。 空行也将被忽略。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("# Set Rails/Rack environment\nRACK_ENV=development\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("p",[e._v("如果您的服务指定了 "),n("a",{attrs:{href:"#build"}},[e._v("构建")]),e._v(" 选项，则 在构建过程 中 "),n("em",[e._v("不会")]),e._v(" 自动显示 环境文件中定义的变量 。 使用的 "),n("a",{attrs:{href:"#args"}},[e._v("args")]),e._v(" 子选项 "),n("code",[e._v("build")]),e._v(" 来定义构建时环境变量。")])]),e._v(" "),n("p",[e._v("的值按 "),n("code",[e._v("VAL")]),e._v(" 原样使用，根本没有修改。 例如，如果该值用引号引起来（通常是shell变量），则引号包含在传递给Compose的值中。")]),e._v(" "),n("p",[e._v("请记住， "),n("em",[e._v("列表中文件的顺序对于确定分配给多次显示的变量的值很重要")]),e._v(" 。 列表中的文件从上到下进行处理。 对于在file中指定并在file中 "),n("code",[e._v("a.env")]),e._v(" 分配了不同值 的相同变量 "),n("code",[e._v("b.env")]),e._v(" ，如果 "),n("code",[e._v("b.env")]),e._v(" 在下面（之后）列出，则来自标准位的值 "),n("code",[e._v("b.env")]),e._v(" 。 例如，在中给出以下声明 "),n("code",[e._v("docker-compose.yml")]),e._v(" ：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("services:\n  some-service:\n    env_file:\n      - a.env\n      - b.env\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("和以下文件：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("# a.env\nVAR=1\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("p",[e._v("和")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("# b.env\nVAR=hello\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("p",[n("code",[e._v("$VAR")]),e._v(" 是 "),n("code",[e._v("hello")]),e._v(" 。")]),e._v(" "),n("h3",{attrs:{id:"环境-🔗"}},[e._v("环境 "),n("a",{attrs:{href:"#environment"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("添加环境变量。 您可以使用数组或字典。 任何布尔值（true，false，yes，no）都需要用引号引起来，以确保YML解析器不会将其转换为True或False。")]),e._v(" "),n("p",[e._v("仅具有键的环境变量在运行Compose的计算机上解析为它们的值，这对于秘密或特定于主机的值很有用。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("environment:\n  RACK_ENV: development\n  SHOW: 'true'\n  SESSION_SECRET:\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("environment:\n  - RACK_ENV=development\n  - SHOW=true\n  - SESSION_SECRET\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("p",[e._v("如果您的服务指定了 "),n("a",{attrs:{href:"#build"}},[e._v("构建")]),e._v(" 选项， "),n("code",[e._v("environment")]),e._v(" 则 在构建过程 中 "),n("em",[e._v("不会")]),e._v(" 自动显示中 定义的变量 。 使用的 "),n("a",{attrs:{href:"#args"}},[e._v("args")]),e._v(" 子选项 "),n("code",[e._v("build")]),e._v(" 来定义构建时环境变量。")])]),e._v(" "),n("h3",{attrs:{id:"暴露-🔗"}},[e._v("暴露 "),n("a",{attrs:{href:"#expose"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("公开端口而不将其发布到主机上-只有链接的服务才能访问它们。 只能指定内部端口。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('expose:\n  - "3000"\n  - "8000"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("h3",{attrs:{id:"external-links-🔗"}},[e._v("external_links "),n("a",{attrs:{href:"#external_links"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("链接到在此范围之外 "),n("code",[e._v("docker-compose.yml")]),e._v(" 甚至在Compose之外 开始的容器 ，特别是对于提供共享或公共服务的容器。 同时指定容器名称和链接别名（ ） 时，请 "),n("code",[e._v("external_links")]),e._v(" 遵循与legacy选项相似的语义 。 "),n("code",[e._v("links")]),e._v(" "),n("code",[e._v("CONTAINER:ALIAS")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("external_links:\n  - redis_1\n  - project_db_1:mysql\n  - project_db_1:postgresql\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("p",[e._v("外部创建的容器必须连接到与链接到它们的服务相同的网络中的至少一个。 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-file-v2#links",target:"_blank",rel:"noopener noreferrer"}},[e._v("链接"),n("OutboundLink")],1),e._v(" 是旧选项。 我们建议 改为 使用 "),n("a",{attrs:{href:"#networks"}},[e._v("网络")]),e._v(" 。")])]),e._v(" "),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在集群模式下部署堆栈"),n("OutboundLink")],1),e._v(" "),n("code",[e._v("external_links")]),e._v(" 时， "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("将"),n("OutboundLink")],1),e._v(" 忽略 该 选项"),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1)])]),e._v(" "),n("h3",{attrs:{id:"extra-hosts-🔗"}},[e._v("extra_hosts "),n("a",{attrs:{href:"#extra_hosts"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("添加主机名映射。 使用与docker client "),n("code",[e._v("--add-host")]),e._v(" 参数 相同的值 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('extra_hosts:\n  - "somehost:162.242.195.82"\n  - "otherhost:50.31.209.229"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("p",[e._v("在 "),n("code",[e._v("/etc/hosts")]),e._v(" 此服务的内部容器中 创建一个具有ip地址和主机名的条目 ，例如：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("162.242.195.82  somehost\n50.31.209.229   otherhost\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("h3",{attrs:{id:"健康-检查🔗"}},[e._v("健康 "),n("a",{attrs:{href:"#healthcheck"}},[e._v("检查🔗")])]),e._v(" "),n("p",[e._v("配置运行的检查以确定该服务的容器是否“健康”。 有关运行 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#healthcheck",target:"_blank",rel:"noopener noreferrer"}},[e._v("状况检查"),n("OutboundLink")],1),e._v(" 如何工作的详细信息， 请参阅文档中的 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#healthcheck",target:"_blank",rel:"noopener noreferrer"}},[e._v("HEALTHCHECK Dockerfile指令"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('healthcheck:\n  test: ["CMD", "curl", "-f", "http://localhost"]\n  interval: 1m30s\n  timeout: 10s\n  retries: 3\n  start_period: 40s\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br")])]),n("p",[n("code",[e._v("interval")]),e._v(" ， "),n("code",[e._v("timeout")]),e._v(" 并 "),n("code",[e._v("start_period")]),e._v(" 指定为 "),n("a",{attrs:{href:"#specifying-durations"}},[e._v("duration")]),e._v(" 。")]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-34",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.4版"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")]),e._v(" "),n("p",[e._v("该 "),n("code",[e._v("start_period")]),e._v(" 选项以文件格式3.4添加。")])]),e._v(" "),n("p",[n("code",[e._v("test")]),e._v(" 必须是字符串或列表。 如果它是一个列表，第一项必须是 "),n("code",[e._v("NONE")]),e._v(" ， "),n("code",[e._v("CMD")]),e._v(" 或 "),n("code",[e._v("CMD-SHELL")]),e._v(" 。 如果是字符串，则等效于指定 "),n("code",[e._v("CMD-SHELL")]),e._v(" 后跟该字符串。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('# Hit the local web app\ntest: ["CMD", "curl", "-f", "http://localhost"]\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("p",[e._v("如上所述，但包裹在中 "),n("code",[e._v("/bin/sh")]),e._v(" 。 以下两种形式是等效的。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('test: ["CMD-SHELL", "curl -f http://localhost || exit 1"]\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("test: curl -f https://localhost || exit 1\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("p",[e._v("要禁用图像设置的任何默认运行状况检查，可以使用 "),n("code",[e._v("disable: true")]),e._v(" 。 这等效于指定 "),n("code",[e._v('test: ["NONE"]')]),e._v(" 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("healthcheck:\n  disable: true\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("h3",{attrs:{id:"图片-🔗"}},[e._v("图片 "),n("a",{attrs:{href:"#image"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("指定用于启动容器的图像。 可以是存储库/标签或部分图像ID。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("image: redis\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("image: ubuntu:18.04\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("image: tutum/influxdb\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("image: example-registry.com:4000/postgresql\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("image: a4bc65fd\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("p",[e._v("如果图像不存在，除非您还指定了 "),n("a",{attrs:{href:"#build"}},[e._v("build")]),e._v(" ，否则Compose会尝试拉出它， 在这种情况下，它将使用指定的选项来构建它并使用指定的标签对其进行标记。")]),e._v(" "),n("h3",{attrs:{id:"初始化-🔗"}},[e._v("初始化 "),n("a",{attrs:{href:"#init"}},[e._v("🔗")])]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-37",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.7版"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")])]),e._v(" "),n("p",[e._v("在容器内运行一个初始化程序，以转发信号并获取进程。 设置此选项可以 "),n("code",[e._v("true")]),e._v(" 为服务启用此功能。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  web:\n    image: alpine:latest\n    init: true\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("blockquote",[n("p",[e._v("使用的默认初始化二进制文件是 "),n("a",{attrs:{href:"https://github.com/krallin/tini",target:"_blank",rel:"noopener noreferrer"}},[e._v("Tini"),n("OutboundLink")],1),e._v(" ，并安装在 "),n("code",[e._v("/usr/libexec/docker-init")]),e._v(" 守护程序主机上。 您可以通过 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("init-path")]),e._v("配置选项"),n("OutboundLink")],1),e._v(" 将守护程序配置为使用自定义init二进制文件 。")])]),e._v(" "),n("h3",{attrs:{id:"隔离-🔗"}},[e._v("隔离 "),n("a",{attrs:{href:"#isolation"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("指定容器的隔离技术。 在Linux上，唯一支持的值是 "),n("code",[e._v("default")]),e._v(" 。 在Windows中，可接受的值是 "),n("code",[e._v("default")]),e._v(" ， "),n("code",[e._v("process")]),e._v(" 和 "),n("code",[e._v("hyperv")]),e._v(" 。 有关详细信息， 请参考 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/run/#specify-isolation-technology-for-container---isolation",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Engine文档"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("h3",{attrs:{id:"标签-🔗"}},[e._v("标签 "),n("a",{attrs:{href:"#labels-2"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("使用 "),n("a",{attrs:{href:"https://docs.docker.com/config/labels-custom-metadata/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker标签"),n("OutboundLink")],1),e._v(" 将元数据添加到容器 。 您可以使用数组或字典。")]),e._v(" "),n("p",[e._v("建议您使用反向DNS表示法，以防止标签与其他软件使用的标签冲突。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('labels:\n  com.example.description: "Accounting webapp"\n  com.example.department: "Finance"\n  com.example.label-with-empty-value: ""\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('labels:\n  - "com.example.description=Accounting webapp"\n  - "com.example.department=Finance"\n  - "com.example.label-with-empty-value"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("h3",{attrs:{id:"链接-🔗"}},[e._v("链接 "),n("a",{attrs:{href:"#links"}},[e._v("🔗")])]),e._v(" "),n("blockquote",[n("p",[n("strong",[e._v("警告")])]),e._v(" "),n("p",[e._v("该 "),n("code",[e._v("--link")]),e._v(" 标志是Docker的遗留功能。 它最终可能会被删除。 除非您绝对需要继续使用它，否则建议您使用 "),n("a",{attrs:{href:"https://docs.docker.com/compose/networking/",target:"_blank",rel:"noopener noreferrer"}},[e._v("用户定义的网络"),n("OutboundLink")],1),e._v(" 来促进两个容器之间的通信，而不要使用 "),n("code",[e._v("--link")]),e._v(" 。")]),e._v(" "),n("p",[e._v("用户定义的网络不支持您可以使用的功能之一 "),n("code",[e._v("--link")]),e._v(" 是在容器之间共享环境变量。 但是，您可以使用其他机制（例如卷）以更可控的方式在容器之间共享环境变量。")])]),e._v(" "),n("p",[e._v("链接到另一个服务中的容器。 指定服务名称和链接别名（ "),n("code",[e._v('"SERVICE:ALIAS"')]),e._v(" ），或者仅指定服务名称。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('web:\n  links:\n    - "db"\n    - "db:database"\n    - "redis"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("链接服务的容器可以通过与别名相同的主机名访问，如果未指定别名，则可以使用服务名。")]),e._v(" "),n("p",[e._v("不需要链接即可使服务进行通信-默认情况下，任何服务都可以使用该服务的名称访问任何其他服务。 （另请参见 "),n("a",{attrs:{href:"https://docs.docker.com/compose/networking/#links",target:"_blank",rel:"noopener noreferrer"}},[e._v("Compose中的Networking中"),n("OutboundLink")],1),e._v(" 的 "),n("a",{attrs:{href:"https://docs.docker.com/compose/networking/#links",target:"_blank",rel:"noopener noreferrer"}},[e._v("Links主题"),n("OutboundLink")],1),e._v(" 。）")]),e._v(" "),n("p",[e._v("链接也以与 "),n("a",{attrs:{href:"#depends_on"}},[e._v("depends_on")]),e._v(" 相同的方式表示服务之间的依赖关系 ，因此它们确定了服务启动的顺序。")]),e._v(" "),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("p",[e._v("如果同时定义链接和 "),n("a",{attrs:{href:"#networks"}},[e._v("网络")]),e._v(" ，则它们之间具有链接的服务必须共享至少一个公共网络才能进行通信。")])]),e._v(" "),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在集群模式下部署堆栈"),n("OutboundLink")],1),e._v(" "),n("code",[e._v("links")]),e._v(" 时， "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("将"),n("OutboundLink")],1),e._v(" 忽略 该 选项"),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1)])]),e._v(" "),n("h3",{attrs:{id:"记录-🔗"}},[e._v("记录 "),n("a",{attrs:{href:"#logging"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("服务的日志记录配置。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('logging:\n  driver: syslog\n  options:\n    syslog-address: "tcp://192.168.0.42:123"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("p",[e._v("该 "),n("code",[e._v("driver")]),e._v(" 名称指定了服务容器的日志记录驱动程序，以及 "),n("code",[e._v("--log-driver")]),e._v(" docker run选项（ "),n("a",{attrs:{href:"https://docs.docker.com/config/containers/logging/configure/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在此处记录"),n("OutboundLink")],1),e._v(" ）。")]),e._v(" "),n("p",[e._v("默认值为json-file。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('driver: "json-file"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('driver: "syslog"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('driver: "none"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("p",[e._v("只有 "),n("code",[e._v("json-file")]),e._v(" 和 "),n("code",[e._v("journald")]),e._v(" 驱动程序才能从 "),n("code",[e._v("docker-compose up")]),e._v(" 和 直接提供日志 "),n("code",[e._v("docker-compose logs")]),e._v(" 。 使用任何其他驱动程序不会打印任何日志。")])]),e._v(" "),n("p",[e._v("使用 "),n("code",[e._v("options")]),e._v(" 键 为日志记录驱动程序指定日志记录选项 ，如的 "),n("code",[e._v("--log-opt")]),e._v(" 选项 "),n("code",[e._v("docker run")]),e._v(" 。")]),e._v(" "),n("p",[e._v("日志记录选项是键值对。 "),n("code",[e._v("syslog")]),e._v(" 选项 示例 ：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('driver: "syslog"\noptions:\n  syslog-address: "tcp://192.168.0.42:123"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("p",[e._v("默认驱动程序 "),n("a",{attrs:{href:"https://docs.docker.com/config/containers/logging/json-file/",target:"_blank",rel:"noopener noreferrer"}},[e._v("json-file"),n("OutboundLink")],1),e._v(" ，具有用于限制所存储日志数量的选项。 为此，请使用键值对以获取最大存储大小和最大文件数：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('options:\n  max-size: "200k"\n  max-file: "10"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("p",[e._v("上面显示的示例将存储日志文件，直到它们达到 "),n("code",[e._v("max-size")]),e._v(" 200kB，然后旋转它们。 单个日志文件的存储量由该 "),n("code",[e._v("max-file")]),e._v(" 值 指定 。 随着日志超过最大限制，将删除较旧的日志文件以允许存储新日志。")]),e._v(" "),n("p",[e._v("这是一个 "),n("code",[e._v("docker-compose.yml")]),e._v(" 限制日志存储 的示例 文件：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  some-service:\n    image: some-service\n    logging:\n      driver: "json-file"\n      options:\n        max-size: "200k"\n        max-file: "10"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br")])]),n("blockquote",[n("p",[e._v("可用的日志记录选项取决于您使用的日志记录驱动程序")]),e._v(" "),n("p",[e._v("上面用于控制日志文件和大小的示例使用特定于 "),n("a",{attrs:{href:"https://docs.docker.com/config/containers/logging/json-file/",target:"_blank",rel:"noopener noreferrer"}},[e._v("json-file driver的"),n("OutboundLink")],1),e._v(" 选项 。 这些特定选项在其他日志记录驱动程序上不可用。 有关受支持的日志记录驱动程序及其选项的完整列表，请参阅 "),n("a",{attrs:{href:"https://docs.docker.com/config/containers/logging/configure/",target:"_blank",rel:"noopener noreferrer"}},[e._v("日志记录驱动程序"),n("OutboundLink")],1),e._v(" 文档。")])]),e._v(" "),n("h3",{attrs:{id:"network-mode-🔗"}},[e._v("network_mode "),n("a",{attrs:{href:"#network_mode"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("网络模式。 使用与docker client "),n("code",[e._v("--network")]),e._v(" 参数 相同的值 ，以及特殊形式 "),n("code",[e._v("service:[service name]")]),e._v(" 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('network_mode: "bridge"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('network_mode: "host"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('network_mode: "none"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('network_mode: "service:[service name]"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('network_mode: "container:[container name/id]"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在集群模式下部署堆栈"),n("OutboundLink")],1),e._v(" 时， "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("将"),n("OutboundLink")],1),e._v(" 忽略此选项 。")]),e._v(" "),n("li",[n("code",[e._v('network_mode: "host"')]),e._v(" 不能与 "),n("a",{attrs:{href:"#links"}},[e._v("链接")]),e._v(" 混合在一起 。")])])]),e._v(" "),n("h3",{attrs:{id:"网络-🔗"}},[e._v("网络 "),n("a",{attrs:{href:"#networks"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("要加入的网络，引用 "),n("a",{attrs:{href:"#network-configuration-reference"}},[e._v("顶级 "),n("code",[e._v("networks")]),e._v(" 密钥")]),e._v(" 下的条目 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("services:\n  some-service:\n    networks:\n     - some-network\n     - other-network\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("h4",{attrs:{id:"别名"}},[e._v("别名")]),e._v(" "),n("p",[e._v("网络上此服务的别名（备用主机名）。 同一网络上的其他容器可以使用服务名称或此别名来连接到服务的容器之一。")]),e._v(" "),n("p",[e._v("由于 "),n("code",[e._v("aliases")]),e._v(" 是网络范围的，因此同一服务在不同的网络上可以具有不同的别名。")]),e._v(" "),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("p",[e._v("网络范围内的别名可以由多个容器甚至多个服务共享。 如果是这样，则不能保证名称解析到哪个容器。")])]),e._v(" "),n("p",[e._v("一般格式如下所示。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("services:\n  some-service:\n    networks:\n      some-network:\n        aliases:\n          - alias1\n          - alias3\n      other-network:\n        aliases:\n          - alias2\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br")])]),n("p",[e._v("在下面的例子中，提供了三种服务（ "),n("code",[e._v("web")]),e._v(" ， "),n("code",[e._v("worker")]),e._v(" ，和 "),n("code",[e._v("db")]),e._v(" ），其中两个网络（沿 "),n("code",[e._v("new")]),e._v(" 和 "),n("code",[e._v("legacy")]),e._v(" ）。 该 "),n("code",[e._v("db")]),e._v(" 服务是在到达的主机名 "),n("code",[e._v("db")]),e._v(" 或 "),n("code",[e._v("database")]),e._v(" 上 "),n("code",[e._v("new")]),e._v(" 网络，并 "),n("code",[e._v("db")]),e._v(" 或 "),n("code",[e._v("mysql")]),e._v(" 将上 "),n("code",[e._v("legacy")]),e._v(" 网络。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\n\nservices:\n  web:\n    image: "nginx:alpine"\n    networks:\n      - new\n\n  worker:\n    image: "my-worker-image:latest"\n    networks:\n      - legacy\n\n  db:\n    image: mysql\n    networks:\n      new:\n        aliases:\n          - database\n      legacy:\n        aliases:\n          - mysql\n\nnetworks:\n  new:\n  legacy:\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br"),n("span",{staticClass:"line-number"},[e._v("27")]),n("br")])]),n("h4",{attrs:{id:"ipv4-address，ipv6-address"}},[e._v("ipv4_address，ipv6_address")]),e._v(" "),n("p",[e._v("加入网络后，为此服务的容器指定一个静态IP地址。")]),e._v(" "),n("p",[n("a",{attrs:{href:"#network-configuration-reference"}},[e._v("顶级网络部分中")]),e._v(" 的相应网络配置 必须具有一个 "),n("code",[e._v("ipam")]),e._v(" 块，其中子网配置覆盖每个静态地址。")]),e._v(" "),n("blockquote",[n("p",[e._v("如果需要IPv6寻址，则 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-file-v2/#enable_ipv6",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("enable_ipv6")]),n("OutboundLink")],1),e._v(" 必须设置 该 选项，并且必须使用 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-file-v2/#ipv4_address-ipv6_address",target:"_blank",rel:"noopener noreferrer"}},[e._v("2.x版本的Compose文件"),n("OutboundLink")],1),e._v(" 。 "),n("em",[e._v("IPv6选项当前在群集模式下不起作用")]),e._v(" 。")])]),e._v(" "),n("p",[e._v("一个例子：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\n\nservices:\n  app:\n    image: nginx:alpine\n    networks:\n      app_net:\n        ipv4_address: 172.16.238.10\n        ipv6_address: 2001:3984:3989::10\n\nnetworks:\n  app_net:\n    ipam:\n      driver: default\n      config:\n        - subnet: "172.16.238.0/24"\n        - subnet: "2001:3984:3989::/64"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br")])]),n("h3",{attrs:{id:"pid-🔗"}},[e._v("PID "),n("a",{attrs:{href:"#pid"}},[e._v("🔗")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('pid: "host"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("p",[e._v("将PID模式设置为主机PID模式。 这将打开容器和主机操作系统之间的PID地址空间共享。 使用此标志启动的容器可以访问和操作裸机名称空间中的其他容器，反之亦然。")]),e._v(" "),n("h3",{attrs:{id:"港口-🔗"}},[e._v("港口 "),n("a",{attrs:{href:"#ports"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("露出端口。")]),e._v(" "),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("p",[e._v("端口映射与 "),n("code",[e._v("network_mode: host")])])]),e._v(" "),n("h4",{attrs:{id:"短语法-2"}},[e._v("短语法")]),e._v(" "),n("p",[e._v("要么指定两个端口（ "),n("code",[e._v("HOST:CONTAINER")]),e._v(" ），要么仅指定容器端口（选择了临时主机端口）。")]),e._v(" "),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("p",[e._v("当以该 "),n("code",[e._v("HOST:CONTAINER")]),e._v(" 格式 映射端口 时，使用低于60的容器端口可能会遇到错误的结果，因为YAML会将格式 "),n("code",[e._v("xx:yy")]),e._v(" 中的 数字解析 为以60为底的值。 因此，我们建议始终将端口映射显式指定为字符串。")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('ports:\n  - "3000"\n  - "3000-3005"\n  - "8000:8000"\n  - "9090-9091:8080-8081"\n  - "49100:22"\n  - "127.0.0.1:8001:8001"\n  - "127.0.0.1:5000-5010:5000-5010"\n  - "6060:6060/udp"\n  - "12400-12500:1240"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br")])]),n("h4",{attrs:{id:"长语法-2"}},[e._v("长语法")]),e._v(" "),n("p",[e._v("长格式语法允许配置其他不能以短格式表示的字段。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("target")]),e._v(" ：容器内的端口")]),e._v(" "),n("li",[n("code",[e._v("published")]),e._v(" ：公开暴露的港口")]),e._v(" "),n("li",[n("code",[e._v("protocol")]),e._v(" ：端口协议（ "),n("code",[e._v("tcp")]),e._v(" 或 "),n("code",[e._v("udp")]),e._v(" ）")]),e._v(" "),n("li",[n("code",[e._v("mode")]),e._v(" ： "),n("code",[e._v("host")]),e._v(" 用于在每个节点上发布主机端口，或 "),n("code",[e._v("ingress")]),e._v(" 使群集模式端口达到负载平衡。")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("ports:\n  - target: 80\n    published: 8080\n    protocol: tcp\n    mode: host\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-32",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.2版"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")]),e._v(" "),n("p",[e._v("长语法是v3.2文件格式的新语法。")])]),e._v(" "),n("h3",{attrs:{id:"重新启动-🔗"}},[e._v("重新启动 "),n("a",{attrs:{href:"#restart"}},[e._v("🔗")])]),e._v(" "),n("p",[n("code",[e._v("no")]),e._v(" 是默认的 "),n("a",{attrs:{href:"https://docs.docker.com/config/containers/start-containers-automatically/#use-a-restart-policy",target:"_blank",rel:"noopener noreferrer"}},[e._v("重新启动策略"),n("OutboundLink")],1),e._v(" ，在任何情况下都不会重新启动容器。 当 "),n("code",[e._v("always")]),e._v(" 指定时，容器总是重新启动。 该 "),n("code",[e._v("on-failure")]),e._v(" 如果退出代码指示的故障错误政策重启的容器。 "),n("code",[e._v("unless-stopped")]),e._v(" 总是重新启动容器，除非容器停止（手动或其他方式）。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('restart: "no"\nrestart: always\nrestart: on-failure\nrestart: unless-stopped\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在以群集模式部署堆栈"),n("OutboundLink")],1),e._v(" "),n("code",[e._v("restart")]),e._v(" 时， "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("将"),n("OutboundLink")],1),e._v(" 忽略 该 选项 。")])]),e._v(" "),n("h3",{attrs:{id:"秘密-🔗"}},[e._v("秘密 "),n("a",{attrs:{href:"#secrets"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("使用按服务 "),n("code",[e._v("secrets")]),e._v(" 配置 ，按服务授予对机密的访问权限 。 支持两种不同的语法变体。")]),e._v(" "),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[e._v("该密码必须已经存在或 在撰写文件 "),n("a",{attrs:{href:"#secrets-configuration-reference"}},[e._v("的顶级 "),n("code",[e._v("secrets")]),e._v(" 配置")]),e._v(" 中 "),n("a",{attrs:{href:"#secrets-configuration-reference"}},[e._v("定义")]),e._v(" ，否则堆栈部署将失败。")])]),e._v(" "),n("p",[e._v("有关机密的更多信息，请参见 "),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/secrets/",target:"_blank",rel:"noopener noreferrer"}},[e._v("机密"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("h4",{attrs:{id:"短语法-3"}},[e._v("短语法")]),e._v(" "),n("p",[e._v("简短的语法变体仅指定秘密名称。 这会授予容器访问机密的权限，并将其安装在 "),n("code",[e._v("/run/secrets/<secret_name>")]),e._v(" 容器内。 源名称和目标安装点都设置为机密名称。")]),e._v(" "),n("p",[e._v("以下示例使用short语法授予 "),n("code",[e._v("redis")]),e._v(" 服务对 "),n("code",[e._v("my_secret")]),e._v(" 和 "),n("code",[e._v("my_other_secret")]),e._v(" 秘密的 访问权限 。 的值 "),n("code",[e._v("my_secret")]),e._v(" 设置为file的内容 "),n("code",[e._v("./my_secret.txt")]),e._v(" ，并 "),n("code",[e._v("my_other_secret")]),e._v(" 定义为外部资源，这意味着它已经在Docker中定义，可以通过运行 "),n("code",[e._v("docker secret create")]),e._v(" 命令或通过其他堆栈部署进行定义。 如果外部机密不存在，则堆栈部署将失败并显示 "),n("code",[e._v("secret not found")]),e._v(" 错误。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  redis:\n    image: redis:latest\n    deploy:\n      replicas: 1\n    secrets:\n      - my_secret\n      - my_other_secret\nsecrets:\n  my_secret:\n    file: ./my_secret.txt\n  my_other_secret:\n    external: true\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br")])]),n("h4",{attrs:{id:"长语法-3"}},[e._v("长语法")]),e._v(" "),n("p",[e._v("长语法提供了在服务的任务容器中如何创建机密的更多粒度。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("source")]),e._v(" ：秘密的名称，因为它存在于Docker中。")]),e._v(" "),n("li",[n("code",[e._v("target")]),e._v(" ：要 "),n("code",[e._v("/run/secrets/")]),e._v(" 在服务的任务容器中 挂载的文件的名称 。 "),n("code",[e._v("source")]),e._v(" 如果未指定 ， 则 默认为 。")]),e._v(" "),n("li",[n("code",[e._v("uid")]),e._v(" 和 "),n("code",[e._v("gid")]),e._v(" ： "),n("code",[e._v("/run/secrets/")]),e._v(" 在服务的任务容器 中拥有文件的数字UID或GID 。 "),n("code",[e._v("0")]),e._v(" 如果未指定 ， 则 两者都默认为 。")]),e._v(" "),n("li",[n("code",[e._v("mode")]),e._v(" ：文件的权限以 "),n("code",[e._v("/run/secrets/")]),e._v(" 八进制表示法 装入 服务的任务容器中。 例如， "),n("code",[e._v("0444")]),e._v(" 表示世界可读。 Docker 1.13.1中的默认值为 "),n("code",[e._v("0000")]),e._v(" ，但是是 "),n("code",[e._v("0444")]),e._v(" 较新的版本。 机密信息不可写，因为它们已安装在临时文件系统中，因此，如果设置了可写位，它将被忽略。 可执行位可以设置。 如果您不熟悉UNIX文件权限模式，则可能会发现此 "),n("a",{attrs:{href:"http://permissions-calculator.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("权限计算器"),n("OutboundLink")],1),e._v(" 很有用。")])]),e._v(" "),n("p",[e._v("的下面的示例集名称 "),n("code",[e._v("my_secret")]),e._v(" 以 "),n("code",[e._v("redis_secret")]),e._v(" 在容器内，将模式设定为 "),n("code",[e._v("0440")]),e._v(" （组可读）和套在用户和组 "),n("code",[e._v("103")]),e._v(" 。 该 "),n("code",[e._v("redis")]),e._v(" 服务无权访问该 "),n("code",[e._v("my_other_secret")]),e._v(" 机密。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("version: \"3.8\"\nservices:\n  redis:\n    image: redis:latest\n    deploy:\n      replicas: 1\n    secrets:\n      - source: my_secret\n        target: redis_secret\n        uid: '103'\n        gid: '103'\n        mode: 0440\nsecrets:\n  my_secret:\n    file: ./my_secret.txt\n  my_other_secret:\n    external: true\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br")])]),n("p",[e._v("您可以授予服务访问多个机密的权限，并且可以混合长短语法。 定义机密并不意味着授予服务对其的访问权限。")]),e._v(" "),n("h3",{attrs:{id:"security-opt-🔗"}},[e._v("security_opt "),n("a",{attrs:{href:"#security_opt"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("覆盖每个容器的默认标签方案。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("security_opt:\n  - label:user:USER\n  - label:role:ROLE\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在以群集模式部署堆栈"),n("OutboundLink")],1),e._v(" "),n("code",[e._v("security_opt")]),e._v(" 时， "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("将"),n("OutboundLink")],1),e._v(" 忽略 该 选项 。")])]),e._v(" "),n("h3",{attrs:{id:"stop-grace-period-🔗"}},[e._v("stop_grace_period "),n("a",{attrs:{href:"#stop_grace_period"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("指定 "),n("a",{attrs:{href:"#stop_signal"}},[n("code",[e._v("stop_signal")])]),e._v(" 在发送SIGKILL之前， 如果容器无法处理SIGTERM（或已使用指定的任何停止信号）而试图停止容器的等待时间 。 指定为 "),n("a",{attrs:{href:"#specifying-durations"}},[e._v("持续时间")]),e._v(" 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("stop_grace_period: 1s\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("stop_grace_period: 1m30s\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("p",[e._v("默认情况下， "),n("code",[e._v("stop")]),e._v(" 在发送SIGKILL之前等待容器退出10秒钟。")]),e._v(" "),n("h3",{attrs:{id:"stop-signal-🔗"}},[e._v("stop_signal "),n("a",{attrs:{href:"#stop_signal"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("设置替代信号以停止容器。 默认情况下 "),n("code",[e._v("stop")]),e._v(" 使用SIGTERM。 使用 "),n("code",[e._v("stop_signal")]),e._v(" 原因 设置替代信号 会 "),n("code",[e._v("stop")]),e._v(" 改为发送该信号。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("stop_signal: SIGUSR1\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("h3",{attrs:{id:"的sysctl-🔗"}},[e._v("的sysctl "),n("a",{attrs:{href:"#sysctls"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("要在容器中设置内核参数。 您可以使用数组或字典。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("sysctls:\n  net.core.somaxconn: 1024\n  net.ipv4.tcp_syncookies: 0\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("sysctls:\n  - net.core.somaxconn=1024\n  - net.ipv4.tcp_syncookies=0\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("p",[e._v("您只能使用内核中已命名空间的sysctls。 Docker不支持更改也会修改主机系统的容器内的sysctls。 有关受支持的sysctls的概述，请参阅 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/run/#configure-namespaced-kernel-parameters-sysctls-at-runtime",target:"_blank",rel:"noopener noreferrer"}},[e._v("在运行时配置命名空间的内核参数（sysctls）"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在以集群模式部署堆栈"),n("OutboundLink")],1),e._v(" 时，此选项需要Docker Engine 19.03或更高版本 。")])]),e._v(" "),n("h3",{attrs:{id:"tmpfs的-🔗"}},[e._v("tmpfs的 "),n("a",{attrs:{href:"#tmpfs"}},[e._v("🔗")])]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-36",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.6版"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")])]),e._v(" "),n("p",[e._v("在容器内安装一个临时文件系统。 可以是单个值或列表。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("tmpfs: /run\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("tmpfs:\n  - /run\n  - /tmp\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在"),n("OutboundLink")],1),e._v(" 以（3-3.5版）撰写文件 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("以群集模式部署堆栈"),n("OutboundLink")],1),e._v(" 时， "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("将"),n("OutboundLink")],1),e._v(" 忽略此选项 。")])]),e._v(" "),n("p",[e._v("在容器内安装一个临时文件系统。 Size参数指定tmpfs安装的大小（以字节为单位）。 默认情况下不受限制。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("- type: tmpfs\n  target: /app\n  tmpfs:\n    size: 1000\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("h3",{attrs:{id:"ulimits-🔗"}},[e._v("ulimits "),n("a",{attrs:{href:"#ulimits"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("覆盖容器的默认ulimit。 您可以将单个限制指定为整数，也可以将软/硬限制指定为映射。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("ulimits:\n  nproc: 65535\n  nofile:\n    soft: 20000\n    hard: 40000\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("h3",{attrs:{id:"userns-mode-🔗"}},[e._v("userns_mode "),n("a",{attrs:{href:"#userns_mode"}},[e._v("🔗")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('userns_mode: "host"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("p",[e._v("如果Docker守护程序配置了用户名称空间，则禁用此服务的用户名称空间。 有关 更多信息， 请参见 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/dockerd/#disable-user-namespace-for-a-container",target:"_blank",rel:"noopener noreferrer"}},[e._v("dockerd"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在以群集模式部署堆栈"),n("OutboundLink")],1),e._v(" "),n("code",[e._v("userns_mode")]),e._v(" 时， "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stack_deploy/",target:"_blank",rel:"noopener noreferrer"}},[e._v("将"),n("OutboundLink")],1),e._v(" 忽略 该 选项 。")])]),e._v(" "),n("h3",{attrs:{id:"卷-🔗"}},[e._v("卷 "),n("a",{attrs:{href:"#volumes"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("挂载主机路径或命名卷，指定为服务的子选项。")]),e._v(" "),n("p",[e._v("您可以将主机路径安装为单个服务的定义的一部分，而无需在顶级 "),n("code",[e._v("volumes")]),e._v(" 密钥中 进行定义 。")]),e._v(" "),n("p",[e._v("但是，如果要跨多个服务重用卷，请在 "),n("a",{attrs:{href:"#volume-configuration-reference"}},[e._v("顶级 "),n("code",[e._v("volumes")]),e._v(" 键中")]),e._v(" 定义一个命名卷 。 将命名卷与 "),n("a",{attrs:{href:"#volumes-for-services-swarms-and-stack-files"}},[e._v("服务，群集和堆栈文件一起使用")]),e._v(" 。")]),e._v(" "),n("blockquote",[n("p",[e._v("更改为 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-3",target:"_blank",rel:"noopener noreferrer"}},[e._v("版本3"),n("OutboundLink")],1),e._v(" 文件格式。")]),e._v(" "),n("p",[e._v("顶级 "),n("a",{attrs:{href:"#volume-configuration-reference"}},[e._v("卷")]),e._v(" 键定义了一个命名卷，并从每个服务的 "),n("code",[e._v("volumes")]),e._v(" 列表中 引用了该卷 。 这将替换 "),n("code",[e._v("volumes_from")]),e._v(" 早期版本的Compose文件格式。")])]),e._v(" "),n("p",[e._v("此示例显示了 服务 "),n("code",[e._v("mydata")]),e._v(" 正在使用 的命名卷（ ） "),n("code",[e._v("web")]),e._v(" ，以及为单个服务（ "),n("code",[e._v("db")]),e._v(" service 之下的第一个路径 "),n("code",[e._v("volumes")]),e._v(" ） 定义的绑定安装 。 该 "),n("code",[e._v("db")]),e._v(" 服务还使用一个名为 "),n("code",[e._v("dbdata")]),e._v(" （ "),n("code",[e._v("db")]),e._v(" service 下的第二路径 "),n("code",[e._v("volumes")]),e._v(" ） 的命名卷 ，但是使用旧的字符串格式定义该卷以装入命名卷。 "),n("code",[e._v("volumes")]),e._v(" 如图所示， 命名卷必须在顶级 键下列出。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  web:\n    image: nginx:alpine\n    volumes:\n      - type: volume\n        source: mydata\n        target: /data\n        volume:\n          nocopy: true\n      - type: bind\n        source: ./static\n        target: /opt/app/static\n\n  db:\n    image: postgres:latest\n    volumes:\n      - "/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock"\n      - "dbdata:/var/lib/postgresql/data"\n\nvolumes:\n  mydata:\n  dbdata:\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br")])]),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("p",[e._v("有关卷的一般信息，请参阅 文档中的 “ "),n("a",{attrs:{href:"https://docs.docker.com/storage/volumes/",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用卷"),n("OutboundLink")],1),e._v(" 和 "),n("a",{attrs:{href:"https://docs.docker.com/engine/extend/plugins_volume/",target:"_blank",rel:"noopener noreferrer"}},[e._v("卷插件”"),n("OutboundLink")],1),e._v(" 部分。")])]),e._v(" "),n("h4",{attrs:{id:"短语法-4"}},[e._v("短语法")]),e._v(" "),n("p",[e._v("简短语法使用通用 "),n("code",[e._v("[SOURCE:]TARGET[:MODE]")]),e._v(" 格式，其中 "),n("code",[e._v("SOURCE")]),e._v(" 可以是主机路径或卷名。 "),n("code",[e._v("TARGET")]),e._v(" 是安装卷的容器路径。 标准模式适用 "),n("code",[e._v("ro")]),e._v(" 于只读和 "),n("code",[e._v("rw")]),e._v(" 读写（默认）。")]),e._v(" "),n("p",[e._v("您可以在主机上安装相对路径，该相对路径相对于正在使用的Compose配置文件的目录进行扩展。 相对路径应始终以 "),n("code",[e._v(".")]),e._v(" 或 开头 "),n("code",[e._v("..")]),e._v(" 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("volumes:\n  # Just specify a path and let the Engine create a volume\n  - /var/lib/mysql\n\n  # Specify an absolute path mapping\n  - /opt/data:/var/lib/mysql\n\n  # Path on the host, relative to the Compose file\n  - ./cache:/tmp/cache\n\n  # User-relative path\n  - ~/configs:/etc/configs/:ro\n\n  # Named volume\n  - datavolume:/var/lib/mysql\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br")])]),n("h4",{attrs:{id:"长语法-4"}},[e._v("长语法")]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-32",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.2版"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")])]),e._v(" "),n("p",[e._v("长格式语法允许配置其他不能以短格式表示的字段。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("type")]),e._v(" ：所述安装型 "),n("code",[e._v("volume")]),e._v(" ， "),n("code",[e._v("bind")]),e._v(" ， "),n("code",[e._v("tmpfs")]),e._v(" 或 "),n("code",[e._v("npipe")])]),e._v(" "),n("li",[n("code",[e._v("source")]),e._v(" ：挂载的源，主机上用于绑定挂载的路径或 "),n("a",{attrs:{href:"#volume-configuration-reference"}},[e._v("顶级 "),n("code",[e._v("volumes")]),e._v(" 密钥中")]),e._v(" 定义的卷的名称 。 不适用于tmpfs挂载。")]),e._v(" "),n("li",[n("code",[e._v("target")]),e._v(" ：安装了卷的容器中的路径")]),e._v(" "),n("li",[n("code",[e._v("read_only")]),e._v(" ：将卷设置为只读的标志")]),e._v(" "),n("li",[n("code",[e._v("bind")]),e._v(" ：配置其他绑定选项\n"),n("ul",[n("li",[n("code",[e._v("propagation")]),e._v(" ：用于绑定的传播模式")])])]),e._v(" "),n("li",[n("code",[e._v("volume")]),e._v(" ：配置其他音量选项\n"),n("ul",[n("li",[n("code",[e._v("nocopy")]),e._v(" ：创建卷时禁用从容器中复制数据的标志")])])]),e._v(" "),n("li",[n("code",[e._v("tmpfs")]),e._v(" ：配置其他tmpfs选项\n"),n("ul",[n("li",[n("code",[e._v("size")]),e._v(" ：tmpfs挂载的大小（以字节为单位）")])])]),e._v(" "),n("li",[n("code",[e._v("consistency")]),e._v(" ：装载的一致性要求， "),n("code",[e._v("consistent")]),e._v(" （主机和容器具有相同的视图）， "),n("code",[e._v("cached")]),e._v(" （读缓存，主机视图具有权威性）或 "),n("code",[e._v("delegated")]),e._v(" （读写缓存，容器的视图具有权威性）之一")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  web:\n    image: nginx:alpine\n    ports:\n      - "80:80"\n    volumes:\n      - type: volume\n        source: mydata\n        target: /data\n        volume:\n          nocopy: true\n      - type: bind\n        source: ./static\n        target: /opt/app/static\n\nnetworks:\n  webnet:\n\nvolumes:\n  mydata:\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br")])]),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("p",[e._v("创建绑定安装时，使用长语法要求事先创建引用的文件夹。 如果该文件夹不存在，则使用短语法立即创建该文件夹。 有关 更多信息， 请参见 "),n("a",{attrs:{href:"https://docs.docker.com/storage/bind-mounts/#differences-between--v-and---mount-behavior",target:"_blank",rel:"noopener noreferrer"}},[e._v("绑定安装文档"),n("OutboundLink")],1),e._v(" 。")])]),e._v(" "),n("h4",{attrs:{id:"服务，群集和堆栈文件的卷"}},[e._v("服务，群集和堆栈文件的卷")]),e._v(" "),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[e._v("使用服务，群集和 "),n("code",[e._v("docker-stack.yml")]),e._v(" 文件时，请记住，支持服务的任务（容器）可以部署在群集中的任何节点上，并且每次更新服务时，该节点都可以是不同的节点。")])]),e._v(" "),n("p",[e._v("在没有具有指定源的命名卷的情况下，Docker为支持服务的每个任务创建一个匿名卷。 删除关联的容器后，匿名卷不会继续存在。")]),e._v(" "),n("p",[e._v("如果要保留数据，请使用命名卷和支持多主机的卷驱动程序，以便可以从任何节点访问数据。 或者，对服务设置约束，以便将其任务部署在具有该卷的节点上。")]),e._v(" "),n("p",[e._v("例如， "),n("a",{attrs:{href:"https://github.com/docker/labs/blob/master/beginner/chapters/votingapp.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Labs中votingapp示例"),n("OutboundLink")],1),e._v(" 的 "),n("code",[e._v("docker-stack.yml")]),e._v(" 文件 定义了一个称为 运行 数据库的服务。 它被配置为命名卷以将数据持久存储在群集中，"),n("em",[e._v("并且")]),e._v(" 被限制为仅在 节点 上运行 。 这是该文件中的相关片段： "),n("a",{attrs:{href:"https://github.com/docker/labs/blob/master/beginner/chapters/votingapp.md",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1),n("code",[e._v("db")]),e._v(" "),n("code",[e._v("postgres")]),e._v(" "),n("code",[e._v("manager")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  db:\n    image: postgres:9.4\n    volumes:\n      - db-data:/var/lib/postgresql/data\n    networks:\n      - backend\n    deploy:\n      placement:\n        constraints: [node.role == manager]\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br")])]),n("h4",{attrs:{id:"卷装载的缓存选项（适用于mac的docker桌面）"}},[e._v("卷装载的缓存选项（适用于Mac的Docker桌面）")]),e._v(" "),n("p",[e._v("您可以在Compose文件中为绑定安装的目录配置容器和主机的一致性要求，以提高读/写卷安装的性能。 这些选项解决了 "),n("code",[e._v("osxfs")]),e._v(" 文件共享 所特有的问题 ，因此仅适用于Mac的Docker Desktop。")]),e._v(" "),n("p",[e._v("标志是：")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("consistent")]),e._v(" ：完全一致。 容器运行时和主机始终保持相同的安装视图。 这是默认值。")]),e._v(" "),n("li",[n("code",[e._v("cached")]),e._v(" ：主机对挂载的观点是权威的。 在容器中可以看到主机上所做的更新，这可能会有所延迟。")]),e._v(" "),n("li",[n("code",[e._v("delegated")]),e._v(" ：容器运行时的挂载视图具有权威性。 在主机上看到容器中所做的更新之前可能会有所延迟。")])]),e._v(" "),n("p",[e._v("这是将卷配置为的示例 "),n("code",[e._v("cached")]),e._v(" ：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  php:\n    image: php:7.1-fpm\n    ports:\n      - "9000"\n    volumes:\n      - .:/var/www/project:cached\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br")])]),n("p",[e._v("有关这些标志，它们所解决的问题以及 "),n("code",[e._v("docker run")]),e._v(" 与之对应 的问题的完整详细信息，请 参见Docker Desktop for Mac主题 "),n("a",{attrs:{href:"https://docs.docker.com/docker-for-mac/osxfs-caching/",target:"_blank",rel:"noopener noreferrer"}},[e._v("“针对卷挂载（共享文件系统）的性能调整”"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("h3",{attrs:{id:"域名，主机名，ipc，mac-address，特权，read-only，shm-size，stdin-open，tty用户，working-dir-🔗"}},[e._v("域名，主机名，IPC，MAC_ADDRESS，特权，READ_ONLY，shm_size，stdin_open，TTY用户，working_dir "),n("a",{attrs:{href:"#domainname-hostname-ipc-mac_address-privileged-read_only-shm_size-stdin_open-tty-user-working_dir"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("其中每个都是一个值，类似于其 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/run/",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker run"),n("OutboundLink")],1),e._v(" 对应项。 请注意，这 "),n("code",[e._v("mac_address")]),e._v(" 是一个旧选项。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("user: postgresql\nworking_dir: /code\n\ndomainname: foo.com\nhostname: foo\nipc: host\nmac_address: 02:42:ac:11:65:43\n\nprivileged: true\n\nread_only: true\nshm_size: 64M\nstdin_open: true\ntty: true\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br")])]),n("h2",{attrs:{id:"指定持续时间-🔗"}},[e._v("指定持续时间 "),n("a",{attrs:{href:"#specifying-durations"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("某些配置选项（例如的 "),n("code",[e._v("interval")]),e._v(" 和 "),n("code",[e._v("timeout")]),e._v(" 子选项） "),n("a",{attrs:{href:"#healthcheck"}},[n("code",[e._v("check")])]),e._v(" 将持续时间作为字符串接受，格式如下：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("2.5s\n10s\n1m30s\n2h32m\n5h34m56s\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("支持的单位是 "),n("code",[e._v("us")]),e._v(" ， "),n("code",[e._v("ms")]),e._v(" ， "),n("code",[e._v("s")]),e._v(" ， "),n("code",[e._v("m")]),e._v(" 和 "),n("code",[e._v("h")]),e._v(" 。")]),e._v(" "),n("h2",{attrs:{id:"指定字节值-🔗"}},[e._v("指定字节值 "),n("a",{attrs:{href:"#specifying-byte-values"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("一些配置选项（例如的 "),n("code",[e._v("shm_size")]),e._v(" 子选项） "),n("a",{attrs:{href:"#build"}},[n("code",[e._v("build")])]),e._v(" 将字节值作为字符串接受，格式如下：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("2b\n1024kb\n2048k\n300m\n1gb\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("支持的单位是 "),n("code",[e._v("b")]),e._v(" ， "),n("code",[e._v("k")]),e._v(" ， "),n("code",[e._v("m")]),e._v(" 和 "),n("code",[e._v("g")]),e._v(" ，和它们的替代符号 "),n("code",[e._v("kb")]),e._v(" ， "),n("code",[e._v("mb")]),e._v(" 和 "),n("code",[e._v("gb")]),e._v(" 。 目前不支持十进制值。")]),e._v(" "),n("h2",{attrs:{id:"卷配置参考-🔗"}},[e._v("卷配置参考 "),n("a",{attrs:{href:"#volume-configuration-reference"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("虽然可以申报 "),n("a",{attrs:{href:"#volumes"}},[e._v("卷")]),e._v(" 上飞作为服务声明的一部分，这部分允许您创建可在多个服务中重复使用（不依赖于一个名为卷 "),n("code",[e._v("volumes_from")]),e._v(" 或），并且很容易检索和使用泊坞窗命令行接受视API。 有关 更多信息， 请参阅 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_create/",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker volume"),n("OutboundLink")],1),e._v(" 子命令文档。")]),e._v(" "),n("p",[e._v("有关 "),n("a",{attrs:{href:"https://docs.docker.com/storage/volumes/",target:"_blank",rel:"noopener noreferrer"}},[e._v("卷"),n("OutboundLink")],1),e._v(" 的一般信息， 请参见 "),n("a",{attrs:{href:"https://docs.docker.com/storage/volumes/",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用卷"),n("OutboundLink")],1),e._v(" 和 "),n("a",{attrs:{href:"https://docs.docker.com/engine/extend/plugins_volume/",target:"_blank",rel:"noopener noreferrer"}},[e._v("卷插件"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("p",[e._v("这是一个两种服务设置的示例，其中数据库的数据目录与另一个服务作为卷共享，以便可以定期备份它：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\n\nservices:\n  db:\n    image: db\n    volumes:\n      - data-volume:/var/lib/db\n  backup:\n    image: backup-service\n    volumes:\n      - data-volume:/var/lib/backup/data\n\nvolumes:\n  data-volume:\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br")])]),n("p",[e._v("顶级 "),n("code",[e._v("volumes")]),e._v(" 键 下的条目 可以为空，在这种情况下，它使用引擎配置的默认驱动程序（在大多数情况下，这是 "),n("code",[e._v("local")]),e._v(" 驱动程序）。 （可选）您可以使用以下键对其进行配置：")]),e._v(" "),n("h3",{attrs:{id:"司机-🔗"}},[e._v("司机 "),n("a",{attrs:{href:"#driver"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("指定该卷应使用哪个卷驱动程序。 默认为Docker Engine配置为使用的任何驱动程序，大多数情况下为 "),n("code",[e._v("local")]),e._v(" 。 如果驱动程序不可用，则引擎在 "),n("code",[e._v("docker-compose up")]),e._v(" 尝试创建卷 时会返回错误 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("driver: foobar\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("h3",{attrs:{id:"driver-opts-🔗"}},[e._v("driver_opts "),n("a",{attrs:{href:"#driver_opts"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("指定选项列表作为键值对，以传递给该卷的驱动程序。 这些选项取决于驱动程序-有关更多信息，请参考驱动程序的文档。 可选的。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('volumes:\n  example:\n    driver_opts:\n      type: "nfs"\n      o: "addr=10.40.0.199,nolock,soft,rw"\n      device: ":/docker/example"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br")])]),n("h3",{attrs:{id:"外部-🔗"}},[e._v("外部 "),n("a",{attrs:{href:"#external"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("如果设置为 "),n("code",[e._v("true")]),e._v(" ，则指定此卷是在Compose之外创建的。 "),n("code",[e._v("docker-compose up")]),e._v(" 不会尝试创建它，如果不存在则引发错误。")]),e._v(" "),n("p",[e._v("为3.3和下面的格式的版本， "),n("code",[e._v("external")]),e._v(" 不能同时使用与其它卷配置键（ "),n("code",[e._v("driver")]),e._v(" ， "),n("code",[e._v("driver_opts")]),e._v(" ， "),n("code",[e._v("labels")]),e._v(" ）。 对于 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-34",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.4"),n("OutboundLink")],1),e._v(" 及更高 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-34",target:"_blank",rel:"noopener noreferrer"}},[e._v("版本，"),n("OutboundLink")],1),e._v(" 此限制不再存在 。")]),e._v(" "),n("p",[e._v("在下面的示例中， "),n("code",[e._v("[projectname]_data")]),e._v(" Compose 不会尝试创建一个名为的卷，而是 查找一个简单地称为的现有卷 "),n("code",[e._v("data")]),e._v(" 并将其装入 "),n("code",[e._v("db")]),e._v(" 服务的容器中。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\n\nservices:\n  db:\n    image: postgres\n    volumes:\n      - data:/var/lib/postgresql/data\n\nvolumes:\n  data:\n    external: true\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br")])]),n("blockquote",[n("p",[e._v("不建议使用 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-34",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.4版"),n("OutboundLink")],1),e._v(" 文件格式。")]),e._v(" "),n("p",[e._v("使用版本3.4文件格式弃用了external.name "),n("code",[e._v("name")]),e._v(" 。")])]),e._v(" "),n("p",[e._v("您还可以与在Compose文件中用于引用卷的名称分开指定卷的名称：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("volumes:\n  data:\n    external:\n      name: actual-name-of-volume\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[e._v("如果您使用 "),n("a",{attrs:{href:"#deploy"}},[e._v("docker stack deploy")]),e._v(" 以 "),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/",target:"_blank",rel:"noopener noreferrer"}},[e._v("群体模式"),n("OutboundLink")],1),e._v(" 启动应用程序 （而不是 "),n("a",{attrs:{href:"https://docs.docker.com/compose/reference/up/",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker compose up"),n("OutboundLink")],1),e._v(" ）， "),n("em",[e._v("则会创建")]),e._v(" 不存在的外部卷 。 在群模式下，由服务定义卷后将自动创建该卷。 由于服务任务是在新节点上安排的，因此 "),n("a",{attrs:{href:"https://github.com/docker/swarmkit/blob/master/README.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("swarmkit"),n("OutboundLink")],1),e._v(" 在本地节点上创建卷。 要了解更多信息，请参见 "),n("a",{attrs:{href:"https://github.com/moby/moby/issues/29976",target:"_blank",rel:"noopener noreferrer"}},[e._v("moby / moby＃29976"),n("OutboundLink")],1),e._v(" 。"),n("a",{attrs:{href:"#deploy"}}),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1),n("a",{attrs:{href:"https://docs.docker.com/compose/reference/up/",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1),n("a",{attrs:{href:"https://github.com/docker/swarmkit/blob/master/README.md",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1),n("a",{attrs:{href:"https://github.com/moby/moby/issues/29976",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1)])]),e._v(" "),n("h3",{attrs:{id:"标签-🔗-2"}},[e._v("标签 "),n("a",{attrs:{href:"#labels-3"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("使用 "),n("a",{attrs:{href:"https://docs.docker.com/config/labels-custom-metadata/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker标签"),n("OutboundLink")],1),e._v(" 将元数据添加到容器 。 您可以使用数组或字典。")]),e._v(" "),n("p",[e._v("建议您使用反向DNS表示法，以防止标签与其他软件使用的标签冲突。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('labels:\n  com.example.description: "Database volume"\n  com.example.department: "IT/Ops"\n  com.example.label-with-empty-value: ""\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('labels:\n  - "com.example.description=Database volume"\n  - "com.example.department=IT/Ops"\n  - "com.example.label-with-empty-value"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("h3",{attrs:{id:"命名-🔗"}},[e._v("命名 "),n("a",{attrs:{href:"#name"}},[e._v("🔗")])]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-34",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.4版"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")])]),e._v(" "),n("p",[e._v("为此卷设置一个自定义名称。 名称字段可用于引用包含特殊字符的卷。 该名称按原样使用， "),n("strong",[e._v("不会")]),e._v(" 与堆栈名称一起作用域。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nvolumes:\n  data:\n    name: my-app-data\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("p",[e._v("它也可以与 "),n("code",[e._v("external")]),e._v(" 属性 一起使用 ：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nvolumes:\n  data:\n    external: true\n    name: my-app-data\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("h2",{attrs:{id:"网络配置参考-🔗"}},[e._v("网络配置参考 "),n("a",{attrs:{href:"#network-configuration-reference"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("顶级 "),n("code",[e._v("networks")]),e._v(" 密钥可让您指定要创建的网络。")]),e._v(" "),n("ul",[n("li",[e._v("有关Compose使用Docker网络功能和所有网络驱动程序选项的完整说明，请参阅《 "),n("a",{attrs:{href:"https://docs.docker.com/compose/networking/",target:"_blank",rel:"noopener noreferrer"}},[e._v("网络指南》"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("li",[e._v("有关 网络的 "),n("a",{attrs:{href:"https://github.com/docker/labs/blob/master/README.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Labs"),n("OutboundLink")],1),e._v(" 教程，请从 "),n("a",{attrs:{href:"https://github.com/docker/labs/blob/master/networking/README.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("设计可扩展的便携式Docker容器网络开始"),n("OutboundLink")],1)])]),e._v(" "),n("h3",{attrs:{id:"司机-🔗-2"}},[e._v("司机 "),n("a",{attrs:{href:"#driver-1"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("指定该网络应使用哪个驱动程序。")]),e._v(" "),n("p",[e._v("默认驱动程序取决于您使用的Docker引擎的配置方式，但是在大多数情况下，它 "),n("code",[e._v("bridge")]),e._v(" 位于单个主机和 "),n("code",[e._v("overlay")]),e._v(" Swarm上。")]),e._v(" "),n("p",[e._v("如果驱动程序不可用，Docker引擎将返回错误。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("driver: overlay\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("h4",{attrs:{id:"桥"}},[e._v("桥")]),e._v(" "),n("p",[e._v("Docker默认 "),n("code",[e._v("bridge")]),e._v(" 在单个主机上 使用 网络。 有关如何使用网桥网络的示例，请参阅关于 "),n("a",{attrs:{href:"https://github.com/docker/labs/blob/master/networking/A2-bridge-networking.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("网桥网络"),n("OutboundLink")],1),e._v(" 的Docker Labs教程 。")]),e._v(" "),n("h4",{attrs:{id:"覆盖"}},[e._v("覆盖")]),e._v(" "),n("p",[e._v("该 "),n("code",[e._v("overlay")]),e._v(" 驱动程序创建一个跨多个节点命名的网络 "),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/",target:"_blank",rel:"noopener noreferrer"}},[e._v("群"),n("OutboundLink")],1),e._v(" 。")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("有关如何以 "),n("code",[e._v("overlay")]),e._v(" 群集模式 构建和使用 带有服务 的 网络 的有效示例 ，请参阅《 "),n("a",{attrs:{href:"https://github.com/docker/labs/blob/master/networking/A3-overlay-networking.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("覆盖网络和服务发现》"),n("OutboundLink")],1),e._v(" 的Docker Labs教程 。")])]),e._v(" "),n("li",[n("p",[e._v("有关深入了解其工作原理的信息，请参见“ "),n("a",{attrs:{href:"https://github.com/docker/labs/blob/master/networking/concepts/06-overlay-networks.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("覆盖驱动程序网络体系结构”"),n("OutboundLink")],1),e._v(" 上的网络概念实验室 。")])])]),e._v(" "),n("h4",{attrs:{id:"主机或无"}},[e._v("主机或无")]),e._v(" "),n("p",[e._v("使用主机的网络堆栈，或者不使用网络。 等同于 "),n("code",[e._v("docker run --net=host")]),e._v(" 或 "),n("code",[e._v("docker run --net=none")]),e._v(" 。 仅在使用 "),n("code",[e._v("docker stack")]),e._v(" 命令时 使用 。 如果使用 "),n("code",[e._v("docker-compose")]),e._v(" 命令，请改用 "),n("a",{attrs:{href:"#network_mode"}},[e._v("network_mode")]),e._v(" 。")]),e._v(" "),n("p",[e._v("如果要在通用版本上使用特定网络，请使用第二个yaml文件示例中提到的[network]。")]),e._v(" "),n("p",[e._v("使用内置网络（例如 "),n("code",[e._v("host")]),e._v(" 和 "),n("code",[e._v("none")]),e._v(" ） 的语法 略有不同。 使用名称 "),n("code",[e._v("host")]),e._v(" 或 "),n("code",[e._v("none")]),e._v(" （Docker已经自动创建的） 定义一个外部网络，并定义一个 Compose可以使用的别名（ "),n("code",[e._v("hostnet")]),e._v(" 或 "),n("code",[e._v("nonet")]),e._v(" 在以下示例中），然后使用该别名向该网络授予服务访问权限。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nservices:\n  web:\n    networks:\n      hostnet: {}\n\nnetworks:\n  hostnet:\n    external: true\n    name: host\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("services:\n  web:\n    ...\n    build:\n      ...\n      network: host\n      context: .\n      ...\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("services:\n  web:\n    ...\n    networks:\n      nonet: {}\n\nnetworks:\n  nonet:\n    external: true\n    name: none\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br")])]),n("h3",{attrs:{id:"driver-opts-🔗-2"}},[e._v("driver_opts "),n("a",{attrs:{href:"#driver_opts-1"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("指定选项列表作为键值对，以传递给该网络的驱动程序。 这些选项取决于驱动程序-有关更多信息，请参考驱动程序的文档。 可选的。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('driver_opts:\n  foo: "bar"\n  baz: 1\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("h3",{attrs:{id:"附-🔗"}},[e._v("附 "),n("a",{attrs:{href:"#attachable"}},[e._v("🔗")])]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-32",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.2版"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")])]),e._v(" "),n("p",[e._v("仅在将 "),n("code",[e._v("driver")]),e._v(" 设置 为时使用 "),n("code",[e._v("overlay")]),e._v(" 。 如果设置为 "),n("code",[e._v("true")]),e._v(" ，则除了服务之外，独立容器还可以连接到该网络。 如果独立容器连接到覆盖网络，则它可以与也从其他Docker守护程序附加到覆盖网络的服务和独立容器进行通信。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("networks:\n  mynet1:\n    driver: overlay\n    attachable: true\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("h3",{attrs:{id:"enable-ipv6-🔗"}},[e._v("enable_ipv6 "),n("a",{attrs:{href:"#enable_ipv6"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("在此网络上启用IPv6网络。")]),e._v(" "),n("blockquote",[n("p",[e._v("撰写文件版本3不支持")]),e._v(" "),n("p",[n("code",[e._v("enable_ipv6")]),e._v(" 要求您使用版本2的Compose文件，因为Swarm模式尚不支持此指令。")])]),e._v(" "),n("h3",{attrs:{id:"伊帕姆-🔗"}},[e._v("伊帕姆 "),n("a",{attrs:{href:"#ipam"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("指定自定义IPAM配置。 这是一个具有多个属性的对象，每个属性都是可选的：")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("driver")]),e._v(" ：自定义IPAM驱动程序，而不是默认驱动程序。")]),e._v(" "),n("li",[n("code",[e._v("config")]),e._v(" ：具有零个或多个配置块的列表，每个配置块包含以下任一键：\n"),n("ul",[n("li",[n("code",[e._v("subnet")]),e._v(" ：CIDR格式的子网表示一个网段")])])])]),e._v(" "),n("p",[e._v("一个完整的例子：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("ipam:\n  driver: default\n  config:\n    - subnet: 172.28.0.0/16\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("p",[n("code",[e._v("gateway")]),e._v(" 目前仅支持版本2 等其他IPAM配置 。")])]),e._v(" "),n("h3",{attrs:{id:"内部-🔗"}},[e._v("内部 "),n("a",{attrs:{href:"#internal"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("默认情况下，Docker还将桥接网络连接到它以提供外部连接。 如果要创建外部隔离的覆盖网络，可以将此选项设置为 "),n("code",[e._v("true")]),e._v(" 。")]),e._v(" "),n("h3",{attrs:{id:"标签-🔗-3"}},[e._v("标签 "),n("a",{attrs:{href:"#labels-4"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("使用 "),n("a",{attrs:{href:"https://docs.docker.com/config/labels-custom-metadata/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker标签"),n("OutboundLink")],1),e._v(" 将元数据添加到容器 。 您可以使用数组或字典。")]),e._v(" "),n("p",[e._v("建议您使用反向DNS表示法，以防止标签与其他软件使用的标签冲突。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('labels:\n  com.example.description: "Financial transaction network"\n  com.example.department: "Finance"\n  com.example.label-with-empty-value: ""\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('labels:\n  - "com.example.description=Financial transaction network"\n  - "com.example.department=Finance"\n  - "com.example.label-with-empty-value"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("h3",{attrs:{id:"外部-🔗-2"}},[e._v("外部 "),n("a",{attrs:{href:"#external-1"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("如果设置为 "),n("code",[e._v("true")]),e._v(" ，则指定此网络是在Compose之外创建的。 "),n("code",[e._v("docker-compose up")]),e._v(" 不会尝试创建它，如果不存在则引发错误。")]),e._v(" "),n("p",[e._v("为3.3和下面的格式的版本， "),n("code",[e._v("external")]),e._v(" 不能同时使用与其他网络配置键（ "),n("code",[e._v("driver")]),e._v(" ， "),n("code",[e._v("driver_opts")]),e._v(" ， "),n("code",[e._v("ipam")]),e._v(" ， "),n("code",[e._v("internal")]),e._v(" ）。 对于 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-34",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.4"),n("OutboundLink")],1),e._v(" 及更高 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-34",target:"_blank",rel:"noopener noreferrer"}},[e._v("版本，"),n("OutboundLink")],1),e._v(" 此限制不再存在 。")]),e._v(" "),n("p",[e._v("在下面的示例中， "),n("code",[e._v("proxy")]),e._v(" 是通往外界的门户。 "),n("code",[e._v("[projectname]_outside")]),e._v(" Compose 不会尝试创建一个名为的网络 ， 而是 寻找一个简单称为的现有网络 "),n("code",[e._v("outside")]),e._v(" ，并将 "),n("code",[e._v("proxy")]),e._v(" 服务的容器 连接 到该网络。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\n\nservices:\n  proxy:\n    build: ./proxy\n    networks:\n      - outside\n      - default\n  app:\n    build: ./app\n    networks:\n      - default\n\nnetworks:\n  outside:\n    external: true\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br")])]),n("blockquote",[n("p",[e._v("不建议使用 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-35",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.5版"),n("OutboundLink")],1),e._v(" 文件格式。")]),e._v(" "),n("p",[e._v("使用版本3.5文件格式弃用了external.name "),n("code",[e._v("name")]),e._v(" 。")])]),e._v(" "),n("p",[e._v("您还可以在Compose文件中指定网络名称，而不是用来引用网络的名称。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nnetworks:\n  outside:\n    external:\n      name: actual-name-of-network\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("h3",{attrs:{id:"命名-🔗-2"}},[e._v("命名 "),n("a",{attrs:{href:"#name-1"}},[e._v("🔗")])]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-35",target:"_blank",rel:"noopener noreferrer"}},[e._v("版本3.5"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")])]),e._v(" "),n("p",[e._v("为此网络设置一个自定义名称。 名称字段可用于引用包含特殊字符的网络。 该名称按原样使用， "),n("strong",[e._v("不会")]),e._v(" 与堆栈名称一起作用域。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nnetworks:\n  network1:\n    name: my-app-net\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("p",[e._v("它也可以与 "),n("code",[e._v("external")]),e._v(" 属性 一起使用 ：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: "3.8"\nnetworks:\n  network1:\n    external: true\n    name: my-app-net\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("h2",{attrs:{id:"configs配置参考-🔗"}},[e._v("configs配置参考 "),n("a",{attrs:{href:"#configs-configuration-reference"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("顶级 "),n("code",[e._v("configs")]),e._v(" 声明定义或引用 可以授予此堆栈中的服务的 "),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/configs/",target:"_blank",rel:"noopener noreferrer"}},[e._v("配置"),n("OutboundLink")],1),e._v(" 。 配置的来源是 "),n("code",[e._v("file")]),e._v(" 或 "),n("code",[e._v("external")]),e._v(" 。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("file")]),e._v(" ：使用指定路径中的文件内容创建配置。")]),e._v(" "),n("li",[n("code",[e._v("external")]),e._v(" ：如果设置为true，则指定此配置已创建。 Docker不会尝试创建它，如果它不存在， "),n("code",[e._v("config not found")]),e._v(" 则会发生错误。")]),e._v(" "),n("li",[n("code",[e._v("name")]),e._v(" ：Docker中配置对象的名称。 此字段可用于引用包含特殊字符的配置。 该名称按原样使用， "),n("strong",[e._v("不会")]),e._v(" 与堆栈名称一起作用域。 以3.5版文件格式引入。")]),e._v(" "),n("li",[n("code",[e._v("driver")]),e._v(" 和 "),n("code",[e._v("driver_opts")]),e._v(" ：自定义秘密驱动程序的名称，以及作为键/值对传递的特定于驱动程序的选项。 以3.8版文件格式引入，仅在使用时受支持 "),n("code",[e._v("docker stack")]),e._v(" 。")]),e._v(" "),n("li",[n("code",[e._v("template_driver")]),e._v(" ：要使用的模板驱动程序的名称，它控制是否以及如何将秘密有效负载评估为模板。 如果未设置驱动程序，则不使用任何模板。 当前支持的唯一驱动程序是 "),n("code",[e._v("golang")]),e._v(" ，它使用 "),n("code",[e._v("golang")]),e._v(" 。 以3.8版文件格式引入，仅在使用时受支持 "),n("code",[e._v("docker stack")]),e._v(" 。 有关 "),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/configs/#example-use-a-templated-config",target:"_blank",rel:"noopener noreferrer"}},[e._v("模板化配置"),n("OutboundLink")],1),e._v(" 的示例， 请参阅 "),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/configs/#example-use-a-templated-config",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用"),n("OutboundLink")],1),e._v(" 模板化配置。")])]),e._v(" "),n("p",[e._v("在此示例中， "),n("code",[e._v("my_first_config")]),e._v(" 创建了（就像 "),n("code",[e._v("<stack_name>_my_first_config)")]),e._v(" 部署堆栈时一样，并且 "),n("code",[e._v("my_second_config")]),e._v(" 已经存在于Docker中。）")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("configs:\n  my_first_config:\n    file: ./config_data\n  my_second_config:\n    external: true\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("外部配置的另一个变体是Docker中的配置名称与服务中存在的名称不同时。 以下示例修改了前一个示例，以使用名为的外部配置 "),n("code",[e._v("redis_config")]),e._v(" 。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("configs:\n  my_first_config:\n    file: ./config_data\n  my_second_config:\n    external:\n      name: redis_config\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br")])]),n("p",[e._v("您仍然需要 "),n("a",{attrs:{href:"#configs"}},[e._v("将配置访问权限授予")]),e._v(" 堆栈中的每个服务。")]),e._v(" "),n("h2",{attrs:{id:"机密配置参考-🔗"}},[e._v("机密配置参考 "),n("a",{attrs:{href:"#secrets-configuration-reference"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("顶级 "),n("code",[e._v("secrets")]),e._v(" 声明定义或引用 可以授予此堆栈中的服务的 "),n("a",{attrs:{href:"https://docs.docker.com/engine/swarm/secrets/",target:"_blank",rel:"noopener noreferrer"}},[e._v("机密"),n("OutboundLink")],1),e._v(" 。 秘密的来源是 "),n("code",[e._v("file")]),e._v(" 或 "),n("code",[e._v("external")]),e._v(" 。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("file")]),e._v(" ：秘密是使用指定路径中的文件内容创建的。")]),e._v(" "),n("li",[n("code",[e._v("external")]),e._v(" ：如果设置为true，则指定此秘密已经创建。 Docker不会尝试创建它，如果它不存在， "),n("code",[e._v("secret not found")]),e._v(" 则会发生错误。")]),e._v(" "),n("li",[n("code",[e._v("name")]),e._v(" ：Docker中秘密对象的名称。 此字段可用于引用包含特殊字符的机密。 该名称按原样使用， "),n("strong",[e._v("不会")]),e._v(" 与堆栈名称一起作用域。 以3.5版文件格式引入。")]),e._v(" "),n("li",[n("code",[e._v("template_driver")]),e._v(" ：要使用的模板驱动程序的名称，它控制是否以及如何将秘密有效负载评估为模板。 如果未设置驱动程序，则不使用任何模板。 当前支持的唯一驱动程序是 "),n("code",[e._v("golang")]),e._v(" ，它使用 "),n("code",[e._v("golang")]),e._v(" 。 以3.8版文件格式引入，仅在使用时受支持 "),n("code",[e._v("docker stack")]),e._v(" 。")])]),e._v(" "),n("p",[e._v("在此示例中， "),n("code",[e._v("my_first_secret")]),e._v(" 创建 "),n("code",[e._v("<stack_name>_my_first_secret")]),e._v(" 时是在部署堆栈时 创建的 ，并且 "),n("code",[e._v("my_second_secret")]),e._v(" 已经存在于Docker中。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("secrets:\n  my_first_secret:\n    file: ./secret_data\n  my_second_secret:\n    external: true\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("外部机密的另一个变体是Docker中的机密名称与服务中存在的名称不同时。 以下示例修改了前一个示例，以使用名为的外部机密 "),n("code",[e._v("redis_secret")]),e._v(" 。")]),e._v(" "),n("h3",{attrs:{id:"撰写文件v3-5及更高版本-🔗"}},[e._v("撰写文件v3.5及更高版本 "),n("a",{attrs:{href:"#compose-file-v35-and-above"}},[e._v("🔗")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("secrets:\n  my_first_secret:\n    file: ./secret_data\n  my_second_secret:\n    external: true\n    name: redis_secret\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br")])]),n("h3",{attrs:{id:"撰写文件v3-4和-🔗下"}},[e._v("撰写文件v3.4和 "),n("a",{attrs:{href:"#compose-file-v34-and-under"}},[e._v("🔗下")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("  my_second_secret:\n    external:\n      name: redis_secret\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("p",[e._v("您仍然需要向 堆栈中的每个服务 "),n("a",{attrs:{href:"#secrets"}},[e._v("授予对机密的访问权限")]),e._v(" 。")]),e._v(" "),n("h2",{attrs:{id:"变量替代-🔗"}},[e._v("变量替代 "),n("a",{attrs:{href:"#variable-substitution"}},[e._v("🔗")])]),e._v(" "),n("p",[e._v("您的配置选项可以包含环境变量。 Compose使用 "),n("code",[e._v("docker-compose")]),e._v(" 运行时所在 的Shell环境中的变量值 。 例如，假设外壳包含 "),n("code",[e._v("POSTGRES_VERSION=9.3")]),e._v(" 并提供以下配置：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('db:\n  image: "postgres:${POSTGRES_VERSION}"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("p",[e._v("当您运行 "),n("code",[e._v("docker-compose up")]),e._v(" 此配置，撰写外观为 "),n("code",[e._v("POSTGRES_VERSION")]),e._v(" 在外壳和替代它的价值的环境变量。在这个例子中，撰写解析 "),n("code",[e._v("image")]),e._v(" 到 "),n("code",[e._v("postgres:9.3")]),e._v(" 运行配置之前。")]),e._v(" "),n("p",[e._v("如果未设置环境变量，则Compose替换为空字符串。 在上面的示例中，如果 "),n("code",[e._v("POSTGRES_VERSION")]),e._v(" 未设置，则 "),n("code",[e._v("image")]),e._v(" 选项的值为 "),n("code",[e._v("postgres:")]),e._v(" 。")]),e._v(" "),n("p",[e._v("您可以使用 Compose自动查找 的 "),n("a",{attrs:{href:"https://docs.docker.com/compose/env-file/",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v(".env")]),e._v("文件"),n("OutboundLink")],1),e._v(" 为环境变量设置默认值 。 在shell环境中设置的值将覆盖 "),n("code",[e._v(".env")]),e._v(" 文件中 设置的值 。")]),e._v(" "),n("blockquote",[n("p",[e._v("使用docker stack deploy时的注意事项")]),e._v(" "),n("p",[e._v("该 "),n("code",[e._v(".env file")]),e._v(" 功能仅在使用 "),n("code",[e._v("docker-compose up")]),e._v(" 命令时有效，而不适用于 "),n("code",[e._v("docker stack deploy")]),e._v(" 。")])]),e._v(" "),n("p",[e._v("这两个 "),n("code",[e._v("$VARIABLE")]),e._v(" 和 "),n("code",[e._v("${VARIABLE}")]),e._v(" 语法的支持。 此外，当使用 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-21",target:"_blank",rel:"noopener noreferrer"}},[e._v("2.1文件格式时"),n("OutboundLink")],1),e._v(" ，可以使用典型的shell语法提供内联默认值：")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("${VARIABLE:-default}")]),e._v(" 计算环境中 "),n("code",[e._v("default")]),e._v(" 是否 "),n("code",[e._v("VARIABLE")]),e._v(" 未设置或为空。")]),e._v(" "),n("li",[n("code",[e._v("${VARIABLE-default}")]),e._v(" "),n("code",[e._v("default")]),e._v(" 仅 "),n("code",[e._v("VARIABLE")]),e._v(" 在环境中未设置时 评估为 。")])]),e._v(" "),n("p",[e._v("同样，以下语法允许您指定必需变量：")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("${VARIABLE:?err}")]),e._v(" 退出，并显示一条错误消息，其中包含 在环境 中 "),n("code",[e._v("err")]),e._v(" 是否 "),n("code",[e._v("VARIABLE")]),e._v(" 设置为 if 或为空。")]),e._v(" "),n("li",[n("code",[e._v("${VARIABLE?err}")]),e._v(" 退出，并显示一条错误消息，其中包含 在环境中未设置的 "),n("code",[e._v("err")]),e._v(" if "),n("code",[e._v("VARIABLE")]),e._v(" 。")])]),e._v(" "),n("p",[n("code",[e._v("${VARIABLE/foo/bar}")]),e._v(" 不支持 其他扩展的Shell样式功能，例如 。")]),e._v(" "),n("p",[n("code",[e._v("$$")]),e._v(" 当您的配置需要文字美元符号时， 可以使用 （双美元符号）。 这也可以防止Compose插值，因此a "),n("code",[e._v("$$")]),e._v(" 允许您引用您不想由Compose处理的环境变量。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('web:\n  build: .\n  command: "$$VAR_NOT_INTERPOLATED_BY_COMPOSE"\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("p",[e._v("如果忘记并使用单个美元符号（ "),n("code",[e._v("$")]),e._v(" ），则Compose会将值解释为环境变量，并警告您：")]),e._v(" "),n("p",[e._v("未设置VAR_NOT_INTERPOLATED_BY_COMPOSE。 替换为空字符串。")]),e._v(" "),n("h2",{attrs:{id:"扩展字段-🔗"}},[e._v("扩展字段 "),n("a",{attrs:{href:"#extension-fields"}},[e._v("🔗")])]),e._v(" "),n("blockquote",[n("p",[e._v("以 "),n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/#version-34",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.4版"),n("OutboundLink")],1),e._v(" 文件格式 添加 。")])]),e._v(" "),n("p",[e._v("可以使用扩展字段重新使用配置片段。 这些特殊字段可以位于任意格式，只要它们位于Compose文件的根目录中并且其名称以 "),n("code",[e._v("x-")]),e._v(" 字符序列 开头即可 。")]),e._v(" "),n("blockquote",[n("p",[n("strong",[e._v("注意")])]),e._v(" "),n("p",[e._v("从3.7格式（对于3.x系列）和2.4格式（对于2.x系列）开始，扩展字段也可以在服务，卷，网络，配置和密码定义的根目录中使用。")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("version: '3.4'\nx-custom:\n  items:\n    - a\n    - b\n  options:\n    max-size: '12m'\n  name: \"custom\"\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br")])]),n("p",[e._v("这些字段的内容被Compose忽略，但是可以使用 "),n("a",{attrs:{href:"http://www.yaml.org/spec/1.2/spec.html#id2765878",target:"_blank",rel:"noopener noreferrer"}},[e._v("YAML锚点"),n("OutboundLink")],1),e._v(" 将其插入资源定义中 。 例如，如果您希望多个服务使用相同的日志记录配置：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("logging:\n  options:\n    max-size: '12m'\n    max-file: '5'\n  driver: json-file\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("您可以按如下方式编写Compose文件：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("version: '3.4'\nx-logging:\n  &default-logging\n  options:\n    max-size: '12m'\n    max-file: '5'\n  driver: json-file\n\nservices:\n  web:\n    image: myapp/web:latest\n    logging: *default-logging\n  db:\n    image: mysql:latest\n    logging: *default-logging\n\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br")])]),n("p",[e._v("也可以使用 "),n("a",{attrs:{href:"http://yaml.org/type/merge.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("YAML合并类型"),n("OutboundLink")],1),e._v(" 部分覆盖扩展字段中的值 。 例如：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('version: \'3.4\'\nx-volumes:\n  &default-volume\n  driver: foobar-storage\n\nservices:\n  web:\n    image: myapp/web:latest\n    volumes: ["vol1", "vol2", "vol3"]\nvolumes:\n  vol1: *default-volume\n  vol2:\n    << : *default-volume\n    name: volume02\n  vol3:\n    << : *default-volume\n    driver: default\n    name: volume-local\n\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br")])]),n("h2",{attrs:{id:"撰写文档-🔗"}},[e._v("撰写文档 "),n("a",{attrs:{href:"#compose-documentation"}},[e._v("🔗")])]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://docs.docker.com/compose/",target:"_blank",rel:"noopener noreferrer"}},[e._v("用户指南"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://docs.docker.com/compose/install/",target:"_blank",rel:"noopener noreferrer"}},[e._v("安装撰写"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/",target:"_blank",rel:"noopener noreferrer"}},[e._v("撰写文件版本和升级"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://docs.docker.com/samples/",target:"_blank",rel:"noopener noreferrer"}},[e._v("样品"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://docs.docker.com/compose/reference/",target:"_blank",rel:"noopener noreferrer"}},[e._v("命令行参考"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=r.exports}}]);