(window.webpackJsonp=window.webpackJsonp||[]).push([[156],{390:function(e,s,n){"use strict";n.r(s);var a=n(25),t=Object(a.a)({},(function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("blockquote",[n("p",[e._v("本章讲的大概能让你明白虚拟机和 docker 的区别...")])]),e._v(" "),n("p",[e._v("docker 设置了两种构建镜像的方式:")]),e._v(" "),n("h3",{attrs:{id:"通过-docker-commit-构建镜像-不推荐"}},[e._v("通过 docker commit 构建镜像(不推荐)")]),e._v(" "),n("p",[e._v("这个命令是将先有的容器制作成镜像, 不过建议仅用在排查问题的时候使用, 平时生成容器时最好不要用这种镜像, 因为不知道里面有什么改动, 对于开发者来说完全是一个黑盒")]),e._v(" "),n("p",[e._v("命令格式:")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("docker commit [参数] <容器 ID 或 容器名> [仓库名[:标签]] [flags]\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("比如(我随便找了一个本地容器 ID):")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('➜  ~ docker commit -m "这是一个测试镜像" -a "GPF" 5ad06ec670eb local_nginx:v1\nsha256:134e09cdce58842dea03202aa5b6516ead8268afe78d2203be8595b4f0bc5ebe\n➜  ~ docker images\nREPOSITORY              TAG                    IMAGE ID            CREATED             SIZE\nlocal_nginx             v1                     134e09cdce58        2 seconds ago       109MB\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("p",[e._v("这就把当前的容器转换成了镜像, 提交到远程就是:")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("docker push local_nginx:v1\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("和"),n("code",[e._v("git")]),e._v("很像对不对? 不过推送到远程时需要有个 "),n("a",{attrs:{href:"https://hub.docker.com/_/php/",target:"_blank",rel:"noopener noreferrer"}},[e._v("dockerhub"),n("OutboundLink")],1),e._v(" 的账号")]),e._v(" "),n("p",[n("code",[e._v("docker history")]),e._v(" 命令可以查看镜像的构建记录")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('➜  ~ docker history 134e09cdce58\nIMAGE               CREATED             CREATED BY                                      SIZE                COMMENT\n134e09cdce58        12 seconds ago      nginx -g daemon off;                            0B                  这是一个测试镜像\n649dcb69b782        4 days ago          /bin/sh -c #(nop)  CMD ["nginx" "-g" "daemon…   0B\n<missing>           4 days ago          /bin/sh -c #(nop)  STOPSIGNAL [SIGTERM]         0B\n<missing>           4 days ago          /bin/sh -c #(nop)  EXPOSE 80/tcp                0B\n<missing>           4 days ago          /bin/sh -c ln -sf /dev/stdout /var/log/nginx…   22B\n<missing>           4 days ago          /bin/sh -c set -x  && apt-get update  && apt…   53.7MB\n<missing>           4 days ago          /bin/sh -c #(nop)  ENV NJS_VERSION=1.15.1.0.…   0B\n<missing>           4 days ago          /bin/sh -c #(nop)  ENV NGINX_VERSION=1.15.1-…   0B\n<missing>           11 days ago         /bin/sh -c #(nop)  LABEL maintainer=NGINX Do…   0B\n<missing>           11 days ago         /bin/sh -c #(nop)  CMD ["bash"]                 0B\n<missing>           11 days ago         /bin/sh -c #(nop) ADD file:28fbc9fd012eef727…   55.3MB\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br")])]),n("h3",{attrs:{id:"通过-dockerfile-构建镜像"}},[e._v("通过 Dockerfile 构建镜像")]),e._v(" "),n("p",[e._v("一个 Dockerfile 就是一个构建镜像的脚本, 常用的几个命令也不多, 也就"),n("code",[e._v("FROM")]),e._v(", "),n("code",[e._v("COPY")]),e._v(", "),n("code",[e._v("RUN")]),e._v(", "),n("code",[e._v("ADD")]),e._v(", "),n("code",[e._v("ARG")]),e._v(", "),n("code",[e._v("ENV")]),e._v(", "),n("code",[e._v("VOLUME")]),e._v(", "),n("code",[e._v("EXPOSE")]),e._v(", "),n("code",[e._v("CMD")]),e._v(", "),n("code",[e._v("LABEL")]),e._v(", 其他的一些命令就不再这里说了, 想了解完整的 Dockerfile 的关键词看这个 "),n("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/#usage",target:"_blank",rel:"noopener noreferrer"}},[e._v("Dockerfile reference"),n("OutboundLink")],1)]),e._v(" "),n("h4",{attrs:{id:"一个简单的-demo"}},[e._v("一个简单的 demo")]),e._v(" "),n("p",[e._v("接下来我们就用一个完整的 Dockerfile 来示范一下:")]),e._v(" "),n("p",[e._v("首先创建一个Dockerfile")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("mkdir dockerfile_demo && cd dockerfile_demo\nvi Dockerfile\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("# dockerfile 内容\n\n# 继承的 ubuntu 镜像的版本号\nFROM ubuntu:16.04\n# 将本地 workdir 的文件复制到镜像内部, 另外有个 ADD 指令和这个效果类似, 不过不推荐使用\nCOPY ./sources.list /etc/apt/sources.list\n# 在镜像内部执行命令, 这里就是更新版本和安装 nginx\nRUN apt-get update && apt-get install -y nginx\n# 修改 nginx 默认的 index.html 的内容\nRUN echo 'Hi, I am in your container'\\\n    >/var/www/html/index.html\n# 镜像对外暴露80端口\nEXPOSE 80\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br")])]),n("p",[e._v("然后为了更新速度快一点, 就要换一个国内镜像")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("vi sources.list\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("# sources.list 内容\n\ndeb http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-proposed main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ xenial-proposed main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br")])]),n("p",[e._v("然后还是在这个目录下, 运行:")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("docker build ./ -t local_ubuntu_nginx:v2\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("执行完毕后就能看到本地多了一个镜像")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("➜  Documents docker images\nREPOSITORY              TAG                    IMAGE ID            CREATED             SIZE\nlocal_ubuntu_nginx      v2                     b0f5984c042a        14 minutes ago      214MB\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("p",[e._v("用这个镜像构建一个容器:")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("➜  Documents docker run -it --rm -p 8088:80 local_ubuntu_nginx:v2 /bin/bash\nroot@5cb9ff723bee:/# /usr/sbin/nginx\nroot@5cb9ff723bee:/#\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br")])]),n("p",[e._v("保持终端打开, 本地访问 "),n("code",[e._v("http://localhost:8088/")]),e._v(" 就能看到欢迎界面了")]),e._v(" "),n("p",[e._v("如果这个是关闭交互端口, 这个就访问不到了, 这里要说一个"),n("strong",[e._v("关键点")]),e._v("了")]),e._v(" "),n("blockquote",[n("p",[e._v("在 docker 中运行的程序不能使用后台运行的模式, 否则 docker 会任务这个容器不活跃或出现问题而自动关闭\n但是 docker 容器本身是可以后台运行的: docker run -d ......")])]),e._v(" "),n("h4",{attrs:{id:"关于-docker-build-多说一句"}},[e._v("关于 docker build 多说一句")]),e._v(" "),n("p",[e._v("之前我们构建时执行的:")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("docker build ./ -t local_ubuntu_nginx:v2\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("这个 "),n("code",[e._v("./")]),e._v(" 的路径指的是构建文本流(context)的路径, 而不是 "),n("code",[e._v("Dockerfile")]),e._v("的文件路径, 在 "),n("code",[e._v("Dockerfile")]),e._v(" 中用的各种相对路径都是基于 "),n("code",[e._v("context")]),e._v(" 的,我们完全可以是")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("docker build /path/to/context -f /path/to/anywhere/Dockerfile_demo -t local_ubuntu_nginx\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("你看, Dockerfile 的文件名不就变成 "),n("code",[e._v("Dockerfile_demo")]),e._v(" 了, 如果有")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("COPY ./sources.list /etc/apt/sources.list\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("这样的操作, 那么它的完整路径应该是 "),n("code",[e._v("/path/to/context/sources.list")]),e._v(", 不过默认的情况下就是这两个路径是一起的, 不设置镜像"),n("code",[e._v("tag")]),e._v("的话就拿 Dockerfile 所在的目录名为镜像名,默认"),n("code",[e._v("latest")]),e._v("版本")]),e._v(" "),n("h3",{attrs:{id:"多阶段构建"}},[e._v("多阶段构建")]),e._v(" "),n("p",[e._v("有时候我们的运行环境和编译环境是两回事, 就拿 golang 来举例, 我们只会去维护代码, 而不去管它生成的二进制包是什么, 又因为golang 打包出来的二进制文件几乎是没有依赖, 只要执行这个文件就行, 那么在运行环境中和编译相关的程序就是多余的, 可以看一下官网的示例 "),n("a",{attrs:{href:"https://docs.docker.com/develop/develop-images/multistage-build/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Use multi-stage builds"),n("OutboundLink")],1),e._v(", 不能翻墙的看这个")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('FROM golang:1.7.3\nWORKDIR /go/src/github.com/alexellis/href-counter/\nRUN go get -d -v golang.org/x/net/html\nCOPY app.go .\nRUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app .\n\nFROM alpine:latest\nRUN apk --no-cache add ca-certificates\nWORKDIR /root/\n# 这个是关键, --from=0 是指从第一个镜像(from)中复制内容, 程序中的1 就是0\nCOPY --from=0 /go/src/github.com/alexellis/href-counter/app .\nCMD ["./app"]\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$ docker build -t alexellis2/href-counter:latest .\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("这是我自己构建镜像时编译 "),n("code",[e._v("swoole.so")]),e._v(" 的镜像和运行时的镜像大小\n"),n("img",{attrs:{src:"https://segmentfault.com/img/remote/1460000015591871",alt:"docker-images",title:"docker-images"}}),e._v("\n我们只想要一个 "),n("code",[e._v("swoole.so")]),e._v(" 像 "),n("code",[e._v("gcc")]),e._v(", "),n("code",[e._v("make")]),e._v(" 都是不是代码运行时需要的模块, 因此只是在编译的时候用上, 吐一个"),n("code",[e._v("swoole.so")]),e._v("出来就行, "),n("a",{attrs:{href:"https://github.com/gayhuber/dnmp/tree/master/php-cli",target:"_blank",rel:"noopener noreferrer"}},[e._v("相关代码"),n("OutboundLink")],1)]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('FROM php:5.6.36-cli-alpine3.7 as builder\n\n# 中国特色\nRUN echo "http://mirrors.ustc.edu.cn/alpine/v3.7/main/" > /etc/apk/repositories\n\n# 添加编译 swoole 需要的前置插件\nRUN apk update && \\\n    apk upgrade && \\\n    apk add alpine-sdk linux-headers && \\\n    apk add autoconf gcc make\n\nRUN wget https://github.com/swoole/swoole-src/archive/1.8.12-stable.tar.gz && \\\n    tar zxvf 1.8.12-stable.tar.gz && \\\n    cd swoole-src-1.8.12-stable && \\\n    phpize && \\\n    ./configure && \\\n    make && make install\n\nFROM php:5.6.36-cli-alpine3.7 as runtimer\n\n# 这里因为给每一个阶段加了别名, 这样更方便一点\nCOPY --from=builder /usr/local/lib/php/extensions/no-debug-non-zts-20131226/swoole.so /usr/local/lib/php/extensions/no-debug-non-zts-20131226/swoole.so\n\nCOPY ./swoole.ini /usr/local/etc/php/conf.d/swoole.ini\n\n# 通常 run 是构建镜像时用的, 会保存一层缓存, cmd 就是镜像启动后执行的命令\nRUN ["php", "-m"]\nCMD ["php", "-a"]\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br"),n("span",{staticClass:"line-number"},[e._v("27")]),n("br"),n("span",{staticClass:"line-number"},[e._v("28")]),n("br")])]),n("h3",{attrs:{id:"构建镜像时需要注意的几点"}},[e._v("构建镜像时需要注意的几点")]),e._v(" "),n("ol",[n("li",[n("p",[e._v("尽量使用官方镜像, 同时版本选择 "),n("code",[e._v("alpine > debian > ubuntu > centos")]),e._v(", "),n("code",[e._v("alpine")]),e._v("版本的镜像是最小的")])]),e._v(" "),n("li",[n("p",[e._v("COPY 和 ADD 尽量使用 COPY, COPY 只是单纯的复制, ADD 则会自动执行一些东西, 有可能出现意料外的问题")])]),e._v(" "),n("li",[n("p",[e._v("CMD 和 ENTERPOINT 这两个可以查一下区别, 我个人习惯用 CMD")])]),e._v(" "),n("li",[n("p",[e._v("容器中的程序都要前台执行的模式, 使用 daemon 模式会被退出(你想想本身一个后台运行的容器中有个后台运行的程序...)")])]),e._v(" "),n("li",[n("p",[e._v("每一个 "),n("code",[e._v("RUN")]),e._v(" 指令就是一层缓存, 当其中一个步骤发生更改那么这之后的步骤也都重新构建")])]),e._v(" "),n("li",[n("p",[e._v("系统更新最好合成一个 RUN 比如:")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("RUN apk update && \\\n    apk upgrade && \\\n    apk add alpine-sdk linux-headers && \\\n    apk add autoconf gcc make\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("p",[e._v("同样还是为了避免因为缓存时出现问题")])]),e._v(" "),n("li",[n("p",[e._v("多看看官方构建的镜像, 收获会很多, 比如 "),n("a",{attrs:{href:"https://github.com/nginxinc/docker-nginx/tree/e3e35236b2c77e02266955c875b74bdbceb79c44/stable",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker-nginx"),n("OutboundLink")],1),e._v(", "),n("a",{attrs:{href:"https://github.com/docker-library/php/tree/4af0a8734a48ab84ee96de513aabc45418b63dc5",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker-php"),n("OutboundLink")],1)])])]),e._v(" "),n("h4",{attrs:{id:"相关"}},[e._v("相关")]),e._v(" "),n("ol",[n("li",[n("a",{attrs:{href:"https://segmentfault.com/a/1190000015591809",target:"_blank",rel:"noopener noreferrer"}},[e._v("不正宗 Docker 入门教程-启动一个容器(1/3)"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://segmentfault.com/a/1190000015591868",target:"_blank",rel:"noopener noreferrer"}},[e._v("不正宗 Docker 入门教程-构建一个镜像(2/3)"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://segmentfault.com/a/1190000015706722",target:"_blank",rel:"noopener noreferrer"}},[e._v("不正宗 Docker 入门教程-使用 Docker-Compose (3/3)"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=t.exports}}]);