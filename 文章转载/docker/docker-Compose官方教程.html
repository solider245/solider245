<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>docker-Composeå®˜æ–¹æ•™ç¨‹ | å´èµ·çš„ä¸ªäººç½‘ç«™</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="https://images-1255533533.cos.ap-shanghai.myqcloud.com/20190817214528_05c52e04cf64654248918bfc2a1f64ab.png">
    <link rel="manifest" href="/VuePress-blog/manifest.json">
    <link rel="apple-touch-icon" href="/VuePress-blog/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/VuePress-blog/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="docker composeå®˜æ–¹æ•™ç¨‹">
    <meta name="author" content="ä¸­ç®­çš„å´èµ·">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/VuePress-blog/assets/css/0.styles.f7cbc213.css" as="style"><link rel="preload" href="/VuePress-blog/assets/js/app.e4354aa1.js" as="script"><link rel="preload" href="/VuePress-blog/assets/js/2.398f4283.js" as="script"><link rel="preload" href="/VuePress-blog/assets/js/152.3c509f41.js" as="script"><link rel="prefetch" href="/VuePress-blog/assets/js/10.f88a1831.js"><link rel="prefetch" href="/VuePress-blog/assets/js/100.618f4056.js"><link rel="prefetch" href="/VuePress-blog/assets/js/101.b170cbee.js"><link rel="prefetch" href="/VuePress-blog/assets/js/102.8cd82e5b.js"><link rel="prefetch" href="/VuePress-blog/assets/js/103.a9e55775.js"><link rel="prefetch" href="/VuePress-blog/assets/js/104.2b910c17.js"><link rel="prefetch" href="/VuePress-blog/assets/js/105.badde638.js"><link rel="prefetch" href="/VuePress-blog/assets/js/106.cabb5a4b.js"><link rel="prefetch" href="/VuePress-blog/assets/js/107.55916750.js"><link rel="prefetch" href="/VuePress-blog/assets/js/108.a894756d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/109.665bfa12.js"><link rel="prefetch" href="/VuePress-blog/assets/js/11.82bfc211.js"><link rel="prefetch" href="/VuePress-blog/assets/js/110.82d9d03d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/111.a3bf7bb5.js"><link rel="prefetch" href="/VuePress-blog/assets/js/112.308d5801.js"><link rel="prefetch" href="/VuePress-blog/assets/js/113.aaf33f56.js"><link rel="prefetch" href="/VuePress-blog/assets/js/114.896dc3c8.js"><link rel="prefetch" href="/VuePress-blog/assets/js/115.33bf424e.js"><link rel="prefetch" href="/VuePress-blog/assets/js/116.6a8b1073.js"><link rel="prefetch" href="/VuePress-blog/assets/js/117.00678fec.js"><link rel="prefetch" href="/VuePress-blog/assets/js/118.6bc9e989.js"><link rel="prefetch" href="/VuePress-blog/assets/js/119.31a2372f.js"><link rel="prefetch" href="/VuePress-blog/assets/js/12.f528b4f1.js"><link rel="prefetch" href="/VuePress-blog/assets/js/120.d1bd65a5.js"><link rel="prefetch" href="/VuePress-blog/assets/js/121.6ff9895f.js"><link rel="prefetch" href="/VuePress-blog/assets/js/122.f80812c8.js"><link rel="prefetch" href="/VuePress-blog/assets/js/123.457af999.js"><link rel="prefetch" href="/VuePress-blog/assets/js/124.a62fbdae.js"><link rel="prefetch" href="/VuePress-blog/assets/js/125.8d1225d4.js"><link rel="prefetch" href="/VuePress-blog/assets/js/126.9e329698.js"><link rel="prefetch" href="/VuePress-blog/assets/js/127.e3eac40d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/128.73562074.js"><link rel="prefetch" href="/VuePress-blog/assets/js/129.7dc75ed6.js"><link rel="prefetch" href="/VuePress-blog/assets/js/13.0c9fc526.js"><link rel="prefetch" href="/VuePress-blog/assets/js/130.282ea90d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/131.948f43a2.js"><link rel="prefetch" href="/VuePress-blog/assets/js/132.aa7a4d25.js"><link rel="prefetch" href="/VuePress-blog/assets/js/133.0608bab7.js"><link rel="prefetch" href="/VuePress-blog/assets/js/134.4a1bb517.js"><link rel="prefetch" href="/VuePress-blog/assets/js/135.2449e034.js"><link rel="prefetch" href="/VuePress-blog/assets/js/136.018a7818.js"><link rel="prefetch" href="/VuePress-blog/assets/js/137.c586e53d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/138.5b043595.js"><link rel="prefetch" href="/VuePress-blog/assets/js/139.f535affe.js"><link rel="prefetch" href="/VuePress-blog/assets/js/14.d9747bc8.js"><link rel="prefetch" href="/VuePress-blog/assets/js/140.b1f108ce.js"><link rel="prefetch" href="/VuePress-blog/assets/js/141.ce586450.js"><link rel="prefetch" href="/VuePress-blog/assets/js/142.7f88da6d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/143.d3ce1076.js"><link rel="prefetch" href="/VuePress-blog/assets/js/144.b924a878.js"><link rel="prefetch" href="/VuePress-blog/assets/js/145.8f4496ac.js"><link rel="prefetch" href="/VuePress-blog/assets/js/146.f77f5ae7.js"><link rel="prefetch" href="/VuePress-blog/assets/js/147.8892e259.js"><link rel="prefetch" href="/VuePress-blog/assets/js/148.ac76523d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/149.036ba33d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/15.0ec2a8ee.js"><link rel="prefetch" href="/VuePress-blog/assets/js/150.ec99cda4.js"><link rel="prefetch" href="/VuePress-blog/assets/js/151.6b1887cc.js"><link rel="prefetch" href="/VuePress-blog/assets/js/153.470b653b.js"><link rel="prefetch" href="/VuePress-blog/assets/js/154.d79fdff7.js"><link rel="prefetch" href="/VuePress-blog/assets/js/155.42fb4d54.js"><link rel="prefetch" href="/VuePress-blog/assets/js/156.ce6ca9d0.js"><link rel="prefetch" href="/VuePress-blog/assets/js/157.5da875cb.js"><link rel="prefetch" href="/VuePress-blog/assets/js/158.95349a8a.js"><link rel="prefetch" href="/VuePress-blog/assets/js/159.c6d5d3f6.js"><link rel="prefetch" href="/VuePress-blog/assets/js/16.96972e23.js"><link rel="prefetch" href="/VuePress-blog/assets/js/160.fd6be3d0.js"><link rel="prefetch" href="/VuePress-blog/assets/js/161.645951a6.js"><link rel="prefetch" href="/VuePress-blog/assets/js/162.f91af681.js"><link rel="prefetch" href="/VuePress-blog/assets/js/163.4ff37798.js"><link rel="prefetch" href="/VuePress-blog/assets/js/164.0ab0411b.js"><link rel="prefetch" href="/VuePress-blog/assets/js/165.fb3e31ca.js"><link rel="prefetch" href="/VuePress-blog/assets/js/166.0e89f139.js"><link rel="prefetch" href="/VuePress-blog/assets/js/167.6910f6cf.js"><link rel="prefetch" href="/VuePress-blog/assets/js/168.dba298af.js"><link rel="prefetch" href="/VuePress-blog/assets/js/169.c8da94cc.js"><link rel="prefetch" href="/VuePress-blog/assets/js/17.06889e54.js"><link rel="prefetch" href="/VuePress-blog/assets/js/170.dfc7fbab.js"><link rel="prefetch" href="/VuePress-blog/assets/js/171.75cc843a.js"><link rel="prefetch" href="/VuePress-blog/assets/js/172.3a98f4d2.js"><link rel="prefetch" href="/VuePress-blog/assets/js/173.25f0a60f.js"><link rel="prefetch" href="/VuePress-blog/assets/js/18.db5ae82d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/19.4055eeb9.js"><link rel="prefetch" href="/VuePress-blog/assets/js/20.0b68f787.js"><link rel="prefetch" href="/VuePress-blog/assets/js/21.64b18850.js"><link rel="prefetch" href="/VuePress-blog/assets/js/22.a548f3c5.js"><link rel="prefetch" href="/VuePress-blog/assets/js/23.04a0e73a.js"><link rel="prefetch" href="/VuePress-blog/assets/js/24.109f764e.js"><link rel="prefetch" href="/VuePress-blog/assets/js/25.7fa1c42f.js"><link rel="prefetch" href="/VuePress-blog/assets/js/26.cfaf31c5.js"><link rel="prefetch" href="/VuePress-blog/assets/js/27.ebbc7ee9.js"><link rel="prefetch" href="/VuePress-blog/assets/js/28.51f27455.js"><link rel="prefetch" href="/VuePress-blog/assets/js/29.34168ce5.js"><link rel="prefetch" href="/VuePress-blog/assets/js/3.9fb4597b.js"><link rel="prefetch" href="/VuePress-blog/assets/js/30.96e95f78.js"><link rel="prefetch" href="/VuePress-blog/assets/js/31.63fbbffa.js"><link rel="prefetch" href="/VuePress-blog/assets/js/32.649cbad2.js"><link rel="prefetch" href="/VuePress-blog/assets/js/33.f7e81235.js"><link rel="prefetch" href="/VuePress-blog/assets/js/34.ca4331e1.js"><link rel="prefetch" href="/VuePress-blog/assets/js/35.0b860b77.js"><link rel="prefetch" href="/VuePress-blog/assets/js/36.d2f4ba78.js"><link rel="prefetch" href="/VuePress-blog/assets/js/37.c2877be5.js"><link rel="prefetch" href="/VuePress-blog/assets/js/38.b345c513.js"><link rel="prefetch" href="/VuePress-blog/assets/js/39.0a91f037.js"><link rel="prefetch" href="/VuePress-blog/assets/js/4.7fa94338.js"><link rel="prefetch" href="/VuePress-blog/assets/js/40.3540778f.js"><link rel="prefetch" href="/VuePress-blog/assets/js/41.b4236deb.js"><link rel="prefetch" href="/VuePress-blog/assets/js/42.c525cdf5.js"><link rel="prefetch" href="/VuePress-blog/assets/js/43.57682d62.js"><link rel="prefetch" href="/VuePress-blog/assets/js/44.bf75d21a.js"><link rel="prefetch" href="/VuePress-blog/assets/js/45.9b8489e6.js"><link rel="prefetch" href="/VuePress-blog/assets/js/46.e142d725.js"><link rel="prefetch" href="/VuePress-blog/assets/js/47.f5eec595.js"><link rel="prefetch" href="/VuePress-blog/assets/js/48.745b0e5d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/49.86bf2483.js"><link rel="prefetch" href="/VuePress-blog/assets/js/5.587b09c2.js"><link rel="prefetch" href="/VuePress-blog/assets/js/50.b05cd91e.js"><link rel="prefetch" href="/VuePress-blog/assets/js/51.1c8e588d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/52.fa48d599.js"><link rel="prefetch" href="/VuePress-blog/assets/js/53.2b6a2ab1.js"><link rel="prefetch" href="/VuePress-blog/assets/js/54.eb443023.js"><link rel="prefetch" href="/VuePress-blog/assets/js/55.bf5c3551.js"><link rel="prefetch" href="/VuePress-blog/assets/js/56.ce341c9a.js"><link rel="prefetch" href="/VuePress-blog/assets/js/57.329c792a.js"><link rel="prefetch" href="/VuePress-blog/assets/js/58.1321afa7.js"><link rel="prefetch" href="/VuePress-blog/assets/js/59.fe23f6db.js"><link rel="prefetch" href="/VuePress-blog/assets/js/6.6fd5799c.js"><link rel="prefetch" href="/VuePress-blog/assets/js/60.0320d1d5.js"><link rel="prefetch" href="/VuePress-blog/assets/js/61.c4846f1c.js"><link rel="prefetch" href="/VuePress-blog/assets/js/62.ff70299a.js"><link rel="prefetch" href="/VuePress-blog/assets/js/63.41cc17ab.js"><link rel="prefetch" href="/VuePress-blog/assets/js/64.082d9540.js"><link rel="prefetch" href="/VuePress-blog/assets/js/65.1c25d870.js"><link rel="prefetch" href="/VuePress-blog/assets/js/66.7014dd6b.js"><link rel="prefetch" href="/VuePress-blog/assets/js/67.71c256c6.js"><link rel="prefetch" href="/VuePress-blog/assets/js/68.90d240a2.js"><link rel="prefetch" href="/VuePress-blog/assets/js/69.5047f2f6.js"><link rel="prefetch" href="/VuePress-blog/assets/js/7.6ba377b6.js"><link rel="prefetch" href="/VuePress-blog/assets/js/70.be70817b.js"><link rel="prefetch" href="/VuePress-blog/assets/js/71.1c9efc31.js"><link rel="prefetch" href="/VuePress-blog/assets/js/72.b3eb16bb.js"><link rel="prefetch" href="/VuePress-blog/assets/js/73.b72b7959.js"><link rel="prefetch" href="/VuePress-blog/assets/js/74.bb6bdbfd.js"><link rel="prefetch" href="/VuePress-blog/assets/js/75.18b81eb3.js"><link rel="prefetch" href="/VuePress-blog/assets/js/76.fc2302e3.js"><link rel="prefetch" href="/VuePress-blog/assets/js/77.c0bd9e33.js"><link rel="prefetch" href="/VuePress-blog/assets/js/78.c339860d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/79.23c005e6.js"><link rel="prefetch" href="/VuePress-blog/assets/js/8.7a42445d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/80.838feb78.js"><link rel="prefetch" href="/VuePress-blog/assets/js/81.1b93e8a9.js"><link rel="prefetch" href="/VuePress-blog/assets/js/82.13eb4655.js"><link rel="prefetch" href="/VuePress-blog/assets/js/83.201aba60.js"><link rel="prefetch" href="/VuePress-blog/assets/js/84.ac1d8d4d.js"><link rel="prefetch" href="/VuePress-blog/assets/js/85.dd526c02.js"><link rel="prefetch" href="/VuePress-blog/assets/js/86.1ff01b81.js"><link rel="prefetch" href="/VuePress-blog/assets/js/87.668a3110.js"><link rel="prefetch" href="/VuePress-blog/assets/js/88.1a20f59b.js"><link rel="prefetch" href="/VuePress-blog/assets/js/89.da33bb07.js"><link rel="prefetch" href="/VuePress-blog/assets/js/9.053b461b.js"><link rel="prefetch" href="/VuePress-blog/assets/js/90.4ec9f95f.js"><link rel="prefetch" href="/VuePress-blog/assets/js/91.818e056a.js"><link rel="prefetch" href="/VuePress-blog/assets/js/92.3fe61856.js"><link rel="prefetch" href="/VuePress-blog/assets/js/93.458534e9.js"><link rel="prefetch" href="/VuePress-blog/assets/js/94.8849d84e.js"><link rel="prefetch" href="/VuePress-blog/assets/js/95.be1f911a.js"><link rel="prefetch" href="/VuePress-blog/assets/js/96.295835c7.js"><link rel="prefetch" href="/VuePress-blog/assets/js/97.6cb68243.js"><link rel="prefetch" href="/VuePress-blog/assets/js/98.056edaa4.js"><link rel="prefetch" href="/VuePress-blog/assets/js/99.34645cba.js">
    <link rel="stylesheet" href="/VuePress-blog/assets/css/0.styles.f7cbc213.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/VuePress-blog/" class="home-link router-link-active"><!----> <span class="site-name">å´èµ·çš„ä¸ªäººç½‘ç«™</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ–‡ç« è½¬è½½" class="dropdown-title"><span class="title">æ–‡ç« è½¬è½½</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VuePress-blog/æ–‡ç« è½¬è½½/" class="nav-link">
  é¦–é¡µ
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/æ–‡ç« è½¬è½½/Linuxå¸¸è§å‘½ä»¤/" class="nav-link">
  Linuxå¸¸è§å‘½ä»¤
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/æ–‡ç« è½¬è½½/Linuxå¸¸ç”¨è½¯ä»¶/" class="nav-link">
  Linuxå¸¸ç”¨è½¯ä»¶
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><h4>
          Vim
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/Vim/vimæ–‡ç« /" class="nav-link">
  vimæ–‡ç« 
</a></li><li class="dropdown-subitem"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/Vim/vimé…ç½®/" class="nav-link">
  vimé…ç½®
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å¸¸è§é—®é¢˜" class="dropdown-title"><span class="title">å¸¸è§é—®é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VuePress-blog/å¸¸è§é—®é¢˜/å®¢æˆ·ç«¯ç§‘å­¦ä¸Šç½‘/" class="nav-link">
  å®¢æˆ·ç«¯ç§‘å­¦ä¸Šç½‘
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/å¸¸è§é—®é¢˜/å‘½ä»¤è¡Œç§‘å­¦ä¸Šç½‘/" class="nav-link">
  å‘½ä»¤è¡Œç§‘å­¦ä¸Šç½‘
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/å¸¸è§é—®é¢˜/é•œåƒåŠ é€Ÿå¤§å…¨/" class="nav-link">
  é•œåƒåŠ é€Ÿå¤§å…¨
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/å¸¸è§é—®é¢˜/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/å¸¸è§é—®é¢˜/vim/" class="nav-link">
  vim
</a></li><li class="dropdown-item"><h4>
          Pyhton
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/VuePress-blog/å¸¸è§é—®é¢˜/Python/" class="nav-link">
  Pyhton
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="python" class="dropdown-title"><span class="title">python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VuePress-blog/Python/" class="nav-link">
  é¦–é¡µ
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/Python/æœ€æ–°è½¬è½½/" class="nav-link">
  æœ€æ–°è½¬è½½
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/Python/çˆ¬è™«æ¡ˆä¾‹/" class="nav-link">
  çˆ¬è™«æ¡ˆä¾‹
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸ªäººåŸåˆ›" class="dropdown-title"><span class="title">ä¸ªäººåŸåˆ›</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VuePress-blog/ä¸ªäººåŸåˆ›/" class="nav-link">
  ä¸ªäººåŸåˆ›
</a></li></ul></div></div> <a href="https://github.com/solider245/VuePress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Repo
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ–‡ç« è½¬è½½" class="dropdown-title"><span class="title">æ–‡ç« è½¬è½½</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VuePress-blog/æ–‡ç« è½¬è½½/" class="nav-link">
  é¦–é¡µ
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/æ–‡ç« è½¬è½½/Linuxå¸¸è§å‘½ä»¤/" class="nav-link">
  Linuxå¸¸è§å‘½ä»¤
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/æ–‡ç« è½¬è½½/Linuxå¸¸ç”¨è½¯ä»¶/" class="nav-link">
  Linuxå¸¸ç”¨è½¯ä»¶
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><h4>
          Vim
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/Vim/vimæ–‡ç« /" class="nav-link">
  vimæ–‡ç« 
</a></li><li class="dropdown-subitem"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/Vim/vimé…ç½®/" class="nav-link">
  vimé…ç½®
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å¸¸è§é—®é¢˜" class="dropdown-title"><span class="title">å¸¸è§é—®é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VuePress-blog/å¸¸è§é—®é¢˜/å®¢æˆ·ç«¯ç§‘å­¦ä¸Šç½‘/" class="nav-link">
  å®¢æˆ·ç«¯ç§‘å­¦ä¸Šç½‘
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/å¸¸è§é—®é¢˜/å‘½ä»¤è¡Œç§‘å­¦ä¸Šç½‘/" class="nav-link">
  å‘½ä»¤è¡Œç§‘å­¦ä¸Šç½‘
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/å¸¸è§é—®é¢˜/é•œåƒåŠ é€Ÿå¤§å…¨/" class="nav-link">
  é•œåƒåŠ é€Ÿå¤§å…¨
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/å¸¸è§é—®é¢˜/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/å¸¸è§é—®é¢˜/vim/" class="nav-link">
  vim
</a></li><li class="dropdown-item"><h4>
          Pyhton
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/VuePress-blog/å¸¸è§é—®é¢˜/Python/" class="nav-link">
  Pyhton
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="python" class="dropdown-title"><span class="title">python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VuePress-blog/Python/" class="nav-link">
  é¦–é¡µ
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/Python/æœ€æ–°è½¬è½½/" class="nav-link">
  æœ€æ–°è½¬è½½
</a></li><li class="dropdown-item"><!----> <a href="/VuePress-blog/Python/çˆ¬è™«æ¡ˆä¾‹/" class="nav-link">
  çˆ¬è™«æ¡ˆä¾‹
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸ªäººåŸåˆ›" class="dropdown-title"><span class="title">ä¸ªäººåŸåˆ›</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/VuePress-blog/ä¸ªäººåŸåˆ›/" class="nav-link">
  ä¸ªäººåŸåˆ›
</a></li></ul></div></div> <a href="https://github.com/solider245/VuePress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Repo
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/Docker Composeä¿æŒå®¹å™¨è¿è¡Œ.html" class="sidebar-link">Docker Composeä¿æŒå®¹å™¨è¿è¡Œ</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/Docker å®¹å™¨é•œåƒåŠå…¶ä½¿ç”¨.html" class="sidebar-link">Docker å®¹å™¨é•œåƒåŠå…¶ä½¿ç”¨</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/Docker æ„å»ºè„šæœ¬ Dockerfile æŒ‡ä»¤å…¨è§£æ.html" class="sidebar-link">Docker æ„å»ºè„šæœ¬ Dockerfile æŒ‡ä»¤å…¨è§£æ</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/Docker---Dockerfile è¯¦è§£.html" class="sidebar-link">Docker---Dockerfile è¯¦è§£</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/Dockerfile åŸºç¡€å®æˆ˜ï¼šæ„å»ºåŸºç¡€çš„ ubuntu14.04 é•œåƒ.html" class="sidebar-link">Dockerfile åŸºç¡€å®æˆ˜ï¼šæ„å»ºåŸºç¡€çš„ ubuntu14.04 é•œåƒ</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/Dockerfileå®˜æ–¹å‚è€ƒ.html" class="sidebar-link">Dockerfileå®˜æ–¹å‚è€ƒ</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/DockerfileæŒ‡ä»¤æ±‡æ€»åŠè§£æ.html" class="sidebar-link">DockerfileæŒ‡ä»¤æ±‡æ€»åŠè§£æ</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/Dockerå¼€å‘å…¥é—¨.html" class="sidebar-link">Dockerå¼€å‘å…¥é—¨</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/Dryå®˜æ–¹æŒ‰é”®å¤‡å¿˜.html" class="sidebar-link">Dryå®˜æ–¹æŒ‰é”®å¤‡å¿˜</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/Portainerä¸€ä¸ªè½»é‡çº§çš„Dockerç¯å¢ƒç®¡ç†UI.html" class="sidebar-link">Portainerä¸€ä¸ªè½»é‡çº§çš„Dockerç¯å¢ƒç®¡ç†UI</a></li><li><a href="/VuePress-blog/%E6%96%87%E7%AB%A0%E8%BD%AC%E8%BD%BD/docker/" aria-current="page" class="sidebar-link">è½¬è½½dockeræ–‡ç« çš„ç›®å½•</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/Ubuntu å®‰è£… Docker CE.html" class="sidebar-link">Ubuntu å®‰è£… Docker CE</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html" class="active sidebar-link">docker-Composeå®˜æ–¹æ•™ç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html#å‚è€ƒå’Œå‡†åˆ™-ğŸ”—" class="sidebar-link">å‚è€ƒå’Œå‡†åˆ™ ğŸ”—</a></li><li class="sidebar-sub-header"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html#æ’°å†™å’Œdockerå…¼å®¹æ€§çŸ©é˜µ-ğŸ”—" class="sidebar-link">æ’°å†™å’ŒDockerå…¼å®¹æ€§çŸ©é˜µ ğŸ”—</a></li><li class="sidebar-sub-header"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html#æ’°å†™æ–‡ä»¶ç»“æ„å’Œç¤ºä¾‹-ğŸ”—" class="sidebar-link">æ’°å†™æ–‡ä»¶ç»“æ„å’Œç¤ºä¾‹ ğŸ”—</a></li><li class="sidebar-sub-header"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html#æœåŠ¡é…ç½®å‚è€ƒ-ğŸ”—" class="sidebar-link">æœåŠ¡é…ç½®å‚è€ƒ ğŸ”—</a></li><li class="sidebar-sub-header"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html#æŒ‡å®šæŒç»­æ—¶é—´-ğŸ”—" class="sidebar-link">æŒ‡å®šæŒç»­æ—¶é—´ ğŸ”—</a></li><li class="sidebar-sub-header"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html#æŒ‡å®šå­—èŠ‚å€¼-ğŸ”—" class="sidebar-link">æŒ‡å®šå­—èŠ‚å€¼ ğŸ”—</a></li><li class="sidebar-sub-header"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html#å·é…ç½®å‚è€ƒ-ğŸ”—" class="sidebar-link">å·é…ç½®å‚è€ƒ ğŸ”—</a></li><li class="sidebar-sub-header"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html#ç½‘ç»œé…ç½®å‚è€ƒ-ğŸ”—" class="sidebar-link">ç½‘ç»œé…ç½®å‚è€ƒ ğŸ”—</a></li><li class="sidebar-sub-header"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html#configsé…ç½®å‚è€ƒ-ğŸ”—" class="sidebar-link">configsé…ç½®å‚è€ƒ ğŸ”—</a></li><li class="sidebar-sub-header"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html#æœºå¯†é…ç½®å‚è€ƒ-ğŸ”—" class="sidebar-link">æœºå¯†é…ç½®å‚è€ƒ ğŸ”—</a></li><li class="sidebar-sub-header"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html#å˜é‡æ›¿ä»£-ğŸ”—" class="sidebar-link">å˜é‡æ›¿ä»£ ğŸ”—</a></li><li class="sidebar-sub-header"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html#æ‰©å±•å­—æ®µ-ğŸ”—" class="sidebar-link">æ‰©å±•å­—æ®µ ğŸ”—</a></li><li class="sidebar-sub-header"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.html#æ’°å†™æ–‡æ¡£-ğŸ”—" class="sidebar-link">æ’°å†™æ–‡æ¡£ ğŸ”—</a></li></ul></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/dockerè¿è¡Œshellè„šæœ¬é—®é¢˜.html" class="sidebar-link">dockerè¿è¡Œshellè„šæœ¬é—®é¢˜</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/mac ä¸‹ä½¿ç”¨ Docker æ­å»º ubuntu ç¯å¢ƒ.html" class="sidebar-link">mac ä¸‹ä½¿ç”¨ Docker æ­å»º ubuntu ç¯å¢ƒ</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/ä¸€ä¸ªnodeå…¥é—¨Dockfile.html" class="sidebar-link">ä¸€ä¸ªnodeå…¥é—¨Dockfile</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/ä¸æ­£å®— docker å…¥é—¨æ•™ç¨‹-æ„å»ºä¸€ä¸ªé•œåƒ.html" class="sidebar-link">ä¸æ­£å®— docker å…¥é—¨æ•™ç¨‹-æ„å»ºä¸€ä¸ªé•œåƒ</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/ä»é•œåƒå†å²è®°å½•é€†å‘åˆ†æå‡ºDockerfile.html" class="sidebar-link">ä»é•œåƒå†å²è®°å½•é€†å‘åˆ†æå‡ºDockerfile</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/ä½¿ç”¨ BuildKit æ„å»ºé•œåƒ.html" class="sidebar-link">ä½¿ç”¨ BuildKit æ„å»ºé•œåƒ</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/å€ŸåŠ©Dockerizeæ›´å¥½çš„Dockerä½“éªŒ.html" class="sidebar-link">å€ŸåŠ©Dockerizeæ›´å¥½çš„Dockerä½“éªŒ</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/åœ¨Dockerfileä¸­è¿è¡Œè„šæœ¬.html" class="sidebar-link">åœ¨Dockerfileä¸­è¿è¡Œè„šæœ¬</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/å¦‚ä½•åœ¨Ubuntu 16.04ä¸Šä»¥å¹²å¼æ–¹å¼ç®¡ç†å’Œç›‘è§†Dockerå®¹å™¨.html" class="sidebar-link">å¦‚ä½•åœ¨Ubuntu 16.04ä¸Šä»¥å¹²å¼æ–¹å¼ç®¡ç†å’Œç›‘è§†Dockerå®¹å™¨</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/å¦‚ä½•åœ¨Ubuntu 20.04 LTSä¸Šä½¿ç”¨Dockerfileåˆ›å»ºDockeræ˜ åƒ.html" class="sidebar-link">å¦‚ä½•åœ¨Ubuntu 20.04 LTSä¸Šä½¿ç”¨Dockerfileåˆ›å»ºDockeræ˜ åƒ</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/å¦‚ä½•ç¼–å†™æœ€ä½³çš„Dockerfile.html" class="sidebar-link">å¦‚ä½•ç¼–å†™æœ€ä½³çš„Dockerfile</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/å®˜æ–¹ä¸‹ä¸€ä»£Dockeré•œåƒæ„å»ºç¥å™¨ -- BuildKit.html" class="sidebar-link">å®˜æ–¹ä¸‹ä¸€ä»£Dockeré•œåƒæ„å»ºç¥å™¨ -- BuildKit</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/å¯¹ä¼ ç»Ÿåº”ç”¨è¿›è¡Œå®¹å™¨åŒ–æ”¹é€ ï¼ˆè¯‘ï¼‰.html" class="sidebar-link">å¯¹ä¼ ç»Ÿåº”ç”¨è¿›è¡Œå®¹å™¨åŒ–æ”¹é€ ï¼ˆè¯‘ï¼‰</a></li><li><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/åº”ç”¨å®¹å™¨åŒ–&amp;DevOpsä¹‹è·¯.html" class="sidebar-link">åº”ç”¨å®¹å™¨åŒ–&amp;DevOpsä¹‹è·¯</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#å‚è€ƒå’Œå‡†åˆ™-ğŸ”—-reference-and-guidelines">å‚è€ƒå’Œå‡†åˆ™ ğŸ”—</a></li><li><a href="#æ’°å†™å’Œdockerå…¼å®¹æ€§çŸ©é˜µ-ğŸ”—-compose-and-docker-compatibility-matrix">æ’°å†™å’ŒDockerå…¼å®¹æ€§çŸ©é˜µ ğŸ”—</a></li><li><a href="#æ’°å†™æ–‡ä»¶ç»“æ„å’Œç¤ºä¾‹-ğŸ”—-compose-file-structure-and-examples">æ’°å†™æ–‡ä»¶ç»“æ„å’Œç¤ºä¾‹ ğŸ”—</a></li><li><a href="#æœåŠ¡é…ç½®å‚è€ƒ-ğŸ”—-service-configuration-reference">æœåŠ¡é…ç½®å‚è€ƒ ğŸ”—</a><ul><li><a href="#å»ºç«‹-ğŸ”—-build">å»ºç«‹ ğŸ”—</a><ul><li><a href="#è¯­å¢ƒ">è¯­å¢ƒ</a></li><li><a href="#dockeræ–‡ä»¶">dockeræ–‡ä»¶</a></li><li><a href="#args">args</a></li><li><a href="#cache-from">cache_from</a></li><li><a href="#æ ‡ç­¾">æ ‡ç­¾</a></li><li><a href="#ç½‘ç»œ">ç½‘ç»œ</a></li><li><a href="#shm-size">shm_size</a></li><li><a href="#ç›®æ ‡">ç›®æ ‡</a></li></ul></li><li><a href="#cap-addï¼Œ-cap-dropğŸ”—-cap-add-cap-drop">cap_addï¼Œ cap_dropğŸ”—</a></li><li><a href="#cgroup-parent-ğŸ”—-cgroup-parent">cgroup_parent ğŸ”—</a></li><li><a href="#å‘½ä»¤-ğŸ”—-command">å‘½ä»¤ ğŸ”—</a></li><li><a href="#é…ç½®-ğŸ”—-configs">é…ç½® ğŸ”—</a><ul><li><a href="#çŸ­è¯­æ³•">çŸ­è¯­æ³•</a></li><li><a href="#é•¿è¯­æ³•">é•¿è¯­æ³•</a></li></ul></li><li><a href="#container-name-ğŸ”—-container-name">CONTAINER_NAME ğŸ”—</a></li><li><a href="#credential-spec-ğŸ”—-credential-spec">credential_spec ğŸ”—</a><ul><li><a href="#gmsaé…ç½®ç¤ºä¾‹">gMSAé…ç½®ç¤ºä¾‹</a></li></ul></li><li><a href="#å–å†³äº-ğŸ”—-depends-on">å–å†³äº _ğŸ”—</a></li><li><a href="#éƒ¨ç½²-ğŸ”—-deploy">éƒ¨ç½² ğŸ”—</a><ul><li><a href="#ç«¯ç‚¹æ¨¡å¼">ç«¯ç‚¹æ¨¡å¼</a></li><li><a href="#æ ‡ç­¾">æ ‡ç­¾</a></li><li><a href="#æ¨¡å¼">æ¨¡å¼</a></li><li><a href="#æ”¾ç½®">æ”¾ç½®</a></li><li><a href="#max-replicas-per-node">max_replicas_per_node</a></li><li><a href="#å¤åˆ¶å“">å¤åˆ¶å“</a></li><li><a href="#èµ„æº">èµ„æº</a></li><li><a href="#restart-policy">restart_policy</a></li><li><a href="#rollback-config">rollback_config</a></li><li><a href="#update-config">update_config</a></li><li><a href="#ä¸æ”¯æŒ-docker-stack-deploy">ä¸æ”¯æŒ docker stack deploy</a></li></ul></li><li><a href="#è®¾å¤‡-ğŸ”—-devices">è®¾å¤‡ ğŸ”—</a></li><li><a href="#dns-ğŸ”—-dns">DNS ğŸ”—</a></li><li><a href="#dns-search-ğŸ”—-dns-search">dns_search ğŸ”—</a></li><li><a href="#å…¥å£ç‚¹-ğŸ”—-entrypoint">å…¥å£ç‚¹ ğŸ”—</a></li><li><a href="#env-file-ğŸ”—-env-file">env_file ğŸ”—</a></li><li><a href="#ç¯å¢ƒ-ğŸ”—-environment">ç¯å¢ƒ ğŸ”—</a></li><li><a href="#æš´éœ²-ğŸ”—-expose">æš´éœ² ğŸ”—</a></li><li><a href="#external-links-ğŸ”—-external-links">external_links ğŸ”—</a></li><li><a href="#extra-hosts-ğŸ”—-extra-hosts">extra_hosts ğŸ”—</a></li><li><a href="#å¥åº·-æ£€æŸ¥ğŸ”—-healthcheck">å¥åº· æ£€æŸ¥ğŸ”—</a></li><li><a href="#å›¾ç‰‡-ğŸ”—-image">å›¾ç‰‡ ğŸ”—</a></li><li><a href="#åˆå§‹åŒ–-ğŸ”—-init">åˆå§‹åŒ– ğŸ”—</a></li><li><a href="#éš”ç¦»-ğŸ”—-isolation">éš”ç¦» ğŸ”—</a></li><li><a href="#æ ‡ç­¾-ğŸ”—-labels-2">æ ‡ç­¾ ğŸ”—</a></li><li><a href="#é“¾æ¥-ğŸ”—-links">é“¾æ¥ ğŸ”—</a></li><li><a href="#è®°å½•-ğŸ”—-logging">è®°å½• ğŸ”—</a></li><li><a href="#network-mode-ğŸ”—-network-mode">network_mode ğŸ”—</a></li><li><a href="#ç½‘ç»œ-ğŸ”—-networks">ç½‘ç»œ ğŸ”—</a><ul><li><a href="#åˆ«å">åˆ«å</a></li><li><a href="#ipv4-addressï¼Œipv6-address">ipv4_addressï¼Œipv6_address</a></li></ul></li><li><a href="#pid-ğŸ”—-pid">PID ğŸ”—</a></li><li><a href="#æ¸¯å£-ğŸ”—-ports">æ¸¯å£ ğŸ”—</a><ul><li><a href="#çŸ­è¯­æ³•">çŸ­è¯­æ³•</a></li><li><a href="#é•¿è¯­æ³•">é•¿è¯­æ³•</a></li></ul></li><li><a href="#é‡æ–°å¯åŠ¨-ğŸ”—-restart">é‡æ–°å¯åŠ¨ ğŸ”—</a></li><li><a href="#ç§˜å¯†-ğŸ”—-secrets">ç§˜å¯† ğŸ”—</a><ul><li><a href="#çŸ­è¯­æ³•">çŸ­è¯­æ³•</a></li><li><a href="#é•¿è¯­æ³•">é•¿è¯­æ³•</a></li></ul></li><li><a href="#security-opt-ğŸ”—-security-opt">security_opt ğŸ”—</a></li><li><a href="#stop-grace-period-ğŸ”—-stop-grace-period">stop_grace_period ğŸ”—</a></li><li><a href="#stop-signal-ğŸ”—-stop-signal">stop_signal ğŸ”—</a></li><li><a href="#çš„sysctl-ğŸ”—-sysctls">çš„sysctl ğŸ”—</a></li><li><a href="#tmpfsçš„-ğŸ”—-tmpfs">tmpfsçš„ ğŸ”—</a></li><li><a href="#ulimits-ğŸ”—-ulimits">ulimits ğŸ”—</a></li><li><a href="#userns-mode-ğŸ”—-userns-mode">userns_mode ğŸ”—</a></li><li><a href="#å·-ğŸ”—-volumes">å· ğŸ”—</a><ul><li><a href="#çŸ­è¯­æ³•">çŸ­è¯­æ³•</a></li><li><a href="#é•¿è¯­æ³•">é•¿è¯­æ³•</a></li><li><a href="#æœåŠ¡ï¼Œç¾¤é›†å’Œå †æ ˆæ–‡ä»¶çš„å·">æœåŠ¡ï¼Œç¾¤é›†å’Œå †æ ˆæ–‡ä»¶çš„å·</a></li><li><a href="#å·è£…è½½çš„ç¼“å­˜é€‰é¡¹ï¼ˆé€‚ç”¨äºmacçš„dockeræ¡Œé¢ï¼‰">å·è£…è½½çš„ç¼“å­˜é€‰é¡¹ï¼ˆé€‚ç”¨äºMacçš„Dockeræ¡Œé¢ï¼‰</a></li></ul></li><li><a href="#åŸŸåï¼Œä¸»æœºåï¼Œipcï¼Œmac-addressï¼Œç‰¹æƒï¼Œread-onlyï¼Œshm-sizeï¼Œstdin-openï¼Œttyç”¨æˆ·ï¼Œworking-dir-ğŸ”—-domainname-hostname-ipc-mac-address-privileged-read-only-shm-size-stdin-open-tty-user-working-dir">åŸŸåï¼Œä¸»æœºåï¼ŒIPCï¼ŒMAC_ADDRESSï¼Œç‰¹æƒï¼ŒREAD_ONLYï¼Œshm_sizeï¼Œstdin_openï¼ŒTTYç”¨æˆ·ï¼Œworking_dir ğŸ”—</a></li></ul></li><li><a href="#æŒ‡å®šæŒç»­æ—¶é—´-ğŸ”—-specifying-durations">æŒ‡å®šæŒç»­æ—¶é—´ ğŸ”—</a></li><li><a href="#æŒ‡å®šå­—èŠ‚å€¼-ğŸ”—-specifying-byte-values">æŒ‡å®šå­—èŠ‚å€¼ ğŸ”—</a></li><li><a href="#å·é…ç½®å‚è€ƒ-ğŸ”—-volume-configuration-reference">å·é…ç½®å‚è€ƒ ğŸ”—</a><ul><li><a href="#å¸æœº-ğŸ”—-driver">å¸æœº ğŸ”—</a></li><li><a href="#driver-opts-ğŸ”—-driver-opts">driver_opts ğŸ”—</a></li><li><a href="#å¤–éƒ¨-ğŸ”—-external">å¤–éƒ¨ ğŸ”—</a></li><li><a href="#æ ‡ç­¾-ğŸ”—-labels-3">æ ‡ç­¾ ğŸ”—</a></li><li><a href="#å‘½å-ğŸ”—-name">å‘½å ğŸ”—</a></li></ul></li><li><a href="#ç½‘ç»œé…ç½®å‚è€ƒ-ğŸ”—-network-configuration-reference">ç½‘ç»œé…ç½®å‚è€ƒ ğŸ”—</a><ul><li><a href="#å¸æœº-ğŸ”—-driver-1">å¸æœº ğŸ”—</a><ul><li><a href="#æ¡¥">æ¡¥</a></li><li><a href="#è¦†ç›–">è¦†ç›–</a></li><li><a href="#ä¸»æœºæˆ–æ— ">ä¸»æœºæˆ–æ— </a></li></ul></li><li><a href="#driver-opts-ğŸ”—-driver-opts-1">driver_opts ğŸ”—</a></li><li><a href="#é™„-ğŸ”—-attachable">é™„ ğŸ”—</a></li><li><a href="#enable-ipv6-ğŸ”—-enable-ipv6">enable_ipv6 ğŸ”—</a></li><li><a href="#ä¼Šå¸•å§†-ğŸ”—-ipam">ä¼Šå¸•å§† ğŸ”—</a></li><li><a href="#å†…éƒ¨-ğŸ”—-internal">å†…éƒ¨ ğŸ”—</a></li><li><a href="#æ ‡ç­¾-ğŸ”—-labels-4">æ ‡ç­¾ ğŸ”—</a></li><li><a href="#å¤–éƒ¨-ğŸ”—-external-1">å¤–éƒ¨ ğŸ”—</a></li><li><a href="#å‘½å-ğŸ”—-name-1">å‘½å ğŸ”—</a></li></ul></li><li><a href="#configsé…ç½®å‚è€ƒ-ğŸ”—-configs-configuration-reference">configsé…ç½®å‚è€ƒ ğŸ”—</a></li><li><a href="#æœºå¯†é…ç½®å‚è€ƒ-ğŸ”—-secrets-configuration-reference">æœºå¯†é…ç½®å‚è€ƒ ğŸ”—</a><ul><li><a href="#æ’°å†™æ–‡ä»¶v3-5åŠæ›´é«˜ç‰ˆæœ¬-ğŸ”—-compose-file-v35-and-above">æ’°å†™æ–‡ä»¶v3.5åŠæ›´é«˜ç‰ˆæœ¬ ğŸ”—</a></li><li><a href="#æ’°å†™æ–‡ä»¶v3-4å’Œ-ğŸ”—ä¸‹-compose-file-v34-and-under">æ’°å†™æ–‡ä»¶v3.4å’Œ ğŸ”—ä¸‹</a></li></ul></li><li><a href="#å˜é‡æ›¿ä»£-ğŸ”—-variable-substitution">å˜é‡æ›¿ä»£ ğŸ”—</a></li><li><a href="#æ‰©å±•å­—æ®µ-ğŸ”—-extension-fields">æ‰©å±•å­—æ®µ ğŸ”—</a></li><li><a href="#æ’°å†™æ–‡æ¡£-ğŸ”—-compose-documentation">æ’°å†™æ–‡æ¡£ ğŸ”—</a></li></ul></div><p></p> <h2 id="å‚è€ƒå’Œå‡†åˆ™-ğŸ”—">å‚è€ƒå’Œå‡†åˆ™ <a href="#reference-and-guidelines">ğŸ”—</a></h2> <p>è¿™äº›ä¸»é¢˜æè¿°äº†Composeæ–‡ä»¶æ ¼å¼çš„ç‰ˆæœ¬3ã€‚ è¿™æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚</p> <h2 id="æ’°å†™å’Œdockerå…¼å®¹æ€§çŸ©é˜µ-ğŸ”—">æ’°å†™å’ŒDockerå…¼å®¹æ€§çŸ©é˜µ <a href="#compose-and-docker-compatibility-matrix">ğŸ”—</a></h2> <p>æœ‰å¤šç§ç‰ˆæœ¬çš„Composeæ–‡ä»¶æ ¼å¼â€“ 1ï¼Œ2ï¼Œ2.xå’Œ3.xã€‚ ä¸‹è¡¨æ˜¯å¿«é€Ÿæµè§ˆã€‚ æœ‰å…³æ¯ä¸ªç‰ˆæœ¬åŒ…æ‹¬ä»€ä¹ˆä»¥åŠå¦‚ä½•å‡çº§çš„å®Œæ•´è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <strong><a href="https://docs.docker.com/compose/compose-file/compose-versioning/" target="_blank" rel="noopener noreferrer">å…³äºç‰ˆæœ¬å’Œå‡çº§<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong> ã€‚</p> <p>ä¸‹è¡¨æ˜¾ç¤ºäº†å“ªäº›Composeæ–‡ä»¶ç‰ˆæœ¬æ”¯æŒç‰¹å®šçš„Dockerç‰ˆæœ¬ã€‚</p> <table><thead><tr><th><strong>æ’°å†™æ¡£æ¡ˆæ ¼å¼</strong></th> <th><strong>Docker Engineç‰ˆæœ¬</strong></th></tr></thead> <tbody><tr><td>3.8</td> <td>19.03.0+</td></tr> <tr><td>3.7</td> <td>18.06.0+</td></tr> <tr><td>3.6</td> <td>18.02.0+</td></tr> <tr><td>3.5</td> <td>17.12.0+</td></tr> <tr><td>3.4</td> <td>17.09.0+</td></tr> <tr><td>3.3</td> <td>17.06.0+</td></tr> <tr><td>3.2</td> <td>17.04.0+</td></tr> <tr><td>3.1</td> <td>1.13.1+</td></tr> <tr><td>3.0</td> <td>1.13.0+</td></tr> <tr><td>2.4</td> <td>17.12.0+</td></tr> <tr><td>2.3</td> <td>17.06.0+</td></tr> <tr><td>2.2</td> <td>1.13.0+</td></tr> <tr><td>2.1</td> <td>1.12.0+</td></tr> <tr><td>2.0</td> <td>1.10.0+</td></tr> <tr><td>1.0</td> <td>1.9.1ã€‚+</td></tr></tbody></table> <p>é™¤äº†è¡¨ä¸­æ˜¾ç¤ºçš„Composeæ–‡ä»¶æ ¼å¼ç‰ˆæœ¬å¤–ï¼ŒComposeæœ¬èº«ä¹Ÿå¤„äºå‘å¸ƒè®¡åˆ’ä¸­ï¼Œå¦‚ <a href="https://github.com/docker/compose/releases/" target="_blank" rel="noopener noreferrer">Compose releasesä¸­<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ‰€ç¤º ï¼Œä½†æ˜¯æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬ä¸ä¸€å®šéšæ¯ä¸ªå‘è¡Œç‰ˆå¢åŠ ã€‚ ä¾‹å¦‚ï¼ŒComposeæ–‡ä»¶æ ¼å¼3.0æœ€åˆæ˜¯åœ¨ <a href="https://github.com/docker/compose/releases/tag/1.10.0" target="_blank" rel="noopener noreferrer">Composeç‰ˆæœ¬1.10.0ä¸­<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¼•å…¥çš„ ï¼Œå¹¶åœ¨éšåçš„ç‰ˆæœ¬ä¸­é€æ¸ç‰ˆæœ¬åŒ–ã€‚</p> <h2 id="æ’°å†™æ–‡ä»¶ç»“æ„å’Œç¤ºä¾‹-ğŸ”—">æ’°å†™æ–‡ä»¶ç»“æ„å’Œç¤ºä¾‹ <a href="#compose-file-structure-and-examples">ğŸ”—</a></h2> <p>è¿™æ˜¯ <a href="https://github.com/docker/labs/tree/master/beginner/" target="_blank" rel="noopener noreferrer">Docker for Beginnerså®éªŒ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ä¸»é¢˜ä¸­ ä½¿ç”¨çš„æŠ•ç¥¨åº”ç”¨ç¨‹åºç¤ºä¾‹çš„Composeæ–‡ä»¶ç¤ºä¾‹ï¼Œè¯¥ ä¸»é¢˜æ¶‰åŠ <a href="https://github.com/docker/labs/blob/master/beginner/chapters/votingapp.md" target="_blank" rel="noopener noreferrer">å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Swarm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ï¼š</p> <p>ç¤ºä¾‹æ’°å†™æ–‡ä»¶ç‰ˆæœ¬3</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
version: &quot;3.8&quot;
services:

  redis:
    image: redis:alpine
    ports:
      - &quot;6379&quot;
    networks:
      - frontend
    deploy:
      replicas: 2
      update_config:
        parallelism: 2
        delay: 10s
      restart_policy:
        condition: on-failure

  db:
    image: postgres:9.4
    volumes:
      - db-data:/var/lib/postgresql/data
    networks:
      - backend
    deploy:
      placement:
        max_replicas_per_node: 1
        constraints:
          - &quot;node.role==manager&quot;

  vote:
    image: dockersamples/examplevotingapp_vote:before
    ports:
      - &quot;5000:80&quot;
    networks:
      - frontend
    depends_on:
      - redis
    deploy:
      replicas: 2
      update_config:
        parallelism: 2
      restart_policy:
        condition: on-failure

  result:
    image: dockersamples/examplevotingapp_result:before
    ports:
      - &quot;5001:80&quot;
    networks:
      - backend
    depends_on:
      - db
    deploy:
      replicas: 1
      update_config:
        parallelism: 2
        delay: 10s
      restart_policy:
        condition: on-failure

  worker:
    image: dockersamples/examplevotingapp_worker
    networks:
      - frontend
      - backend
    deploy:
      mode: replicated
      replicas: 1
      labels: [APP=VOTING]
      restart_policy:
        condition: on-failure
        delay: 10s
        max_attempts: 3
        window: 120s
      placement:
        constraints:
          - &quot;node.role==manager&quot;

  visualizer:
    image: dockersamples/visualizer:stable
    ports:
      - &quot;8080:8080&quot;
    stop_grace_period: 1m30s
    volumes:
      - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;
    deploy:
      placement:
        constraints:
          - &quot;node.role==manager&quot;

networks:
  frontend:
  backend:

volumes:
  db-data:

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br></div></div><p>æ­¤å‚è€ƒé¡µä¸Šçš„ä¸»é¢˜æŒ‰é¡¶çº§é”®æŒ‰å­—æ¯é¡ºåºç»„ç»‡ï¼Œä»¥åæ˜ Composeæ–‡ä»¶æœ¬èº«çš„ç»“æ„ã€‚ è¯¥é…ç½®æ–‡ä»¶ï¼Œå¦‚åœ¨å®šä¹‰éƒ¨åˆ†é¡¶çº§é”® <code>build</code> ï¼Œ <code>deploy</code> ï¼Œ <code>depends_on</code> ï¼Œ <code>networks</code> ï¼Œç­‰ç­‰ï¼Œéƒ½åˆ—å‡ºäº†æ”¯æŒå®ƒä»¬ä½œä¸ºå­è¯¾é¢˜çš„é€‰é¡¹ã€‚ è¿™æ˜ å°„åˆ° <code>&lt;key&gt;: &lt;option&gt;: &lt;value&gt;</code> Composeæ–‡ä»¶ çš„ ç¼©è¿›ç»“æ„ã€‚</p> <h2 id="æœåŠ¡é…ç½®å‚è€ƒ-ğŸ”—">æœåŠ¡é…ç½®å‚è€ƒ <a href="#service-configuration-reference">ğŸ”—</a></h2> <p>Composeæ–‡ä»¶æ˜¯ä¸€ä¸ª <a href="http://yaml.org/" target="_blank" rel="noopener noreferrer">YAML<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰ <a href="#service-configuration-reference">æœåŠ¡</a> ï¼Œ <a href="#network-configuration-reference">ç½‘ç»œ</a> å’Œ <a href="#volume-configuration-reference">å·</a> ã€‚ æ’°å†™æ–‡ä»¶çš„é»˜è®¤è·¯å¾„ä¸º <code>./docker-compose.yml</code> ã€‚</p> <blockquote><p><strong>æç¤º</strong> ï¼šæ‚¨å¯ä»¥ ä¸ºæ­¤æ–‡ä»¶ ä½¿ç”¨a <code>.yml</code> æˆ– <code>.yaml</code> æ‰©å±•åã€‚ ä»–ä»¬ä¿©éƒ½å·¥ä½œã€‚</p></blockquote> <p>æœåŠ¡å®šä¹‰åŒ…å«åº”ç”¨äºè¯¥æœåŠ¡å¯åŠ¨çš„æ¯ä¸ªå®¹å™¨çš„é…ç½®ï¼Œå°±åƒå°†å‘½ä»¤è¡Œå‚æ•°ä¼ é€’ç»™ä¸€æ · <code>docker run</code> ã€‚ åŒæ ·ï¼Œç½‘ç»œå’Œå·å®šä¹‰ç±»ä¼¼äº <code>docker network create</code> å’Œ <code>docker volume create</code> ã€‚</p> <p>å¦‚ <code>docker run</code> ï¼Œåœ¨DockerfileæŒ‡å®šçš„é€‰é¡¹ï¼Œå¦‚ <code>CMD</code> ï¼Œ <code>EXPOSE</code> ï¼Œ <code>VOLUME</code> ï¼Œ <code>ENV</code> ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹å°Šé‡-ä½ ä¸éœ€è¦å†æ¬¡æŒ‡å®šå®ƒä»¬ <code>docker-compose.yml</code> ã€‚</p> <p>æ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼Bashçš„ <code>${VARIABLE}</code> è¯­æ³• åœ¨é…ç½®å€¼ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡ - æœ‰å…³å®Œæ•´è¯¦ç»†ä¿¡æ¯ï¼Œ è¯·å‚è§ <a href="#variable-substitution">å˜é‡æ›¿æ¢</a> ã€‚</p> <p>æœ¬èŠ‚åŒ…å«ç‰ˆæœ¬3ä¸­çš„æœåŠ¡å®šä¹‰æ”¯æŒçš„æ‰€æœ‰é…ç½®é€‰é¡¹çš„åˆ—è¡¨ã€‚</p> <h3 id="å»ºç«‹-ğŸ”—">å»ºç«‹ <a href="#build">ğŸ”—</a></h3> <p>åœ¨æ„å»ºæ—¶åº”ç”¨çš„é…ç½®é€‰é¡¹ã€‚</p> <p><code>build</code> å¯ä»¥æŒ‡å®šä¸ºåŒ…å«æ„å»ºä¸Šä¸‹æ–‡è·¯å¾„çš„å­—ç¬¦ä¸²ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  webapp:
    build: ./dir

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>æˆ–è€…ï¼Œä½œä¸ºå…·æœ‰ <a href="#context">ä¸Šä¸‹æ–‡</a> å’Œï¼ˆå¯é€‰ï¼‰ <a href="#dockerfile">Dockerfile</a> å’Œ <a href="#args">args</a> ä¸‹æŒ‡å®šçš„è·¯å¾„çš„å¯¹è±¡ ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  webapp:
    build:
      context: ./dir
      dockerfile: Dockerfile-alternate
      args:
        buildno: 1

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>å¦‚æœæ‚¨æŒ‡å®š <code>image</code> ä»¥åŠ <code>build</code> ï¼Œåˆ™Composeä¼šä½¿ç”¨ä¸­ æŒ‡å®š çš„ <code>webapp</code> å’Œå¯é€‰ åç§°æ¥å‘½åæ„å»ºçš„å›¾åƒ ï¼š <code>tag</code> <code>image</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>build: ./dir
image: webapp:tag

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>è¿™å°†äº§ç”Ÿä¸€ä¸ªåä¸º <code>webapp</code> å¹¶æ ‡è®° ä¸ºçš„å›¾åƒï¼Œè¯¥å›¾åƒ <code>tag</code> æ˜¯ä»æ„å»ºçš„ <code>./dir</code> ã€‚</p> <blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨ä»¥ç¾¤é›†æ¨¡å¼éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>build</code> æ—¶ï¼Œ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">å°†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¿½ç•¥ è¯¥ é€‰é¡¹ã€‚ è¯¥ <code>docker stack</code> å‘½ä»¤ä¸ä¼šåœ¨éƒ¨ç½²ä¹‹å‰ç”Ÿæˆæ˜ åƒã€‚</p></blockquote> <h4 id="è¯­å¢ƒ">è¯­å¢ƒ</h4> <p>åŒ…å«Dockerfileçš„ç›®å½•çš„è·¯å¾„ï¼Œæˆ–è€…gitå­˜å‚¨åº“çš„URLã€‚</p> <p>å½“æä¾›çš„å€¼æ˜¯ç›¸å¯¹è·¯å¾„æ—¶ï¼Œå®ƒå°†è¢«è§£é‡Šä¸ºç›¸å¯¹äºComposeæ–‡ä»¶çš„ä½ç½®ã€‚ æ­¤ç›®å½•ä¹Ÿæ˜¯å‘é€åˆ°Dockerå®ˆæŠ¤ç¨‹åºçš„æ„å»ºä¸Šä¸‹æ–‡ã€‚</p> <p>Composeç”¨ç”Ÿæˆçš„åç§°æ„å»ºå¹¶æ ‡è®°å®ƒï¼Œç„¶åä½¿ç”¨è¯¥å›¾åƒã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>build:
  context: ./dir

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="dockeræ–‡ä»¶">dockeræ–‡ä»¶</h4> <p>å¤‡ç”¨Dockerfileã€‚</p> <p>Composeä½¿ç”¨æ›¿ä»£æ–‡ä»¶è¿›è¡Œæ„å»ºã€‚ è¿˜å¿…é¡»æŒ‡å®šä¸€ä¸ªæ„å»ºè·¯å¾„ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>build:
  context: .
  dockerfile: Dockerfile-alternate

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="args">args</h4> <p>æ·»åŠ æ„å»ºå‚æ•°ï¼Œè¿™æ˜¯åªèƒ½åœ¨æ„å»ºè¿‡ç¨‹ä¸­è®¿é—®çš„ç¯å¢ƒå˜é‡ã€‚</p> <p>é¦–å…ˆï¼Œåœ¨Dockerfileä¸­æŒ‡å®šå‚æ•°ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ARG buildno
ARG gitcommithash

RUN echo &quot;Build number: $buildno&quot;
RUN echo &quot;Based on commit: $gitcommithash&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ç„¶ååœ¨ <code>build</code> é”® ä¸‹æŒ‡å®šå‚æ•° ã€‚ æ‚¨å¯ä»¥ä¼ é€’æ˜ å°„æˆ–åˆ—è¡¨ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>build:
  context: .
  args:
    buildno: 1
    gitcommithash: cdc3b19

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>build:
  context: .
  args:
    - buildno=1
    - gitcommithash=cdc3b19

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>build-argsçš„èŒƒå›´</p> <p>åœ¨Dockerfileä¸­ï¼Œå¦‚æœæ‚¨ <code>ARG</code> åœ¨ <code>FROM</code> æŒ‡ä»¤ å‰ æŒ‡å®š ï¼Œ <code>ARG</code> åˆ™åœ¨ä¸‹æ–¹çš„æ„å»ºæŒ‡ä»¤ä¸­ä¸å¯ç”¨ <code>FROM</code> ã€‚ å¦‚æœæ‚¨éœ€è¦ä¸€ä¸ªå‚æ•°åœ¨ä¸¤ä¸ªåœ°æ–¹éƒ½å¯ç”¨ï¼Œè¯·åœ¨ <code>FROM</code> è¯´æ˜ä¸­ ä¹ŸæŒ‡å®šå®ƒ ã€‚ æœ‰å…³ç”¨æ³•çš„è¯¦ç»†ä¿¡æ¯ï¼Œ è¯·å‚é˜… æ–‡æ¡£ä¸­ çš„â€œ <a href="https://docs.docker.com/engine/reference/builder/#understand-how-arg-and-from-interact" target="_blank" rel="noopener noreferrer">äº†è§£ARGSå’ŒFROMä¹‹é—´çš„äº¤äº’æ–¹å¼â€<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> éƒ¨åˆ†ã€‚</p></blockquote> <p>æ‚¨å¯ä»¥åœ¨æŒ‡å®šæ„å»ºå‚æ•°æ—¶çœç•¥è¯¥å€¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ„å»ºæ—¶çš„å€¼å°±æ˜¯è¿è¡ŒComposeçš„ç¯å¢ƒä¸­çš„å€¼ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>args:
  - buildno
  - gitcommithash

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>ä½¿ç”¨å¸ƒå°”å€¼æ—¶çš„æç¤º</p> <p>YAMLå¸ƒå°”å€¼ï¼ˆ <code>&quot;true&quot;</code> ï¼Œ <code>&quot;false&quot;</code> ï¼Œ <code>&quot;yes&quot;</code> ï¼Œ <code>&quot;no&quot;</code> ï¼Œ <code>&quot;on&quot;</code> ï¼Œ <code>&quot;off&quot;</code> ï¼‰å¿…é¡»ç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œè¿™æ ·åˆ†æå™¨ä¼šå°†å®ƒä»¬è§£é‡Šä¸ºå­—ç¬¦ä¸²ã€‚</p></blockquote> <h4 id="cache-from">cache_from</h4> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-32" target="_blank" rel="noopener noreferrer">3.2ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼æ·»åŠ </p></blockquote> <p>å¼•æ“ç”¨äºç¼“å­˜è§£æçš„å›¾åƒåˆ—è¡¨ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>build:
  context: .
  cache_from:
    - alpine:latest
    - corp/web_app:3.14

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="æ ‡ç­¾">æ ‡ç­¾</h4> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-33" target="_blank" rel="noopener noreferrer">ç‰ˆæœ¬3.3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼æ·»åŠ </p></blockquote> <p>ä½¿ç”¨ <a href="https://docs.docker.com/config/labels-custom-metadata/" target="_blank" rel="noopener noreferrer">Dockeræ ‡ç­¾<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å°†å…ƒæ•°æ®æ·»åŠ åˆ°ç”Ÿæˆçš„å›¾åƒä¸­ ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ã€‚</p> <p>å»ºè®®æ‚¨ä½¿ç”¨åå‘DNSè¡¨ç¤ºæ³•ï¼Œä»¥é˜²æ­¢æ ‡ç­¾ä¸å…¶ä»–è½¯ä»¶ä½¿ç”¨çš„æ ‡ç­¾å†²çªã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>build:
  context: .
  labels:
    com.example.description: &quot;Accounting webapp&quot;
    com.example.department: &quot;Finance&quot;
    com.example.label-with-empty-value: &quot;&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>build:
  context: .
  labels:
    - &quot;com.example.description=Accounting webapp&quot;
    - &quot;com.example.department=Finance&quot;
    - &quot;com.example.label-with-empty-value&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="ç½‘ç»œ">ç½‘ç»œ</h4> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-34" target="_blank" rel="noopener noreferrer">3.4ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼æ·»åŠ </p></blockquote> <p>è®¾ç½®ç½‘ç»œå®¹å™¨çš„è¿æ¥ä»¥ <code>RUN</code> åœ¨æ„å»ºè¿‡ç¨‹ä¸­ è¿›è¡Œ è¯´æ˜ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>build:
  context: .
  network: host

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>build:
  context: .
  network: custom_network_1

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ç”¨äº <code>none</code> åœ¨æ„å»ºæœŸé—´ç¦ç”¨è”ç½‘ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>build:
  context: .
  network: none

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="shm-size">shm_size</h4> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-35" target="_blank" rel="noopener noreferrer">3.5ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼æ·»åŠ </p></blockquote> <p>è®¾ç½® <code>/dev/shm</code> æ­¤æ„å»ºå®¹å™¨ çš„ åˆ†åŒº å¤§å° ã€‚ æŒ‡å®šä¸ºè¡¨ç¤ºå­—èŠ‚æ•°çš„æ•´æ•°å€¼æˆ–è¡¨ç¤º <a href="#specifying-byte-values">å­—èŠ‚å€¼</a> çš„å­—ç¬¦ä¸² ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>build:
  context: .
  shm_size: '2gb'

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>build:
  context: .
  shm_size: 10000000

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="ç›®æ ‡">ç›®æ ‡</h4> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-34" target="_blank" rel="noopener noreferrer">3.4ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼æ·»åŠ </p></blockquote> <p>å»ºç«‹å†…å®šä¹‰çš„æŒ‡å®šé˜¶æ®µ <code>Dockerfile</code> ã€‚ æœ‰å…³ è¯¦ç»†ä¿¡æ¯ï¼Œ è¯·å‚è§ <a href="https://docs.docker.com/develop/develop-images/multistage-build/" target="_blank" rel="noopener noreferrer">å¤šé˜¶æ®µæ„å»ºæ–‡æ¡£<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>build:
  context: .
  target: prod

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="cap-addï¼Œ-cap-dropğŸ”—">cap_addï¼Œ <a href="#cap_add-cap_drop">cap_dropğŸ”—</a></h3> <p>æ·»åŠ æˆ–åˆ é™¤å®¹å™¨åŠŸèƒ½ã€‚ è¯·å‚é˜… <code>man 7 capabilities</code> ä»¥è·å–å®Œæ•´åˆ—è¡¨ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cap_add:
  - ALL

cap_drop:
  - NET_ADMIN
  - SYS_ADMIN

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨ç¾¤æ¨¡å¼ä¸‹éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ—¶ ï¼Œ <code>cap_add</code> å’Œ <code>cap_drop</code> é€‰é¡¹å°†è¢«å¿½ç•¥<a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="cgroup-parent-ğŸ”—">cgroup_parent <a href="#cgroup_parent">ğŸ”—</a></h3> <p>ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªå¯é€‰çš„çˆ¶cgroupã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cgroup_parent: m-executor-abcd

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨é›†ç¾¤æ¨¡å¼ä¸‹éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>cgroup_parent</code> æ—¶ï¼Œ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">å°†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¿½ç•¥ è¯¥ é€‰é¡¹<a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="å‘½ä»¤-ğŸ”—">å‘½ä»¤ <a href="#command">ğŸ”—</a></h3> <p>è¦†ç›–é»˜è®¤å‘½ä»¤ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>command: bundle exec thin -p 3000

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¯¥å‘½ä»¤ä¹Ÿå¯ä»¥æ˜¯åˆ—è¡¨ï¼Œç±»ä¼¼äº <a href="https://docs.docker.com/engine/reference/builder/#cmd" target="_blank" rel="noopener noreferrer">dockerfile<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>command: [&quot;bundle&quot;, &quot;exec&quot;, &quot;thin&quot;, &quot;-p&quot;, &quot;3000&quot;]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="é…ç½®-ğŸ”—">é…ç½® <a href="#configs">ğŸ”—</a></h3> <p>ä½¿ç”¨æŒ‰æœåŠ¡ <code>configs</code> é…ç½® ï¼ŒæŒ‰æœåŠ¡æˆäºˆå¯¹é…ç½®çš„è®¿é—®æƒé™ ã€‚ æ”¯æŒä¸¤ç§ä¸åŒçš„è¯­æ³•å˜ä½“ã€‚</p> <blockquote><p><strong>æ³¨æ„</strong> ï¼šè¯¥é…ç½®å¿…é¡»å·²ç»å­˜åœ¨æˆ–å·² <a href="#configs-configuration-reference">åœ¨ <code>configs</code></a> æ­¤å †æ ˆæ–‡ä»¶ <a href="#configs-configuration-reference">çš„é¡¶çº§</a> <a href="#configs-configuration-reference">é…ç½®</a> ä¸­ <a href="#configs-configuration-reference">å®šä¹‰</a> ï¼Œå¦åˆ™å †æ ˆéƒ¨ç½²å¤±è´¥ã€‚</p></blockquote> <p>æœ‰å…³é…ç½®çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ <a href="https://docs.docker.com/engine/swarm/configs/" target="_blank" rel="noopener noreferrer">configs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <h4 id="çŸ­è¯­æ³•">çŸ­è¯­æ³•</h4> <p>ç®€çŸ­çš„è¯­æ³•å˜ä½“ä»…æŒ‡å®šé…ç½®åç§°ã€‚ è¿™å°†æˆäºˆå®¹å™¨è®¿é—®é…ç½®çš„æƒé™ï¼Œå¹¶å°†å…¶å®‰è£…åœ¨ <code>/&lt;config_name&gt;</code> å®¹å™¨å†…ã€‚ æºåç§°å’Œç›®æ ‡å®‰è£…ç‚¹éƒ½è®¾ç½®ä¸ºé…ç½®åç§°ã€‚</p> <p>ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨çŸ­è¯­æ³•æ¥æˆäºˆ <code>redis</code> æœåŠ¡å¯¹ <code>my_config</code> å’Œ <code>my_other_config</code> é…ç½®çš„ è®¿é—®æƒé™ ã€‚ çš„å€¼ <code>my_config</code> è®¾ç½®ä¸ºfileçš„å†…å®¹ <code>./my_config.txt</code> ï¼Œå¹¶ <code>my_other_config</code> å®šä¹‰ä¸ºå¤–éƒ¨èµ„æºï¼Œè¿™æ„å‘³ç€å®ƒå·²ç»åœ¨Dockerä¸­å®šä¹‰ï¼Œå¯ä»¥é€šè¿‡è¿è¡Œ <code>docker config create</code> å‘½ä»¤æˆ–é€šè¿‡å…¶ä»–å †æ ˆéƒ¨ç½²è¿›è¡Œå®šä¹‰ã€‚ å¦‚æœå¤–éƒ¨é…ç½®ä¸å­˜åœ¨ï¼Œåˆ™å †æ ˆéƒ¨ç½²å¤±è´¥å¹¶æ˜¾ç¤º <code>config not found</code> é”™è¯¯ã€‚</p> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-33" target="_blank" rel="noopener noreferrer">ç‰ˆæœ¬3.3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p> <p><code>config</code> ç‰ˆæœ¬3.3å’Œæ›´é«˜ç‰ˆæœ¬çš„æ’°å†™æ–‡ä»¶æ ¼å¼ä»…æ”¯æŒå®šä¹‰ã€‚</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  redis:
    image: redis:latest
    deploy:
      replicas: 1
    configs:
      - my_config
      - my_other_config
configs:
  my_config:
    file: ./my_config.txt
  my_other_config:
    external: true

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="é•¿è¯­æ³•">é•¿è¯­æ³•</h4> <p>é•¿è¯­æ³•æä¾›äº†åœ¨æœåŠ¡çš„ä»»åŠ¡å®¹å™¨ä¸­å¦‚ä½•åˆ›å»ºé…ç½®çš„æ›´å¤šç²’åº¦ã€‚</p> <ul><li><code>source</code> ï¼šDockerä¸­å­˜åœ¨çš„é…ç½®åç§°ã€‚</li> <li><code>target</code> ï¼šè¦åœ¨æœåŠ¡çš„ä»»åŠ¡å®¹å™¨ä¸­æŒ‚è½½çš„æ–‡ä»¶çš„è·¯å¾„å’Œåç§°ã€‚ <code>/&lt;source&gt;</code> å¦‚æœæœªæŒ‡å®š ï¼Œ åˆ™ é»˜è®¤ä¸º ã€‚</li> <li><code>uid</code> å’Œ <code>gid</code> ï¼šæ‹¥æœ‰æœåŠ¡ä»»åŠ¡å®¹å™¨ä¸­å·²å®‰è£…çš„é…ç½®æ–‡ä»¶çš„æ•°å­—UIDæˆ–GIDã€‚ <code>0</code> å¦‚æœæœªæŒ‡å®šï¼Œåˆ™ ä¸¤è€…é»˜è®¤éƒ½ åœ¨Linuxä¸Šã€‚ Windowsä¸æ”¯æŒã€‚</li> <li><code>mode</code> ï¼šæœåŠ¡çš„ä»»åŠ¡å®¹å™¨ä¸­è£…å…¥çš„æ–‡ä»¶çš„æƒé™ï¼Œä»¥å…«è¿›åˆ¶è¡¨ç¤ºæ³•ã€‚ ä¾‹å¦‚ï¼Œ <code>0444</code> è¡¨ç¤ºä¸–ç•Œå¯è¯»ã€‚ é»˜è®¤å€¼ä¸º <code>0444</code> ã€‚ ç”±äºé…ç½®æ–‡ä»¶å·²æŒ‚è½½åœ¨ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå› æ­¤å®ƒä»¬ä¸å¯å†™ï¼Œå› æ­¤ï¼Œå¦‚æœè®¾ç½®å¯å†™ä½ï¼Œåˆ™å°†å…¶å¿½ç•¥ã€‚ å¯æ‰§è¡Œä½å¯ä»¥è®¾ç½®ã€‚ å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰UNIXæ–‡ä»¶æƒé™æ¨¡å¼ï¼Œåˆ™å¯èƒ½ä¼šå‘ç°æ­¤ <a href="http://permissions-calculator.org/" target="_blank" rel="noopener noreferrer">æƒé™è®¡ç®—å™¨<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¾ˆæœ‰ç”¨ã€‚</li></ul> <p>ä¸‹é¢çš„ç¤ºä¾‹è®¾ç½®çš„åç§° <code>my_config</code> ï¼Œä»¥ <code>redis_config</code> åœ¨å®¹å™¨å†…ï¼Œå°†æ¨¡å¼è®¾å®šä¸º <code>0440</code> ï¼ˆç»„å¯è¯»ï¼‰ï¼Œå¹¶ä¸”å°†æ‰€è¿°ç”¨æˆ·å’Œç»„ <code>103</code> ã€‚ è¯¥ <code>redis</code> æœåŠ¡æ— æƒè®¿é—®è¯¥ <code>my_other_config</code> é…ç½®ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  redis:
    image: redis:latest
    deploy:
      replicas: 1
    configs:
      - source: my_config
        target: /redis_config
        uid: '103'
        gid: '103'
        mode: 0440
configs:
  my_config:
    file: ./my_config.txt
  my_other_config:
    external: true

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>æ‚¨å¯ä»¥æˆäºˆæœåŠ¡è®¿é—®å¤šä¸ªé…ç½®çš„æƒé™ï¼Œå¹¶ä¸”å¯ä»¥æ··åˆé•¿çŸ­è¯­æ³•ã€‚ å®šä¹‰é…ç½®å¹¶ä¸æ„å‘³ç€æˆäºˆå¯¹å®ƒçš„æœåŠ¡è®¿é—®æƒé™ã€‚</p> <h3 id="container-name-ğŸ”—">CONTAINER_NAME <a href="#container_name">ğŸ”—</a></h3> <p>æŒ‡å®šè‡ªå®šä¹‰å®¹å™¨åç§°ï¼Œè€Œä¸æ˜¯ç”Ÿæˆçš„é»˜è®¤åç§°ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>container_name: my-web-container

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ç”±äºDockerå®¹å™¨åç§°å¿…é¡»å”¯ä¸€ï¼Œå› æ­¤å¦‚æœæ‚¨æŒ‡å®šäº†è‡ªå®šä¹‰åç§°ï¼Œåˆ™æ— æ³•å°†æœåŠ¡æ‰©å±•åˆ°è¶…è¿‡1ä¸ªå®¹å™¨ã€‚ å°è¯•è¿™æ ·åšä¼šå¯¼è‡´é”™è¯¯ã€‚</p> <blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨é›†ç¾¤æ¨¡å¼ä¸‹éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>container_name</code> æ—¶ï¼Œ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">å°†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¿½ç•¥ è¯¥ é€‰é¡¹<a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="credential-spec-ğŸ”—">credential_spec <a href="#credential_spec">ğŸ”—</a></h3> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-33" target="_blank" rel="noopener noreferrer">ç‰ˆæœ¬3.3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p> <p>è¯¥ <code>credential_spec</code> é€‰é¡¹å·²åœ¨v3.3ä¸­æ·»åŠ ã€‚ æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬3.8æˆ–æ›´é«˜ç‰ˆæœ¬æ”¯æŒå°†ç»„æ‰˜ç®¡æœåŠ¡å¸æˆ·ï¼ˆgMSAï¼‰é…ç½®ä¸æ’°å†™æ–‡ä»¶ä¸€èµ·ä½¿ç”¨ã€‚</p></blockquote> <p>é…ç½®æ‰˜ç®¡æœåŠ¡å¸æˆ·çš„å‡­æ®è§„èŒƒã€‚ æ­¤é€‰é¡¹ä»…ç”¨äºä½¿ç”¨Windowså®¹å™¨çš„æœåŠ¡ã€‚ åœ¨ <code>credential_spec</code> å¿…é¡»åœ¨æ ¼å¼ <code>file://&lt;filename&gt;</code> æˆ– <code>registry://&lt;value-name&gt;</code> ã€‚</p> <p>ä½¿ç”¨æ—¶ <code>file:</code> ï¼Œå¼•ç”¨çš„æ–‡ä»¶å¿…é¡»å­˜åœ¨äº <code>CredentialSpecs</code> Dockeræ•°æ®ç›®å½• çš„ å­ç›®å½•ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ <code>C:\ProgramData\Docker\</code> åœ¨Windowsä¸Šã€‚ ä»¥ä¸‹ç¤ºä¾‹ä»åä¸ºçš„æ–‡ä»¶ä¸­åŠ è½½å‡­æ®è§„èŒƒ <code>C:\ProgramData\Docker\CredentialSpecs\my-credential-spec.json</code> ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>credential_spec:
  file: my-credential-spec.json

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä½¿ç”¨æ—¶ <code>registry:</code> ï¼Œå°†ä»å®ˆæŠ¤ç¨‹åºä¸»æœºä¸Šçš„Windowsæ³¨å†Œè¡¨ä¸­è¯»å–å‡­æ®è§„èŒƒã€‚ å…·æœ‰ç»™å®šåç§°çš„æ³¨å†Œè¡¨å€¼å¿…é¡»ä½äºï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Virtualization\Containers\CredentialSpecs

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä»¥ä¸‹ç¤ºä¾‹ä» <code>my-credential-spec</code> æ³¨å†Œè¡¨ä¸­ å‘½åçš„å€¼åŠ è½½å‡­æ®è§„èŒƒ ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>credential_spec:
  registry: my-credential-spec

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="gmsaé…ç½®ç¤ºä¾‹">gMSAé…ç½®ç¤ºä¾‹</h4> <p>ä¸ºæœåŠ¡é…ç½®gMSAå‡­æ®è§„èŒƒæ—¶ï¼Œæ‚¨åªéœ€ä½¿ç”¨å³å¯æŒ‡å®šå‡­æ®è§„èŒƒ <code>config</code> ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  myservice:
    image: myimage:latest
    credential_spec:
      config: my_credential_spec

configs:
  my_credentials_spec:
    file: ./my-credential-spec.json|

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="å–å†³äº-ğŸ”—">å–å†³äº <a href="#depends_on">_ğŸ”—</a></h3> <p>è¡¨è¾¾æœåŠ¡ä¹‹é—´çš„ä¾èµ–æ€§ã€‚ æœåŠ¡ä¾èµ–é¡¹å¯¼è‡´ä»¥ä¸‹è¡Œä¸ºï¼š</p> <ul><li><code>docker-compose up</code> ä»¥ä¾èµ–æ€§é¡ºåºå¯åŠ¨æœåŠ¡ã€‚ åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œ <code>db</code> å’Œ <code>redis</code> åœ¨ä¹‹å‰å¯åŠ¨ <code>web</code> ã€‚</li> <li><code>docker-compose up SERVICE</code> è‡ªåŠ¨åŒ…å« <code>SERVICE</code> çš„ä¾èµ–é¡¹ã€‚ åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ <code>docker-compose up web</code> è¿˜å°†åˆ›å»ºå¹¶å¯åŠ¨ <code>db</code> å’Œ <code>redis</code> ã€‚</li> <li><code>docker-compose stop</code> æŒ‰ä¾èµ–å…³ç³»é¡ºåºåœæ­¢æœåŠ¡ã€‚ åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œ <code>web</code> åœ¨ <code>db</code> å’Œ ä¹‹å‰åœæ­¢ <code>redis</code> ã€‚</li></ul> <p>ç®€å•çš„ä¾‹å­ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  web:
    build: .
    depends_on:
      - db
      - redis
  redis:
    image: redis
  db:
    image: postgres

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>ä½¿ç”¨æ—¶æœ‰å‡ ä»¶äº‹è¦æ³¨æ„ <code>depends_on</code> ï¼š</p> <ul><li><code>depends_on</code> åœ¨å¯åŠ¨ä¹‹å‰ ä¸ç­‰å¾… <code>db</code> å¹¶ä¸” <code>redis</code> â€œå‡†å¤‡å°±ç»ªâ€ <code>web</code> -ä»… åœ¨å¯åŠ¨ ä¹‹å‰ã€‚ å¦‚æœéœ€è¦ç­‰å¾…æœåŠ¡å‡†å¤‡å°±ç»ªï¼Œè¯·å‚é˜… <a href="https://docs.docker.com/compose/startup-order/" target="_blank" rel="noopener noreferrer">æ§åˆ¶å¯åŠ¨é¡ºåºä»¥<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> è·å–æœ‰å…³æ­¤é—®é¢˜çš„æ›´å¤šä¿¡æ¯ä»¥åŠè§£å†³è¯¥é—®é¢˜çš„ç­–ç•¥ã€‚</li> <li>ç‰ˆæœ¬3ä¸å†æ”¯æŒçš„ <code>condition</code> å½¢å¼ <code>depends_on</code> ã€‚</li> <li><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨ä»¥ç¾¤ä½“æ¨¡å¼<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 3ç‰ˆæœ¬çš„Composeæ–‡ä»¶ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>depends_on</code> æ—¶ï¼Œ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">å°†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¿½ç•¥ è¯¥ é€‰é¡¹ ã€‚</li></ul></blockquote> <h3 id="éƒ¨ç½²-ğŸ”—">éƒ¨ç½² <a href="#deploy">ğŸ”—</a></h3> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-3" target="_blank" rel="noopener noreferrer">ç‰ˆæœ¬3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p></blockquote> <p>æŒ‡å®šä¸æœåŠ¡çš„éƒ¨ç½²å’Œè¿è¡Œæœ‰å…³çš„é…ç½®ã€‚ è¿™åªèƒ½éƒ¨ç½²åˆ°æ—¶ç”Ÿæ•ˆ <a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener noreferrer">ç¾¤<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ä¸ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">æ³Šåçª—å †æ ˆéƒ¨ç½²<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ï¼Œå¹¶ä¸”è¢«å¿½ç•¥ <code>docker-compose up</code> å’Œ <code>docker-compose run</code> ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  redis:
    image: redis:alpine
    deploy:
      replicas: 6
      placement:
        max_replicas_per_node: 1
      update_config:
        parallelism: 2
        delay: 10s
      restart_policy:
        condition: on-failure

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>æœ‰å‡ ä¸ªå­é€‰é¡¹å¯ç”¨ï¼š</p> <h4 id="ç«¯ç‚¹æ¨¡å¼">ç«¯ç‚¹æ¨¡å¼</h4> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-32" target="_blank" rel="noopener noreferrer">3.2ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p></blockquote> <p>ä¸ºè¿æ¥åˆ°ç¾¤é›†çš„å¤–éƒ¨å®¢æˆ·ç«¯æŒ‡å®šæœåŠ¡å‘ç°æ–¹æ³•ã€‚</p> <ul><li><p><code>endpoint_mode: vip</code> -Dockerä¸ºæœåŠ¡åˆ†é…äº†ä¸€ä¸ªè™šæ‹ŸIPï¼ˆVIPï¼‰ï¼Œè¯¥è™šæ‹ŸIPå……å½“å®¢æˆ·ç«¯è®¿é—®ç½‘ç»œä¸ŠæœåŠ¡çš„å‰ç«¯ã€‚ Dockeråœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡çš„å¯ç”¨å·¥ä½œç¨‹åºèŠ‚ç‚¹ä¹‹é—´è·¯ç”±è¯·æ±‚ï¼Œè€Œæ— éœ€å®¢æˆ·ç«¯çŸ¥é“æœ‰å¤šå°‘èŠ‚ç‚¹æ­£åœ¨å‚ä¸æœåŠ¡æˆ–å…¶IPåœ°å€æˆ–ç«¯å£ã€‚ ï¼ˆè¿™æ˜¯é»˜è®¤è®¾ç½®ã€‚ï¼‰</p></li> <li><p><code>endpoint_mode: dnsrr</code> -DNSè½®è¯¢ï¼ˆDNSRRï¼‰æœåŠ¡å‘ç°ä¸ä½¿ç”¨å•ä¸ªè™šæ‹ŸIPã€‚ Dockerè®¾ç½®æœåŠ¡çš„DNSæ¡ç›®ï¼Œä»¥ä¾¿å¯¹æœåŠ¡åç§°çš„DNSæŸ¥è¯¢è¿”å›IPåœ°å€åˆ—è¡¨ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯ç›´æ¥è¿æ¥åˆ°å…¶ä¸­ä¹‹ä¸€ã€‚ åœ¨æƒ³è¦ä½¿ç”¨è‡ªå·±çš„è´Ÿè½½å¹³è¡¡å™¨æˆ–æ··åˆWindowså’ŒLinuxåº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹ï¼ŒDNSè½®è¯¢å¾ˆæœ‰ç”¨ã€‚</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;

services:
  wordpress:
    image: wordpress
    ports:
      - &quot;8080:80&quot;
    networks:
      - overlay
    deploy:
      mode: replicated
      replicas: 2
      endpoint_mode: vip

  mysql:
    image: mysql
    volumes:
       - db-data:/var/lib/mysql/data
    networks:
       - overlay
    deploy:
      mode: replicated
      replicas: 2
      endpoint_mode: dnsrr

volumes:
  db-data:

networks:
  overlay:

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>çš„é€‰é¡¹ <code>endpoint_mode</code> è¿˜å¯ä»¥åœ¨ç¾¤é›†æ¨¡å¼CLIå‘½ä»¤ <a href="https://docs.docker.com/engine/reference/commandline/service_create/" target="_blank" rel="noopener noreferrer">docker service create<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ä¸Šç”¨ä½œæ ‡å¿— ã€‚ æœ‰å…³æ‰€æœ‰swarmç›¸å…³ <code>docker</code> å‘½ä»¤ çš„å¿«é€Ÿåˆ—è¡¨ ï¼Œè¯·å‚é˜… <a href="https://docs.docker.com/engine/swarm/#swarm-mode-key-concepts-and-tutorial" target="_blank" rel="noopener noreferrer">Swarmæ¨¡å¼CLIå‘½ä»¤<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <p>è¦äº†è§£æœ‰å…³åœ¨ç¾¤é›†æ¨¡å¼ä¸‹è¿›è¡ŒæœåŠ¡å‘ç°å’Œè”ç½‘çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…åœ¨ç¾¤é›†æ¨¡å¼ä¸‹ <a href="https://docs.docker.com/engine/swarm/networking/#configure-service-discovery" target="_blank" rel="noopener noreferrer">é…ç½®æœåŠ¡å‘ç°<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ä¸»é¢˜ã€‚</p> <h4 id="æ ‡ç­¾-2">æ ‡ç­¾</h4> <p>æŒ‡å®šæœåŠ¡æ ‡ç­¾ã€‚ è¿™äº›æ ‡ç­¾ <em>ä»…</em> åœ¨æœåŠ¡ä¸Šè®¾ç½®ï¼Œ <em>è€Œä¸</em> åœ¨æœåŠ¡çš„ä»»ä½•å®¹å™¨ä¸Šè®¾ç½®ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  web:
    image: web
    deploy:
      labels:
        com.example.description: &quot;This label will appear on the web service&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>åœ¨å®¹å™¨ä¸Šçš„æ ‡ç­¾é›†ä»£æ›¿ï¼Œä½¿ç”¨ <code>labels</code> çš„é”®å¤– <code>deploy</code> ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  web:
    image: web
    labels:
      com.example.description: &quot;This label will appear on all containers for the web service&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="æ¨¡å¼">æ¨¡å¼</h4> <p>ä»»ä¸€ <code>global</code> ï¼ˆæ­£å¥½ä¸€ä¸ªæ¯ç¾¤èŠ‚ç‚¹å®¹å™¨ï¼‰æˆ– <code>replicated</code> ï¼ˆå®¹å™¨çš„æŒ‡å®šæ•°é‡ï¼‰ã€‚ é»˜è®¤å€¼ä¸º <code>replicated</code> ã€‚ ï¼ˆè¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener noreferrer">ç¾¤é›†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ä¸»é¢˜ ä¸­çš„ <a href="https://docs.docker.com/engine/swarm/how-swarm-mode-works/services/#replicated-and-global-services" target="_blank" rel="noopener noreferrer">å¤åˆ¶æœåŠ¡å’Œå…¨å±€æœåŠ¡<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚ï¼‰<a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  worker:
    image: dockersamples/examplevotingapp_worker
    deploy:
      mode: global

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="æ”¾ç½®">æ”¾ç½®</h4> <p>æŒ‡å®šçº¦æŸå’Œé¦–é€‰é¡¹çš„ä½ç½®ã€‚ æœ‰å…³è¯­æ³•ä»¥åŠ <a href="https://docs.docker.com/engine/reference/commandline/service_create/#specify-service-constraints---constraint" target="_blank" rel="noopener noreferrer">çº¦æŸ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ï¼Œ <a href="https://docs.docker.com/engine/reference/commandline/service_create/#specify-service-placement-preferences---placement-pref" target="_blank" rel="noopener noreferrer">é¦–é€‰é¡¹çš„<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¯ç”¨ç±»å‹çš„å®Œæ•´è¯´æ˜ ï¼Œä»¥åŠ <a href="https://docs.docker.com/engine/reference/commandline/service_create/#specify-maximum-replicas-per-node---replicas-max-per-node" target="_blank" rel="noopener noreferrer">æŒ‡å®šæ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§å‰¯æœ¬æ•°<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ï¼Œ è¯·å‚é˜…dockeræœåŠ¡createæ–‡æ¡£ã€‚<a href="https://docs.docker.com/engine/reference/commandline/service_create/#specify-maximum-replicas-per-node---replicas-max-per-node" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  db:
    image: postgres
    deploy:
      placement:
        constraints:
          - &quot;node.role==manager&quot;
          - &quot;engine.labels.operatingsystem==ubuntu 18.04&quot;
        preferences:
          - spread: node.labels.zone

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="max-replicas-per-node">max_replicas_per_node</h4> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-38" target="_blank" rel="noopener noreferrer">3.8ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p></blockquote> <p>å¦‚æœæœåŠ¡æ˜¯ <code>replicated</code> ï¼ˆé»˜è®¤ï¼‰æœåŠ¡ï¼Œè¯· <a href="https://docs.docker.com/engine/reference/commandline/service_create/#specify-maximum-replicas-per-node---replicas-max-per-node" target="_blank" rel="noopener noreferrer">é™åˆ¶<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¯éšæ—¶åœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œ <a href="https://docs.docker.com/engine/reference/commandline/service_create/#specify-maximum-replicas-per-node---replicas-max-per-node" target="_blank" rel="noopener noreferrer">çš„å‰¯æœ¬æ•°<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <p>å½“è¯·æ±‚çš„ä»»åŠ¡å¤šäºè¿è¡ŒèŠ‚ç‚¹æ—¶ï¼Œå°† <code>no suitable node (max replicas per node limit exceed)</code> å¼•å‘ é”™è¯¯ ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  worker:
    image: dockersamples/examplevotingapp_worker
    networks:
      - frontend
      - backend
    deploy:
      mode: replicated
      replicas: 6
      placement:
        max_replicas_per_node: 1

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="å¤åˆ¶å“">å¤åˆ¶å“</h4> <p>å¦‚æœæœåŠ¡æ˜¯ <code>replicated</code> ï¼ˆé»˜è®¤ï¼‰æœåŠ¡ï¼Œè¯·æŒ‡å®šåœ¨ä»»ä½•ç»™å®šæ—¶é—´åº”è¿è¡Œçš„å®¹å™¨æ•°ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  worker:
    image: dockersamples/examplevotingapp_worker
    networks:
      - frontend
      - backend
    deploy:
      mode: replicated
      replicas: 6

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="èµ„æº">èµ„æº</h4> <p>é…ç½®èµ„æºçº¦æŸã€‚</p> <blockquote><p>æ›´æ”¹äº†æ’°å†™æ–‡ä»¶ç‰ˆæœ¬3</p> <p>è¯¥ <code>resources</code> éƒ¨åˆ†å–ä»£äº† <a href="https://docs.docker.com/compose/compose-file/compose-file-v2/#cpu-and-other-resources" target="_blank" rel="noopener noreferrer">æ—§çš„èµ„æºçº¦æŸé€‰é¡¹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> åœ¨æ’°å†™ç¬¬3ç‰ˆä¹‹å‰çš„æ–‡ä»¶ï¼ˆ <code>cpu_shares</code> ï¼Œ <code>cpu_quota</code> ï¼Œ <code>cpuset</code> ï¼Œ <code>mem_limit</code> ï¼Œ <code>memswap_limit</code> ï¼Œ <code>mem_swappiness</code> ï¼‰ã€‚ è¯·å‚é˜… <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#upgrading" target="_blank" rel="noopener noreferrer">å°†ç‰ˆæœ¬2.xå‡çº§åˆ°3.xï¼Œ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ä»¥äº†è§£ç‰ˆæœ¬2å’Œç‰ˆæœ¬3çš„æ’°å†™æ–‡ä»¶æ ¼å¼ä¹‹é—´çš„å·®å¼‚ã€‚</p></blockquote> <p>å…¶ä¸­æ¯ä¸ªéƒ½æ˜¯ä¸€ä¸ªå€¼ï¼Œç±»ä¼¼äºå…¶ <a href="https://docs.docker.com/engine/reference/commandline/service_create/" target="_blank" rel="noopener noreferrer">dockeræœåŠ¡create<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¯¹åº”é¡¹ã€‚</p> <p>åœ¨æ­¤ä¸€èˆ¬ç¤ºä¾‹ä¸­ï¼Œ <code>redis</code> æœåŠ¡è¢«é™åˆ¶ä¸ºä½¿ç”¨ä¸è¶…è¿‡50Mçš„å†…å­˜å’Œ <code>0.50</code> ï¼ˆå•æ ¸çš„50ï¼…ï¼‰å¯ç”¨çš„å¤„ç†æ—¶é—´ï¼ˆCPUï¼‰ï¼Œå¹¶ä¸”å…·æœ‰ ä¿ç•™ <code>20M</code> çš„å†…å­˜å’Œ <code>0.25</code> CPUæ—¶é—´ï¼ˆå§‹ç»ˆå¯ç”¨ï¼‰ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  redis:
    image: redis:alpine
    deploy:
      resources:
        limits:
          cpus: '0.50'
          memory: 50M
        reservations:
          cpus: '0.25'
          memory: 20M

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>ä»¥ä¸‹ä¸»é¢˜æè¿°äº†å¯ç”¨äºè®¾ç½®ç¾¤ä¸­æœåŠ¡æˆ–å®¹å™¨çš„èµ„æºçº¦æŸçš„å¯ç”¨é€‰é¡¹ã€‚</p> <blockquote><p>å¯»æ‰¾ç”¨äºåœ¨éç¾¤æ¨¡å¼å®¹å™¨ä¸Šè®¾ç½®èµ„æºçš„é€‰é¡¹å—ï¼Ÿ</p> <p>æ­¤å¤„æè¿°çš„é€‰é¡¹ç‰¹å®šäº <code>deploy</code> é”®å’Œç¾¤æ¨¡å¼ã€‚ å¦‚æœè¦åœ¨éç¾¤é›†éƒ¨ç½²ä¸­è®¾ç½®èµ„æºé™åˆ¶ï¼Œè¯·ä½¿ç”¨ <a href="https://docs.docker.com/compose/compose-file/compose-file-v2/#cpu-and-other-resources" target="_blank" rel="noopener noreferrer">Composeæ–‡ä»¶æ ¼å¼ç‰ˆæœ¬2 CPUï¼Œå†…å­˜å’Œå…¶ä»–èµ„æºé€‰é¡¹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚ å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·å‚é˜…æœ‰å…³GitHubé—®é¢˜ <a href="https://github.com/docker/compose/issues/4513" target="_blank" rel="noopener noreferrer">docker / compose / 4513<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> çš„è®¨è®º ã€‚</p></blockquote> <h5 id="å†…å­˜ä¸è¶³å¼‚å¸¸ï¼ˆoomeï¼‰">å†…å­˜ä¸è¶³å¼‚å¸¸ï¼ˆOOMEï¼‰</h5> <p>å¦‚æœæ‚¨çš„æœåŠ¡æˆ–å®¹å™¨å°è¯•ä½¿ç”¨çš„å†…å­˜è¶…è¿‡ç³»ç»Ÿå¯ç”¨çš„å†…å­˜ï¼Œåˆ™å¯èƒ½ä¼šé‡åˆ°å†…å­˜ä¸è¶³å¼‚å¸¸ï¼ˆOOMEï¼‰ï¼Œå¹¶ä¸”å®¹å™¨æˆ–Dockerå®ˆæŠ¤ç¨‹åºå¯èƒ½ä¼šè¢«å†…æ ¸OOMæ€æ‰‹æ€æ­»ã€‚ ä¸ºé˜²æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œè¯·ç¡®ä¿æ‚¨çš„åº”ç”¨ç¨‹åºåœ¨å…·æœ‰è¶³å¤Ÿå†…å­˜çš„ä¸»æœºä¸Šè¿è¡Œï¼Œâ€‹â€‹è¯·å‚é˜… <a href="https://docs.docker.com/config/containers/resource_constraints/#understand-the-risks-of-running-out-of-memory" target="_blank" rel="noopener noreferrer">äº†è§£<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å†…å­˜ä¸è¶³ <a href="https://docs.docker.com/config/containers/resource_constraints/#understand-the-risks-of-running-out-of-memory" target="_blank" rel="noopener noreferrer">çš„é£é™©<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <h4 id="restart-policy">restart_policy</h4> <p>é…ç½®æ˜¯å¦ä»¥åŠå¦‚ä½•åœ¨é€€å‡ºå®¹å™¨æ—¶é‡æ–°å¯åŠ¨å®¹å™¨ã€‚ æ›¿æ¢ <a href="https://docs.docker.com/compose/compose-file/compose-file-v2/#orig-resources" target="_blank" rel="noopener noreferrer"><code>restart</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <ul><li><code>condition</code> ï¼šå…¶ä¸€ <code>none</code> ï¼Œ <code>on-failure</code> æˆ–è€… <code>any</code> ï¼ˆé»˜è®¤å€¼ï¼š <code>any</code> ï¼‰ã€‚</li> <li><code>delay</code> ï¼šé‡æ–°å¯åŠ¨å°è¯•ä¹‹é—´ç­‰å¾…çš„ <a href="#specifying-durations">æ—¶é—´</a> ï¼ŒæŒ‡å®šä¸º <a href="#specifying-durations">æŒç»­æ—¶é—´</a> ï¼ˆé»˜è®¤å€¼ï¼š0ï¼‰ã€‚</li> <li><code>max_attempts</code> ï¼šæ”¾å¼ƒä¹‹å‰å°è¯•é‡æ–°å¯åŠ¨å®¹å™¨çš„æ¬¡æ•°ï¼ˆé»˜è®¤å€¼ï¼šæ°¸ä¸æ”¾å¼ƒï¼‰ã€‚ å¦‚æœé‡å¯æœªåœ¨configureå†…æˆåŠŸå®Œæˆ <code>window</code> ï¼Œåˆ™æ­¤å°è¯•ä¸ä¼šè®¡å…¥é…ç½® <code>max_attempts</code> å€¼ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœ <code>max_attempts</code> è®¾ç½®ä¸ºâ€œ 2â€ï¼Œå¹¶ä¸”ç¬¬ä¸€æ¬¡å°è¯•é‡å¯å¤±è´¥ï¼Œåˆ™å¯èƒ½å°è¯•ä¸¤æ¬¡ä»¥ä¸Šé‡å¯ã€‚</li> <li><code>window</code> ï¼šå†³å®šé‡æ–°å¯åŠ¨æ˜¯å¦æˆåŠŸä¹‹å‰è¦ç­‰å¾…çš„ <a href="#specifying-durations">æ—¶é—´</a> ï¼ŒæŒ‡å®šä¸º <a href="#specifying-durations">æŒç»­æ—¶é—´</a> ï¼ˆé»˜è®¤å€¼ï¼šç«‹å³å†³å®šï¼‰ã€‚</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  redis:
    image: redis:alpine
    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 120s

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="rollback-config">rollback_config</h4> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-37" target="_blank" rel="noopener noreferrer">3.7ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p></blockquote> <p>é…ç½®åœ¨æ›´æ–°å¤±è´¥çš„æƒ…å†µä¸‹åº”å¦‚ä½•å›æ»šæœåŠ¡ã€‚</p> <ul><li><code>parallelism</code> ï¼šä¸€æ¬¡è¦å›æ»šçš„å®¹å™¨æ•°ã€‚ å¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™æ‰€æœ‰å®¹å™¨å°†åŒæ—¶å›æ»šã€‚</li> <li><code>delay</code> ï¼šæ¯ä¸ªå®¹å™¨ç»„å›æ»šä¹‹é—´ç­‰å¾…çš„æ—¶é—´ï¼ˆé»˜è®¤ä¸º0sï¼‰ã€‚</li> <li><code>failure_action</code> ï¼šå¦‚æœå›æ»šå¤±è´¥ï¼Œè¯¥æ€ä¹ˆåŠã€‚ å…¶ä¸­ä¸€ä¸ª <code>continue</code> æˆ–è€… <code>pause</code> ï¼ˆé»˜è®¤ <code>pause</code> ï¼‰</li> <li><code>monitor</code> ï¼šæ›´æ–°æ¯ä¸ªä»»åŠ¡ä»¥ç›‘è§†å¤±è´¥åçš„æŒç»­æ—¶é—´ <code>(ns|us|ms|s|m|h)</code> ï¼ˆé»˜è®¤ä¸º0sï¼‰ã€‚</li> <li><code>max_failure_ratio</code> ï¼šåœ¨å›æ»šæœŸé—´å¯ä»¥å®¹å¿çš„æ•…éšœç‡ï¼ˆé»˜è®¤ä¸º0ï¼‰ã€‚</li> <li><code>order</code> ï¼šå›æ»šæœŸé—´çš„æ“ä½œé¡ºåºã€‚ å…¶ä¸­ä¸€ä¸ª <code>stop-first</code> ï¼ˆæ—§ä»»åŠ¡ï¼Œå¼€å§‹æ–°çš„ä¸€ä¸ªå‰åœæ­¢ï¼‰ï¼Œæˆ–è€… <code>start-first</code> ï¼ˆæ–°çš„ä»»åŠ¡é¦–å…ˆå¯åŠ¨ï¼Œå¹¶ä¸”æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ç®€å•åœ°é‡å ï¼‰ï¼ˆé»˜è®¤ <code>stop-first</code> ï¼‰ã€‚</li></ul> <h4 id="update-config">update_config</h4> <p>é…ç½®åº”å¦‚ä½•æ›´æ–°æœåŠ¡ã€‚ å¯¹äºé…ç½®æ»šåŠ¨æ›´æ–°å¾ˆæœ‰ç”¨ã€‚</p> <ul><li><code>parallelism</code> ï¼šä¸€æ¬¡æ›´æ–°çš„å®¹å™¨æ•°ã€‚</li> <li><code>delay</code> ï¼šåœ¨æ›´æ–°ä¸€ç»„å®¹å™¨ä¹‹é—´ç­‰å¾…çš„æ—¶é—´ã€‚</li> <li><code>failure_action</code> ï¼šå¦‚æœæ›´æ–°å¤±è´¥ï¼Œè¯¥æ€ä¹ˆåŠã€‚ å…¶ä¸­ä¸€ä¸ª <code>continue</code> ï¼Œ <code>rollback</code> æˆ–è€… <code>pause</code> ï¼ˆé»˜è®¤ï¼š <code>pause</code> ï¼‰ã€‚</li> <li><code>monitor</code> ï¼šæ›´æ–°æ¯ä¸ªä»»åŠ¡ä»¥ç›‘è§†å¤±è´¥åçš„æŒç»­æ—¶é—´ <code>(ns|us|ms|s|m|h)</code> ï¼ˆé»˜è®¤ä¸º0sï¼‰ã€‚</li> <li><code>max_failure_ratio</code> ï¼šæ›´æ–°æœŸé—´å¯ä»¥å®¹å¿çš„æ•…éšœç‡ã€‚</li> <li><code>order</code> ï¼šæ›´æ–°æœŸé—´çš„æ“ä½œé¡ºåºã€‚ å…¶ä¸­ä¸€ä¸ª <code>stop-first</code> ï¼ˆæ—§ä»»åŠ¡ï¼Œå¼€å§‹æ–°çš„ä¸€ä¸ªå‰åœæ­¢ï¼‰ï¼Œæˆ–è€… <code>start-first</code> ï¼ˆæ–°çš„ä»»åŠ¡é¦–å…ˆå¯åŠ¨ï¼Œå¹¶ä¸”æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ç®€å•é‡å ï¼‰ï¼ˆé»˜è®¤ <code>stop-first</code> ï¼‰ <strong>æ³¨</strong> ï¼šä»…æ”¯æŒV3.4åŠæ›´é«˜ç‰ˆæœ¬ã€‚</li></ul> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-34" target="_blank" rel="noopener noreferrer">3.4ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p> <p><code>order</code> v3.4åŠæ›´é«˜ç‰ˆæœ¬çš„æ’°å†™æ–‡ä»¶æ ¼å¼ä»…æ”¯æŒ è¯¥ é€‰é¡¹ã€‚</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  vote:
    image: dockersamples/examplevotingapp_vote:before
    depends_on:
      - redis
    deploy:
      replicas: 2
      update_config:
        parallelism: 2
        delay: 10s
        order: stop-first

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="ä¸æ”¯æŒ-docker-stack-deploy">ä¸æ”¯æŒ <code>docker stack deploy</code></h4> <p>ä¸‹é¢çš„å­é€‰é¡¹ï¼ˆæ”¯æŒ <code>docker-compose up</code> å’Œ <code>docker-compose run</code> ï¼‰æ˜¯ <em>ä¸æ”¯æŒ</em> çš„ <code>docker stack deploy</code> æˆ– <code>deploy</code> å…³é”®çš„ã€‚</p> <ul><li><a href="#build">å»ºç«‹</a></li> <li><a href="#cgroup_parent">cgroup_parent</a></li> <li><a href="#container_name">container_name</a></li> <li><a href="#devices">è®¾å¤‡</a></li> <li><a href="#tmpfs">tmpfs</a></li> <li><a href="#external_links">å¤–éƒ¨é“¾æ¥</a></li> <li><a href="#links">é“¾æ¥</a></li> <li><a href="#network_mode">ç½‘ç»œæ¨¡å¼</a></li> <li><a href="#restart">é‡æ–°å¼€å§‹</a></li> <li><a href="#security_opt">security_opt</a></li> <li><a href="#userns_mode">userns_mode</a></li></ul> <blockquote><p>å°è´¹</p> <p>è¯·å‚é˜…æœ‰å…³ <a href="#volumes-for-services-swarms-and-stack-files">å¦‚ä½•ä¸ºæœåŠ¡ï¼Œç¾¤é›†å’Œdocker-stack.ymlæ–‡ä»¶é…ç½®å·</a> çš„éƒ¨åˆ† ã€‚ å· <em>æ˜¯</em> å—æ”¯æŒçš„ï¼Œä½†æ˜¯è¦ä¸ç¾¤é›†å’ŒæœåŠ¡ä¸€èµ·ä½¿ç”¨ï¼Œå¿…é¡»å°†å®ƒä»¬é…ç½®ä¸ºå‘½åå·æˆ–ä¸å—çº¦æŸäºæœ‰æƒè®¿é—®å¿…éœ€å·çš„èŠ‚ç‚¹çš„æœåŠ¡å…³è”ã€‚</p></blockquote> <h3 id="è®¾å¤‡-ğŸ”—">è®¾å¤‡ <a href="#devices">ğŸ”—</a></h3> <p>è®¾å¤‡æ˜ å°„åˆ—è¡¨ã€‚ ä½¿ç”¨ä¸ <code>--device</code> docker client createé€‰é¡¹ ç›¸åŒçš„æ ¼å¼ ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>devices:
  - &quot;/dev/ttyUSB0:/dev/ttyUSB0&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨é›†ç¾¤æ¨¡å¼ä¸‹éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>devices</code> æ—¶ï¼Œ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">å°†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¿½ç•¥ è¯¥ é€‰é¡¹<a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="dns-ğŸ”—">DNS <a href="#dns">ğŸ”—</a></h3> <p>è‡ªå®šä¹‰DNSæœåŠ¡å™¨ã€‚ å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dns: 8.8.8.8

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>dns:
  - 8.8.8.8
  - 9.9.9.9

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="dns-search-ğŸ”—">dns_search <a href="#dns_search">ğŸ”—</a></h3> <p>è‡ªå®šä¹‰DNSæœç´¢åŸŸã€‚ å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dns_search: example.com

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>dns_search:
  - dc1.example.com
  - dc2.example.com

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="å…¥å£ç‚¹-ğŸ”—">å…¥å£ç‚¹ <a href="#entrypoint">ğŸ”—</a></h3> <p>è¦†ç›–é»˜è®¤å…¥å£ç‚¹ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>entrypoint: /code/entrypoint.sh

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å…¥å£ç‚¹ä¹Ÿå¯ä»¥æ˜¯åˆ—è¡¨ï¼Œç±»ä¼¼äº <a href="https://docs.docker.com/engine/reference/builder/#entrypoint" target="_blank" rel="noopener noreferrer">dockerfile<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>entrypoint: [&quot;php&quot;, &quot;-d&quot;, &quot;memory_limit=-1&quot;, &quot;vendor/bin/phpunit&quot;]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p><strong>æ³¨æ„</strong></p> <p>è®¾ç½® <code>entrypoint</code> ä¸¤è€…éƒ½å°†ä½¿ç”¨ <code>ENTRYPOINT</code> DockerfileæŒ‡ä»¤ è¦†ç›–æœåŠ¡æ˜ åƒä¸Š è®¾ç½®çš„ ä»»ä½•é»˜è®¤å…¥å£ç‚¹ ï¼Œ <em>å¹¶</em> æ¸…é™¤æ˜ åƒä¸Šçš„ä»»ä½•é»˜è®¤å‘½ä»¤-è¿™æ„å‘³ç€å¦‚æœ <code>CMD</code> Dockerfileä¸­ æœ‰ æŒ‡ä»¤ï¼Œåˆ™å°†å…¶å¿½ç•¥ã€‚</p></blockquote> <h3 id="env-file-ğŸ”—">env_file <a href="#env_file">ğŸ”—</a></h3> <p>ä»æ–‡ä»¶æ·»åŠ ç¯å¢ƒå˜é‡ã€‚ å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨ã€‚</p> <p>å¦‚æœæ‚¨ä½¿ç”¨æŒ‡å®šäº†Composeæ–‡ä»¶ <code>docker-compose -f FILE</code> ï¼Œåˆ™in <code>env_file</code> çš„ è·¯å¾„ ç›¸å¯¹äºè¯¥æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚</p> <p>åœ¨ <a href="#environment">ç¯å¢ƒ</a> éƒ¨åˆ†ä¸­ å£°æ˜çš„ç¯å¢ƒå˜é‡å°† <em>è¦†ç›–</em> è¿™äº›å€¼â€“å³ä½¿è¿™äº›å€¼ä¸ºç©ºæˆ–æœªå®šä¹‰ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>env_file: .env

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>env_file:
  - ./common.env
  - ./apps/web.env
  - /opt/runtime_opts.env

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ComposeæœŸæœ›ç¯å¢ƒæ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œéƒ½é‡‡ç”¨ <code>VAR=VAL</code> æ ¼å¼ã€‚ ä»¥å¼€å¤´çš„è¡Œ <code>#</code> è¢«è§†ä¸ºæ³¨é‡Šï¼Œå¹¶è¢«å¿½ç•¥ã€‚ ç©ºè¡Œä¹Ÿå°†è¢«å¿½ç•¥ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># Set Rails/Rack environment
RACK_ENV=development

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p><strong>æ³¨æ„</strong></p> <p>å¦‚æœæ‚¨çš„æœåŠ¡æŒ‡å®šäº† <a href="#build">æ„å»º</a> é€‰é¡¹ï¼Œåˆ™ åœ¨æ„å»ºè¿‡ç¨‹ ä¸­ <em>ä¸ä¼š</em> è‡ªåŠ¨æ˜¾ç¤º ç¯å¢ƒæ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ ã€‚ ä½¿ç”¨çš„ <a href="#args">args</a> å­é€‰é¡¹ <code>build</code> æ¥å®šä¹‰æ„å»ºæ—¶ç¯å¢ƒå˜é‡ã€‚</p></blockquote> <p>çš„å€¼æŒ‰ <code>VAL</code> åŸæ ·ä½¿ç”¨ï¼Œæ ¹æœ¬æ²¡æœ‰ä¿®æ”¹ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœè¯¥å€¼ç”¨å¼•å·å¼•èµ·æ¥ï¼ˆé€šå¸¸æ˜¯shellå˜é‡ï¼‰ï¼Œåˆ™å¼•å·åŒ…å«åœ¨ä¼ é€’ç»™Composeçš„å€¼ä¸­ã€‚</p> <p>è¯·è®°ä½ï¼Œ <em>åˆ—è¡¨ä¸­æ–‡ä»¶çš„é¡ºåºå¯¹äºç¡®å®šåˆ†é…ç»™å¤šæ¬¡æ˜¾ç¤ºçš„å˜é‡çš„å€¼å¾ˆé‡è¦</em> ã€‚ åˆ—è¡¨ä¸­çš„æ–‡ä»¶ä»ä¸Šåˆ°ä¸‹è¿›è¡Œå¤„ç†ã€‚ å¯¹äºåœ¨fileä¸­æŒ‡å®šå¹¶åœ¨fileä¸­ <code>a.env</code> åˆ†é…äº†ä¸åŒå€¼ çš„ç›¸åŒå˜é‡ <code>b.env</code> ï¼Œå¦‚æœ <code>b.env</code> åœ¨ä¸‹é¢ï¼ˆä¹‹åï¼‰åˆ—å‡ºï¼Œåˆ™æ¥è‡ªæ ‡å‡†ä½çš„å€¼ <code>b.env</code> ã€‚ ä¾‹å¦‚ï¼Œåœ¨ä¸­ç»™å‡ºä»¥ä¸‹å£°æ˜ <code>docker-compose.yml</code> ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>services:
  some-service:
    env_file:
      - a.env
      - b.env

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å’Œä»¥ä¸‹æ–‡ä»¶ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># a.env
VAR=1

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å’Œ</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># b.env
VAR=hello

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>$VAR</code> æ˜¯ <code>hello</code> ã€‚</p> <h3 id="ç¯å¢ƒ-ğŸ”—">ç¯å¢ƒ <a href="#environment">ğŸ”—</a></h3> <p>æ·»åŠ ç¯å¢ƒå˜é‡ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ã€‚ ä»»ä½•å¸ƒå°”å€¼ï¼ˆtrueï¼Œfalseï¼Œyesï¼Œnoï¼‰éƒ½éœ€è¦ç”¨å¼•å·å¼•èµ·æ¥ï¼Œä»¥ç¡®ä¿YMLè§£æå™¨ä¸ä¼šå°†å…¶è½¬æ¢ä¸ºTrueæˆ–Falseã€‚</p> <p>ä»…å…·æœ‰é”®çš„ç¯å¢ƒå˜é‡åœ¨è¿è¡ŒComposeçš„è®¡ç®—æœºä¸Šè§£æä¸ºå®ƒä»¬çš„å€¼ï¼Œè¿™å¯¹äºç§˜å¯†æˆ–ç‰¹å®šäºä¸»æœºçš„å€¼å¾ˆæœ‰ç”¨ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>environment:
  RACK_ENV: development
  SHOW: 'true'
  SESSION_SECRET:

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>environment:
  - RACK_ENV=development
  - SHOW=true
  - SESSION_SECRET

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p><strong>æ³¨æ„</strong></p> <p>å¦‚æœæ‚¨çš„æœåŠ¡æŒ‡å®šäº† <a href="#build">æ„å»º</a> é€‰é¡¹ï¼Œ <code>environment</code> åˆ™ åœ¨æ„å»ºè¿‡ç¨‹ ä¸­ <em>ä¸ä¼š</em> è‡ªåŠ¨æ˜¾ç¤ºä¸­ å®šä¹‰çš„å˜é‡ ã€‚ ä½¿ç”¨çš„ <a href="#args">args</a> å­é€‰é¡¹ <code>build</code> æ¥å®šä¹‰æ„å»ºæ—¶ç¯å¢ƒå˜é‡ã€‚</p></blockquote> <h3 id="æš´éœ²-ğŸ”—">æš´éœ² <a href="#expose">ğŸ”—</a></h3> <p>å…¬å¼€ç«¯å£è€Œä¸å°†å…¶å‘å¸ƒåˆ°ä¸»æœºä¸Š-åªæœ‰é“¾æ¥çš„æœåŠ¡æ‰èƒ½è®¿é—®å®ƒä»¬ã€‚ åªèƒ½æŒ‡å®šå†…éƒ¨ç«¯å£ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>expose:
  - &quot;3000&quot;
  - &quot;8000&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="external-links-ğŸ”—">external_links <a href="#external_links">ğŸ”—</a></h3> <p>é“¾æ¥åˆ°åœ¨æ­¤èŒƒå›´ä¹‹å¤– <code>docker-compose.yml</code> ç”šè‡³åœ¨Composeä¹‹å¤– å¼€å§‹çš„å®¹å™¨ ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæä¾›å…±äº«æˆ–å…¬å…±æœåŠ¡çš„å®¹å™¨ã€‚ åŒæ—¶æŒ‡å®šå®¹å™¨åç§°å’Œé“¾æ¥åˆ«åï¼ˆ ï¼‰ æ—¶ï¼Œè¯· <code>external_links</code> éµå¾ªä¸legacyé€‰é¡¹ç›¸ä¼¼çš„è¯­ä¹‰ ã€‚ <code>links</code> <code>CONTAINER:ALIAS</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>external_links:
  - redis_1
  - project_db_1:mysql
  - project_db_1:postgresql

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p><strong>æ³¨æ„</strong></p> <p>å¤–éƒ¨åˆ›å»ºçš„å®¹å™¨å¿…é¡»è¿æ¥åˆ°ä¸é“¾æ¥åˆ°å®ƒä»¬çš„æœåŠ¡ç›¸åŒçš„ç½‘ç»œä¸­çš„è‡³å°‘ä¸€ä¸ªã€‚ <a href="https://docs.docker.com/compose/compose-file/compose-file-v2#links" target="_blank" rel="noopener noreferrer">é“¾æ¥<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ˜¯æ—§é€‰é¡¹ã€‚ æˆ‘ä»¬å»ºè®® æ”¹ä¸º ä½¿ç”¨ <a href="#networks">ç½‘ç»œ</a> ã€‚</p></blockquote> <blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨é›†ç¾¤æ¨¡å¼ä¸‹éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>external_links</code> æ—¶ï¼Œ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">å°†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¿½ç•¥ è¯¥ é€‰é¡¹<a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="extra-hosts-ğŸ”—">extra_hosts <a href="#extra_hosts">ğŸ”—</a></h3> <p>æ·»åŠ ä¸»æœºåæ˜ å°„ã€‚ ä½¿ç”¨ä¸docker client <code>--add-host</code> å‚æ•° ç›¸åŒçš„å€¼ ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>extra_hosts:
  - &quot;somehost:162.242.195.82&quot;
  - &quot;otherhost:50.31.209.229&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>åœ¨ <code>/etc/hosts</code> æ­¤æœåŠ¡çš„å†…éƒ¨å®¹å™¨ä¸­ åˆ›å»ºä¸€ä¸ªå…·æœ‰ipåœ°å€å’Œä¸»æœºåçš„æ¡ç›® ï¼Œä¾‹å¦‚ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>162.242.195.82  somehost
50.31.209.229   otherhost

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="å¥åº·-æ£€æŸ¥ğŸ”—">å¥åº· <a href="#healthcheck">æ£€æŸ¥ğŸ”—</a></h3> <p>é…ç½®è¿è¡Œçš„æ£€æŸ¥ä»¥ç¡®å®šè¯¥æœåŠ¡çš„å®¹å™¨æ˜¯å¦â€œå¥åº·â€ã€‚ æœ‰å…³è¿è¡Œ <a href="https://docs.docker.com/engine/reference/builder/#healthcheck" target="_blank" rel="noopener noreferrer">çŠ¶å†µæ£€æŸ¥<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¦‚ä½•å·¥ä½œçš„è¯¦ç»†ä¿¡æ¯ï¼Œ è¯·å‚é˜…æ–‡æ¡£ä¸­çš„ <a href="https://docs.docker.com/engine/reference/builder/#healthcheck" target="_blank" rel="noopener noreferrer">HEALTHCHECK DockerfileæŒ‡ä»¤<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>healthcheck:
  test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;]
  interval: 1m30s
  timeout: 10s
  retries: 3
  start_period: 40s

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>interval</code> ï¼Œ <code>timeout</code> å¹¶ <code>start_period</code> æŒ‡å®šä¸º <a href="#specifying-durations">duration</a> ã€‚</p> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-34" target="_blank" rel="noopener noreferrer">3.4ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p> <p>è¯¥ <code>start_period</code> é€‰é¡¹ä»¥æ–‡ä»¶æ ¼å¼3.4æ·»åŠ ã€‚</p></blockquote> <p><code>test</code> å¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–åˆ—è¡¨ã€‚ å¦‚æœå®ƒæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œç¬¬ä¸€é¡¹å¿…é¡»æ˜¯ <code>NONE</code> ï¼Œ <code>CMD</code> æˆ– <code>CMD-SHELL</code> ã€‚ å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™ç­‰æ•ˆäºæŒ‡å®š <code>CMD-SHELL</code> åè·Ÿè¯¥å­—ç¬¦ä¸²ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># Hit the local web app
test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å¦‚ä¸Šæ‰€è¿°ï¼Œä½†åŒ…è£¹åœ¨ä¸­ <code>/bin/sh</code> ã€‚ ä»¥ä¸‹ä¸¤ç§å½¢å¼æ˜¯ç­‰æ•ˆçš„ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>test: [&quot;CMD-SHELL&quot;, &quot;curl -f http://localhost || exit 1&quot;]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>test: curl -f https://localhost || exit 1

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¦ç¦ç”¨å›¾åƒè®¾ç½®çš„ä»»ä½•é»˜è®¤è¿è¡ŒçŠ¶å†µæ£€æŸ¥ï¼Œå¯ä»¥ä½¿ç”¨ <code>disable: true</code> ã€‚ è¿™ç­‰æ•ˆäºæŒ‡å®š <code>test: [&quot;NONE&quot;]</code> ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>healthcheck:
  disable: true

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="å›¾ç‰‡-ğŸ”—">å›¾ç‰‡ <a href="#image">ğŸ”—</a></h3> <p>æŒ‡å®šç”¨äºå¯åŠ¨å®¹å™¨çš„å›¾åƒã€‚ å¯ä»¥æ˜¯å­˜å‚¨åº“/æ ‡ç­¾æˆ–éƒ¨åˆ†å›¾åƒIDã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>image: redis

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>image: ubuntu:18.04

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>image: tutum/influxdb

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>image: example-registry.com:4000/postgresql

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>image: a4bc65fd

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å¦‚æœå›¾åƒä¸å­˜åœ¨ï¼Œé™¤éæ‚¨è¿˜æŒ‡å®šäº† <a href="#build">build</a> ï¼Œå¦åˆ™Composeä¼šå°è¯•æ‹‰å‡ºå®ƒï¼Œ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå°†ä½¿ç”¨æŒ‡å®šçš„é€‰é¡¹æ¥æ„å»ºå®ƒå¹¶ä½¿ç”¨æŒ‡å®šçš„æ ‡ç­¾å¯¹å…¶è¿›è¡Œæ ‡è®°ã€‚</p> <h3 id="åˆå§‹åŒ–-ğŸ”—">åˆå§‹åŒ– <a href="#init">ğŸ”—</a></h3> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-37" target="_blank" rel="noopener noreferrer">3.7ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p></blockquote> <p>åœ¨å®¹å™¨å†…è¿è¡Œä¸€ä¸ªåˆå§‹åŒ–ç¨‹åºï¼Œä»¥è½¬å‘ä¿¡å·å¹¶è·å–è¿›ç¨‹ã€‚ è®¾ç½®æ­¤é€‰é¡¹å¯ä»¥ <code>true</code> ä¸ºæœåŠ¡å¯ç”¨æ­¤åŠŸèƒ½ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  web:
    image: alpine:latest
    init: true

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>ä½¿ç”¨çš„é»˜è®¤åˆå§‹åŒ–äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯ <a href="https://github.com/krallin/tini" target="_blank" rel="noopener noreferrer">Tini<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ï¼Œå¹¶å®‰è£…åœ¨ <code>/usr/libexec/docker-init</code> å®ˆæŠ¤ç¨‹åºä¸»æœºä¸Šã€‚ æ‚¨å¯ä»¥é€šè¿‡ <a href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file" target="_blank" rel="noopener noreferrer"><code>init-path</code>é…ç½®é€‰é¡¹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å°†å®ˆæŠ¤ç¨‹åºé…ç½®ä¸ºä½¿ç”¨è‡ªå®šä¹‰initäºŒè¿›åˆ¶æ–‡ä»¶ ã€‚</p></blockquote> <h3 id="éš”ç¦»-ğŸ”—">éš”ç¦» <a href="#isolation">ğŸ”—</a></h3> <p>æŒ‡å®šå®¹å™¨çš„éš”ç¦»æŠ€æœ¯ã€‚ åœ¨Linuxä¸Šï¼Œå”¯ä¸€æ”¯æŒçš„å€¼æ˜¯ <code>default</code> ã€‚ åœ¨Windowsä¸­ï¼Œå¯æ¥å—çš„å€¼æ˜¯ <code>default</code> ï¼Œ <code>process</code> å’Œ <code>hyperv</code> ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œ è¯·å‚è€ƒ <a href="https://docs.docker.com/engine/reference/commandline/run/#specify-isolation-technology-for-container---isolation" target="_blank" rel="noopener noreferrer">Docker Engineæ–‡æ¡£<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <h3 id="æ ‡ç­¾-ğŸ”—">æ ‡ç­¾ <a href="#labels-2">ğŸ”—</a></h3> <p>ä½¿ç”¨ <a href="https://docs.docker.com/config/labels-custom-metadata/" target="_blank" rel="noopener noreferrer">Dockeræ ‡ç­¾<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å°†å…ƒæ•°æ®æ·»åŠ åˆ°å®¹å™¨ ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ã€‚</p> <p>å»ºè®®æ‚¨ä½¿ç”¨åå‘DNSè¡¨ç¤ºæ³•ï¼Œä»¥é˜²æ­¢æ ‡ç­¾ä¸å…¶ä»–è½¯ä»¶ä½¿ç”¨çš„æ ‡ç­¾å†²çªã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>labels:
  com.example.description: &quot;Accounting webapp&quot;
  com.example.department: &quot;Finance&quot;
  com.example.label-with-empty-value: &quot;&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>labels:
  - &quot;com.example.description=Accounting webapp&quot;
  - &quot;com.example.department=Finance&quot;
  - &quot;com.example.label-with-empty-value&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="é“¾æ¥-ğŸ”—">é“¾æ¥ <a href="#links">ğŸ”—</a></h3> <blockquote><p><strong>è­¦å‘Š</strong></p> <p>è¯¥ <code>--link</code> æ ‡å¿—æ˜¯Dockerçš„é—ç•™åŠŸèƒ½ã€‚ å®ƒæœ€ç»ˆå¯èƒ½ä¼šè¢«åˆ é™¤ã€‚ é™¤éæ‚¨ç»å¯¹éœ€è¦ç»§ç»­ä½¿ç”¨å®ƒï¼Œå¦åˆ™å»ºè®®æ‚¨ä½¿ç”¨ <a href="https://docs.docker.com/compose/networking/" target="_blank" rel="noopener noreferrer">ç”¨æˆ·å®šä¹‰çš„ç½‘ç»œ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ¥ä¿ƒè¿›ä¸¤ä¸ªå®¹å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œè€Œä¸è¦ä½¿ç”¨ <code>--link</code> ã€‚</p> <p>ç”¨æˆ·å®šä¹‰çš„ç½‘ç»œä¸æ”¯æŒæ‚¨å¯ä»¥ä½¿ç”¨çš„åŠŸèƒ½ä¹‹ä¸€ <code>--link</code> æ˜¯åœ¨å®¹å™¨ä¹‹é—´å…±äº«ç¯å¢ƒå˜é‡ã€‚ ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å…¶ä»–æœºåˆ¶ï¼ˆä¾‹å¦‚å·ï¼‰ä»¥æ›´å¯æ§çš„æ–¹å¼åœ¨å®¹å™¨ä¹‹é—´å…±äº«ç¯å¢ƒå˜é‡ã€‚</p></blockquote> <p>é“¾æ¥åˆ°å¦ä¸€ä¸ªæœåŠ¡ä¸­çš„å®¹å™¨ã€‚ æŒ‡å®šæœåŠ¡åç§°å’Œé“¾æ¥åˆ«åï¼ˆ <code>&quot;SERVICE:ALIAS&quot;</code> ï¼‰ï¼Œæˆ–è€…ä»…æŒ‡å®šæœåŠ¡åç§°ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>web:
  links:
    - &quot;db&quot;
    - &quot;db:database&quot;
    - &quot;redis&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>é“¾æ¥æœåŠ¡çš„å®¹å™¨å¯ä»¥é€šè¿‡ä¸åˆ«åç›¸åŒçš„ä¸»æœºåè®¿é—®ï¼Œå¦‚æœæœªæŒ‡å®šåˆ«åï¼Œåˆ™å¯ä»¥ä½¿ç”¨æœåŠ¡åã€‚</p> <p>ä¸éœ€è¦é“¾æ¥å³å¯ä½¿æœåŠ¡è¿›è¡Œé€šä¿¡-é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•æœåŠ¡éƒ½å¯ä»¥ä½¿ç”¨è¯¥æœåŠ¡çš„åç§°è®¿é—®ä»»ä½•å…¶ä»–æœåŠ¡ã€‚ ï¼ˆå¦è¯·å‚è§ <a href="https://docs.docker.com/compose/networking/#links" target="_blank" rel="noopener noreferrer">Composeä¸­çš„Networkingä¸­<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> çš„ <a href="https://docs.docker.com/compose/networking/#links" target="_blank" rel="noopener noreferrer">Linksä¸»é¢˜<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚ï¼‰</p> <p>é“¾æ¥ä¹Ÿä»¥ä¸ <a href="#depends_on">depends_on</a> ç›¸åŒçš„æ–¹å¼è¡¨ç¤ºæœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³» ï¼Œå› æ­¤å®ƒä»¬ç¡®å®šäº†æœåŠ¡å¯åŠ¨çš„é¡ºåºã€‚</p> <blockquote><p><strong>æ³¨æ„</strong></p> <p>å¦‚æœåŒæ—¶å®šä¹‰é“¾æ¥å’Œ <a href="#networks">ç½‘ç»œ</a> ï¼Œåˆ™å®ƒä»¬ä¹‹é—´å…·æœ‰é“¾æ¥çš„æœåŠ¡å¿…é¡»å…±äº«è‡³å°‘ä¸€ä¸ªå…¬å…±ç½‘ç»œæ‰èƒ½è¿›è¡Œé€šä¿¡ã€‚</p></blockquote> <blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨é›†ç¾¤æ¨¡å¼ä¸‹éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>links</code> æ—¶ï¼Œ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">å°†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¿½ç•¥ è¯¥ é€‰é¡¹<a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="è®°å½•-ğŸ”—">è®°å½• <a href="#logging">ğŸ”—</a></h3> <p>æœåŠ¡çš„æ—¥å¿—è®°å½•é…ç½®ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>logging:
  driver: syslog
  options:
    syslog-address: &quot;tcp://192.168.0.42:123&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>è¯¥ <code>driver</code> åç§°æŒ‡å®šäº†æœåŠ¡å®¹å™¨çš„æ—¥å¿—è®°å½•é©±åŠ¨ç¨‹åºï¼Œä»¥åŠ <code>--log-driver</code> docker runé€‰é¡¹ï¼ˆ <a href="https://docs.docker.com/config/containers/logging/configure/" target="_blank" rel="noopener noreferrer">åœ¨æ­¤å¤„è®°å½•<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ï¼‰ã€‚</p> <p>é»˜è®¤å€¼ä¸ºjson-fileã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>driver: &quot;json-file&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>driver: &quot;syslog&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>driver: &quot;none&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p><strong>æ³¨æ„</strong></p> <p>åªæœ‰ <code>json-file</code> å’Œ <code>journald</code> é©±åŠ¨ç¨‹åºæ‰èƒ½ä» <code>docker-compose up</code> å’Œ ç›´æ¥æä¾›æ—¥å¿— <code>docker-compose logs</code> ã€‚ ä½¿ç”¨ä»»ä½•å…¶ä»–é©±åŠ¨ç¨‹åºä¸ä¼šæ‰“å°ä»»ä½•æ—¥å¿—ã€‚</p></blockquote> <p>ä½¿ç”¨ <code>options</code> é”® ä¸ºæ—¥å¿—è®°å½•é©±åŠ¨ç¨‹åºæŒ‡å®šæ—¥å¿—è®°å½•é€‰é¡¹ ï¼Œå¦‚çš„ <code>--log-opt</code> é€‰é¡¹ <code>docker run</code> ã€‚</p> <p>æ—¥å¿—è®°å½•é€‰é¡¹æ˜¯é”®å€¼å¯¹ã€‚ <code>syslog</code> é€‰é¡¹ ç¤ºä¾‹ ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>driver: &quot;syslog&quot;
options:
  syslog-address: &quot;tcp://192.168.0.42:123&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>é»˜è®¤é©±åŠ¨ç¨‹åº <a href="https://docs.docker.com/config/containers/logging/json-file/" target="_blank" rel="noopener noreferrer">json-file<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ï¼Œå…·æœ‰ç”¨äºé™åˆ¶æ‰€å­˜å‚¨æ—¥å¿—æ•°é‡çš„é€‰é¡¹ã€‚ ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨é”®å€¼å¯¹ä»¥è·å–æœ€å¤§å­˜å‚¨å¤§å°å’Œæœ€å¤§æ–‡ä»¶æ•°ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>options:
  max-size: &quot;200k&quot;
  max-file: &quot;10&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢æ˜¾ç¤ºçš„ç¤ºä¾‹å°†å­˜å‚¨æ—¥å¿—æ–‡ä»¶ï¼Œç›´åˆ°å®ƒä»¬è¾¾åˆ° <code>max-size</code> 200kBï¼Œç„¶åæ—‹è½¬å®ƒä»¬ã€‚ å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨é‡ç”±è¯¥ <code>max-file</code> å€¼ æŒ‡å®š ã€‚ éšç€æ—¥å¿—è¶…è¿‡æœ€å¤§é™åˆ¶ï¼Œå°†åˆ é™¤è¾ƒæ—§çš„æ—¥å¿—æ–‡ä»¶ä»¥å…è®¸å­˜å‚¨æ–°æ—¥å¿—ã€‚</p> <p>è¿™æ˜¯ä¸€ä¸ª <code>docker-compose.yml</code> é™åˆ¶æ—¥å¿—å­˜å‚¨ çš„ç¤ºä¾‹ æ–‡ä»¶ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  some-service:
    image: some-service
    logging:
      driver: &quot;json-file&quot;
      options:
        max-size: &quot;200k&quot;
        max-file: &quot;10&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>å¯ç”¨çš„æ—¥å¿—è®°å½•é€‰é¡¹å–å†³äºæ‚¨ä½¿ç”¨çš„æ—¥å¿—è®°å½•é©±åŠ¨ç¨‹åº</p> <p>ä¸Šé¢ç”¨äºæ§åˆ¶æ—¥å¿—æ–‡ä»¶å’Œå¤§å°çš„ç¤ºä¾‹ä½¿ç”¨ç‰¹å®šäº <a href="https://docs.docker.com/config/containers/logging/json-file/" target="_blank" rel="noopener noreferrer">json-file driverçš„<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> é€‰é¡¹ ã€‚ è¿™äº›ç‰¹å®šé€‰é¡¹åœ¨å…¶ä»–æ—¥å¿—è®°å½•é©±åŠ¨ç¨‹åºä¸Šä¸å¯ç”¨ã€‚ æœ‰å…³å—æ”¯æŒçš„æ—¥å¿—è®°å½•é©±åŠ¨ç¨‹åºåŠå…¶é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜… <a href="https://docs.docker.com/config/containers/logging/configure/" target="_blank" rel="noopener noreferrer">æ—¥å¿—è®°å½•é©±åŠ¨ç¨‹åº<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡æ¡£ã€‚</p></blockquote> <h3 id="network-mode-ğŸ”—">network_mode <a href="#network_mode">ğŸ”—</a></h3> <p>ç½‘ç»œæ¨¡å¼ã€‚ ä½¿ç”¨ä¸docker client <code>--network</code> å‚æ•° ç›¸åŒçš„å€¼ ï¼Œä»¥åŠç‰¹æ®Šå½¢å¼ <code>service:[service name]</code> ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>network_mode: &quot;bridge&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>network_mode: &quot;host&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>network_mode: &quot;none&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>network_mode: &quot;service:[service name]&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>network_mode: &quot;container:[container name/id]&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p><strong>æ³¨æ„</strong></p> <ul><li><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨é›†ç¾¤æ¨¡å¼ä¸‹éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ—¶ï¼Œ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">å°†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¿½ç•¥æ­¤é€‰é¡¹ ã€‚</li> <li><code>network_mode: &quot;host&quot;</code> ä¸èƒ½ä¸ <a href="#links">é“¾æ¥</a> æ··åˆåœ¨ä¸€èµ· ã€‚</li></ul></blockquote> <h3 id="ç½‘ç»œ-ğŸ”—">ç½‘ç»œ <a href="#networks">ğŸ”—</a></h3> <p>è¦åŠ å…¥çš„ç½‘ç»œï¼Œå¼•ç”¨ <a href="#network-configuration-reference">é¡¶çº§ <code>networks</code> å¯†é’¥</a> ä¸‹çš„æ¡ç›® ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>services:
  some-service:
    networks:
     - some-network
     - other-network

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="åˆ«å">åˆ«å</h4> <p>ç½‘ç»œä¸Šæ­¤æœåŠ¡çš„åˆ«åï¼ˆå¤‡ç”¨ä¸»æœºåï¼‰ã€‚ åŒä¸€ç½‘ç»œä¸Šçš„å…¶ä»–å®¹å™¨å¯ä»¥ä½¿ç”¨æœåŠ¡åç§°æˆ–æ­¤åˆ«åæ¥è¿æ¥åˆ°æœåŠ¡çš„å®¹å™¨ä¹‹ä¸€ã€‚</p> <p>ç”±äº <code>aliases</code> æ˜¯ç½‘ç»œèŒƒå›´çš„ï¼Œå› æ­¤åŒä¸€æœåŠ¡åœ¨ä¸åŒçš„ç½‘ç»œä¸Šå¯ä»¥å…·æœ‰ä¸åŒçš„åˆ«åã€‚</p> <blockquote><p><strong>æ³¨æ„</strong></p> <p>ç½‘ç»œèŒƒå›´å†…çš„åˆ«åå¯ä»¥ç”±å¤šä¸ªå®¹å™¨ç”šè‡³å¤šä¸ªæœåŠ¡å…±äº«ã€‚ å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ™ä¸èƒ½ä¿è¯åç§°è§£æåˆ°å“ªä¸ªå®¹å™¨ã€‚</p></blockquote> <p>ä¸€èˆ¬æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>services:
  some-service:
    networks:
      some-network:
        aliases:
          - alias1
          - alias3
      other-network:
        aliases:
          - alias2

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæä¾›äº†ä¸‰ç§æœåŠ¡ï¼ˆ <code>web</code> ï¼Œ <code>worker</code> ï¼Œå’Œ <code>db</code> ï¼‰ï¼Œå…¶ä¸­ä¸¤ä¸ªç½‘ç»œï¼ˆæ²¿ <code>new</code> å’Œ <code>legacy</code> ï¼‰ã€‚ è¯¥ <code>db</code> æœåŠ¡æ˜¯åœ¨åˆ°è¾¾çš„ä¸»æœºå <code>db</code> æˆ– <code>database</code> ä¸Š <code>new</code> ç½‘ç»œï¼Œå¹¶ <code>db</code> æˆ– <code>mysql</code> å°†ä¸Š <code>legacy</code> ç½‘ç»œã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;

services:
  web:
    image: &quot;nginx:alpine&quot;
    networks:
      - new

  worker:
    image: &quot;my-worker-image:latest&quot;
    networks:
      - legacy

  db:
    image: mysql
    networks:
      new:
        aliases:
          - database
      legacy:
        aliases:
          - mysql

networks:
  new:
  legacy:

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="ipv4-addressï¼Œipv6-address">ipv4_addressï¼Œipv6_address</h4> <p>åŠ å…¥ç½‘ç»œåï¼Œä¸ºæ­¤æœåŠ¡çš„å®¹å™¨æŒ‡å®šä¸€ä¸ªé™æ€IPåœ°å€ã€‚</p> <p><a href="#network-configuration-reference">é¡¶çº§ç½‘ç»œéƒ¨åˆ†ä¸­</a> çš„ç›¸åº”ç½‘ç»œé…ç½® å¿…é¡»å…·æœ‰ä¸€ä¸ª <code>ipam</code> å—ï¼Œå…¶ä¸­å­ç½‘é…ç½®è¦†ç›–æ¯ä¸ªé™æ€åœ°å€ã€‚</p> <blockquote><p>å¦‚æœéœ€è¦IPv6å¯»å€ï¼Œåˆ™ <a href="https://docs.docker.com/compose/compose-file/compose-file-v2/#enable_ipv6" target="_blank" rel="noopener noreferrer"><code>enable_ipv6</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¿…é¡»è®¾ç½® è¯¥ é€‰é¡¹ï¼Œå¹¶ä¸”å¿…é¡»ä½¿ç”¨ <a href="https://docs.docker.com/compose/compose-file/compose-file-v2/#ipv4_address-ipv6_address" target="_blank" rel="noopener noreferrer">2.xç‰ˆæœ¬çš„Composeæ–‡ä»¶<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚ <em>IPv6é€‰é¡¹å½“å‰åœ¨ç¾¤é›†æ¨¡å¼ä¸‹ä¸èµ·ä½œç”¨</em> ã€‚</p></blockquote> <p>ä¸€ä¸ªä¾‹å­ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;

services:
  app:
    image: nginx:alpine
    networks:
      app_net:
        ipv4_address: 172.16.238.10
        ipv6_address: 2001:3984:3989::10

networks:
  app_net:
    ipam:
      driver: default
      config:
        - subnet: &quot;172.16.238.0/24&quot;
        - subnet: &quot;2001:3984:3989::/64&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="pid-ğŸ”—">PID <a href="#pid">ğŸ”—</a></h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>pid: &quot;host&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å°†PIDæ¨¡å¼è®¾ç½®ä¸ºä¸»æœºPIDæ¨¡å¼ã€‚ è¿™å°†æ‰“å¼€å®¹å™¨å’Œä¸»æœºæ“ä½œç³»ç»Ÿä¹‹é—´çš„PIDåœ°å€ç©ºé—´å…±äº«ã€‚ ä½¿ç”¨æ­¤æ ‡å¿—å¯åŠ¨çš„å®¹å™¨å¯ä»¥è®¿é—®å’Œæ“ä½œè£¸æœºåç§°ç©ºé—´ä¸­çš„å…¶ä»–å®¹å™¨ï¼Œåä¹‹äº¦ç„¶ã€‚</p> <h3 id="æ¸¯å£-ğŸ”—">æ¸¯å£ <a href="#ports">ğŸ”—</a></h3> <p>éœ²å‡ºç«¯å£ã€‚</p> <blockquote><p><strong>æ³¨æ„</strong></p> <p>ç«¯å£æ˜ å°„ä¸ <code>network_mode: host</code></p></blockquote> <h4 id="çŸ­è¯­æ³•-2">çŸ­è¯­æ³•</h4> <p>è¦ä¹ˆæŒ‡å®šä¸¤ä¸ªç«¯å£ï¼ˆ <code>HOST:CONTAINER</code> ï¼‰ï¼Œè¦ä¹ˆä»…æŒ‡å®šå®¹å™¨ç«¯å£ï¼ˆé€‰æ‹©äº†ä¸´æ—¶ä¸»æœºç«¯å£ï¼‰ã€‚</p> <blockquote><p><strong>æ³¨æ„</strong></p> <p>å½“ä»¥è¯¥ <code>HOST:CONTAINER</code> æ ¼å¼ æ˜ å°„ç«¯å£ æ—¶ï¼Œä½¿ç”¨ä½äº60çš„å®¹å™¨ç«¯å£å¯èƒ½ä¼šé‡åˆ°é”™è¯¯çš„ç»“æœï¼Œå› ä¸ºYAMLä¼šå°†æ ¼å¼ <code>xx:yy</code> ä¸­çš„ æ•°å­—è§£æ ä¸ºä»¥60ä¸ºåº•çš„å€¼ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®å§‹ç»ˆå°†ç«¯å£æ˜ å°„æ˜¾å¼æŒ‡å®šä¸ºå­—ç¬¦ä¸²ã€‚</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>ports:
  - &quot;3000&quot;
  - &quot;3000-3005&quot;
  - &quot;8000:8000&quot;
  - &quot;9090-9091:8080-8081&quot;
  - &quot;49100:22&quot;
  - &quot;127.0.0.1:8001:8001&quot;
  - &quot;127.0.0.1:5000-5010:5000-5010&quot;
  - &quot;6060:6060/udp&quot;
  - &quot;12400-12500:1240&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="é•¿è¯­æ³•-2">é•¿è¯­æ³•</h4> <p>é•¿æ ¼å¼è¯­æ³•å…è®¸é…ç½®å…¶ä»–ä¸èƒ½ä»¥çŸ­æ ¼å¼è¡¨ç¤ºçš„å­—æ®µã€‚</p> <ul><li><code>target</code> ï¼šå®¹å™¨å†…çš„ç«¯å£</li> <li><code>published</code> ï¼šå…¬å¼€æš´éœ²çš„æ¸¯å£</li> <li><code>protocol</code> ï¼šç«¯å£åè®®ï¼ˆ <code>tcp</code> æˆ– <code>udp</code> ï¼‰</li> <li><code>mode</code> ï¼š <code>host</code> ç”¨äºåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå‘å¸ƒä¸»æœºç«¯å£ï¼Œæˆ– <code>ingress</code> ä½¿ç¾¤é›†æ¨¡å¼ç«¯å£è¾¾åˆ°è´Ÿè½½å¹³è¡¡ã€‚</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>ports:
  - target: 80
    published: 8080
    protocol: tcp
    mode: host

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-32" target="_blank" rel="noopener noreferrer">3.2ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p> <p>é•¿è¯­æ³•æ˜¯v3.2æ–‡ä»¶æ ¼å¼çš„æ–°è¯­æ³•ã€‚</p></blockquote> <h3 id="é‡æ–°å¯åŠ¨-ğŸ”—">é‡æ–°å¯åŠ¨ <a href="#restart">ğŸ”—</a></h3> <p><code>no</code> æ˜¯é»˜è®¤çš„ <a href="https://docs.docker.com/config/containers/start-containers-automatically/#use-a-restart-policy" target="_blank" rel="noopener noreferrer">é‡æ–°å¯åŠ¨ç­–ç•¥<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ï¼Œåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šé‡æ–°å¯åŠ¨å®¹å™¨ã€‚ å½“ <code>always</code> æŒ‡å®šæ—¶ï¼Œå®¹å™¨æ€»æ˜¯é‡æ–°å¯åŠ¨ã€‚ è¯¥ <code>on-failure</code> å¦‚æœé€€å‡ºä»£ç æŒ‡ç¤ºçš„æ•…éšœé”™è¯¯æ”¿ç­–é‡å¯çš„å®¹å™¨ã€‚ <code>unless-stopped</code> æ€»æ˜¯é‡æ–°å¯åŠ¨å®¹å™¨ï¼Œé™¤éå®¹å™¨åœæ­¢ï¼ˆæ‰‹åŠ¨æˆ–å…¶ä»–æ–¹å¼ï¼‰ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>restart: &quot;no&quot;
restart: always
restart: on-failure
restart: unless-stopped

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨ä»¥ç¾¤é›†æ¨¡å¼éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>restart</code> æ—¶ï¼Œ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">å°†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¿½ç•¥ è¯¥ é€‰é¡¹ ã€‚</p></blockquote> <h3 id="ç§˜å¯†-ğŸ”—">ç§˜å¯† <a href="#secrets">ğŸ”—</a></h3> <p>ä½¿ç”¨æŒ‰æœåŠ¡ <code>secrets</code> é…ç½® ï¼ŒæŒ‰æœåŠ¡æˆäºˆå¯¹æœºå¯†çš„è®¿é—®æƒé™ ã€‚ æ”¯æŒä¸¤ç§ä¸åŒçš„è¯­æ³•å˜ä½“ã€‚</p> <blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p>è¯¥å¯†ç å¿…é¡»å·²ç»å­˜åœ¨æˆ– åœ¨æ’°å†™æ–‡ä»¶ <a href="#secrets-configuration-reference">çš„é¡¶çº§ <code>secrets</code> é…ç½®</a> ä¸­ <a href="#secrets-configuration-reference">å®šä¹‰</a> ï¼Œå¦åˆ™å †æ ˆéƒ¨ç½²å°†å¤±è´¥ã€‚</p></blockquote> <p>æœ‰å…³æœºå¯†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ <a href="https://docs.docker.com/engine/swarm/secrets/" target="_blank" rel="noopener noreferrer">æœºå¯†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <h4 id="çŸ­è¯­æ³•-3">çŸ­è¯­æ³•</h4> <p>ç®€çŸ­çš„è¯­æ³•å˜ä½“ä»…æŒ‡å®šç§˜å¯†åç§°ã€‚ è¿™ä¼šæˆäºˆå®¹å™¨è®¿é—®æœºå¯†çš„æƒé™ï¼Œå¹¶å°†å…¶å®‰è£…åœ¨ <code>/run/secrets/&lt;secret_name&gt;</code> å®¹å™¨å†…ã€‚ æºåç§°å’Œç›®æ ‡å®‰è£…ç‚¹éƒ½è®¾ç½®ä¸ºæœºå¯†åç§°ã€‚</p> <p>ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨shortè¯­æ³•æˆäºˆ <code>redis</code> æœåŠ¡å¯¹ <code>my_secret</code> å’Œ <code>my_other_secret</code> ç§˜å¯†çš„ è®¿é—®æƒé™ ã€‚ çš„å€¼ <code>my_secret</code> è®¾ç½®ä¸ºfileçš„å†…å®¹ <code>./my_secret.txt</code> ï¼Œå¹¶ <code>my_other_secret</code> å®šä¹‰ä¸ºå¤–éƒ¨èµ„æºï¼Œè¿™æ„å‘³ç€å®ƒå·²ç»åœ¨Dockerä¸­å®šä¹‰ï¼Œå¯ä»¥é€šè¿‡è¿è¡Œ <code>docker secret create</code> å‘½ä»¤æˆ–é€šè¿‡å…¶ä»–å †æ ˆéƒ¨ç½²è¿›è¡Œå®šä¹‰ã€‚ å¦‚æœå¤–éƒ¨æœºå¯†ä¸å­˜åœ¨ï¼Œåˆ™å †æ ˆéƒ¨ç½²å°†å¤±è´¥å¹¶æ˜¾ç¤º <code>secret not found</code> é”™è¯¯ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  redis:
    image: redis:latest
    deploy:
      replicas: 1
    secrets:
      - my_secret
      - my_other_secret
secrets:
  my_secret:
    file: ./my_secret.txt
  my_other_secret:
    external: true

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="é•¿è¯­æ³•-3">é•¿è¯­æ³•</h4> <p>é•¿è¯­æ³•æä¾›äº†åœ¨æœåŠ¡çš„ä»»åŠ¡å®¹å™¨ä¸­å¦‚ä½•åˆ›å»ºæœºå¯†çš„æ›´å¤šç²’åº¦ã€‚</p> <ul><li><code>source</code> ï¼šç§˜å¯†çš„åç§°ï¼Œå› ä¸ºå®ƒå­˜åœ¨äºDockerä¸­ã€‚</li> <li><code>target</code> ï¼šè¦ <code>/run/secrets/</code> åœ¨æœåŠ¡çš„ä»»åŠ¡å®¹å™¨ä¸­ æŒ‚è½½çš„æ–‡ä»¶çš„åç§° ã€‚ <code>source</code> å¦‚æœæœªæŒ‡å®š ï¼Œ åˆ™ é»˜è®¤ä¸º ã€‚</li> <li><code>uid</code> å’Œ <code>gid</code> ï¼š <code>/run/secrets/</code> åœ¨æœåŠ¡çš„ä»»åŠ¡å®¹å™¨ ä¸­æ‹¥æœ‰æ–‡ä»¶çš„æ•°å­—UIDæˆ–GID ã€‚ <code>0</code> å¦‚æœæœªæŒ‡å®š ï¼Œ åˆ™ ä¸¤è€…éƒ½é»˜è®¤ä¸º ã€‚</li> <li><code>mode</code> ï¼šæ–‡ä»¶çš„æƒé™ä»¥ <code>/run/secrets/</code> å…«è¿›åˆ¶è¡¨ç¤ºæ³• è£…å…¥ æœåŠ¡çš„ä»»åŠ¡å®¹å™¨ä¸­ã€‚ ä¾‹å¦‚ï¼Œ <code>0444</code> è¡¨ç¤ºä¸–ç•Œå¯è¯»ã€‚ Docker 1.13.1ä¸­çš„é»˜è®¤å€¼ä¸º <code>0000</code> ï¼Œä½†æ˜¯æ˜¯ <code>0444</code> è¾ƒæ–°çš„ç‰ˆæœ¬ã€‚ æœºå¯†ä¿¡æ¯ä¸å¯å†™ï¼Œå› ä¸ºå®ƒä»¬å·²å®‰è£…åœ¨ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå› æ­¤ï¼Œå¦‚æœè®¾ç½®äº†å¯å†™ä½ï¼Œå®ƒå°†è¢«å¿½ç•¥ã€‚ å¯æ‰§è¡Œä½å¯ä»¥è®¾ç½®ã€‚ å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰UNIXæ–‡ä»¶æƒé™æ¨¡å¼ï¼Œåˆ™å¯èƒ½ä¼šå‘ç°æ­¤ <a href="http://permissions-calculator.org/" target="_blank" rel="noopener noreferrer">æƒé™è®¡ç®—å™¨<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¾ˆæœ‰ç”¨ã€‚</li></ul> <p>çš„ä¸‹é¢çš„ç¤ºä¾‹é›†åç§° <code>my_secret</code> ä»¥ <code>redis_secret</code> åœ¨å®¹å™¨å†…ï¼Œå°†æ¨¡å¼è®¾å®šä¸º <code>0440</code> ï¼ˆç»„å¯è¯»ï¼‰å’Œå¥—åœ¨ç”¨æˆ·å’Œç»„ <code>103</code> ã€‚ è¯¥ <code>redis</code> æœåŠ¡æ— æƒè®¿é—®è¯¥ <code>my_other_secret</code> æœºå¯†ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  redis:
    image: redis:latest
    deploy:
      replicas: 1
    secrets:
      - source: my_secret
        target: redis_secret
        uid: '103'
        gid: '103'
        mode: 0440
secrets:
  my_secret:
    file: ./my_secret.txt
  my_other_secret:
    external: true

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>æ‚¨å¯ä»¥æˆäºˆæœåŠ¡è®¿é—®å¤šä¸ªæœºå¯†çš„æƒé™ï¼Œå¹¶ä¸”å¯ä»¥æ··åˆé•¿çŸ­è¯­æ³•ã€‚ å®šä¹‰æœºå¯†å¹¶ä¸æ„å‘³ç€æˆäºˆæœåŠ¡å¯¹å…¶çš„è®¿é—®æƒé™ã€‚</p> <h3 id="security-opt-ğŸ”—">security_opt <a href="#security_opt">ğŸ”—</a></h3> <p>è¦†ç›–æ¯ä¸ªå®¹å™¨çš„é»˜è®¤æ ‡ç­¾æ–¹æ¡ˆã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>security_opt:
  - label:user:USER
  - label:role:ROLE

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨ä»¥ç¾¤é›†æ¨¡å¼éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>security_opt</code> æ—¶ï¼Œ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">å°†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¿½ç•¥ è¯¥ é€‰é¡¹ ã€‚</p></blockquote> <h3 id="stop-grace-period-ğŸ”—">stop_grace_period <a href="#stop_grace_period">ğŸ”—</a></h3> <p>æŒ‡å®š <a href="#stop_signal"><code>stop_signal</code></a> åœ¨å‘é€SIGKILLä¹‹å‰ï¼Œ å¦‚æœå®¹å™¨æ— æ³•å¤„ç†SIGTERMï¼ˆæˆ–å·²ä½¿ç”¨æŒ‡å®šçš„ä»»ä½•åœæ­¢ä¿¡å·ï¼‰è€Œè¯•å›¾åœæ­¢å®¹å™¨çš„ç­‰å¾…æ—¶é—´ ã€‚ æŒ‡å®šä¸º <a href="#specifying-durations">æŒç»­æ—¶é—´</a> ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>stop_grace_period: 1s

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>stop_grace_period: 1m30s

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>stop</code> åœ¨å‘é€SIGKILLä¹‹å‰ç­‰å¾…å®¹å™¨é€€å‡º10ç§’é’Ÿã€‚</p> <h3 id="stop-signal-ğŸ”—">stop_signal <a href="#stop_signal">ğŸ”—</a></h3> <p>è®¾ç½®æ›¿ä»£ä¿¡å·ä»¥åœæ­¢å®¹å™¨ã€‚ é»˜è®¤æƒ…å†µä¸‹ <code>stop</code> ä½¿ç”¨SIGTERMã€‚ ä½¿ç”¨ <code>stop_signal</code> åŸå›  è®¾ç½®æ›¿ä»£ä¿¡å· ä¼š <code>stop</code> æ”¹ä¸ºå‘é€è¯¥ä¿¡å·ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>stop_signal: SIGUSR1

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="çš„sysctl-ğŸ”—">çš„sysctl <a href="#sysctls">ğŸ”—</a></h3> <p>è¦åœ¨å®¹å™¨ä¸­è®¾ç½®å†…æ ¸å‚æ•°ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sysctls:
  net.core.somaxconn: 1024
  net.ipv4.tcp_syncookies: 0

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>sysctls:
  - net.core.somaxconn=1024
  - net.ipv4.tcp_syncookies=0

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>æ‚¨åªèƒ½ä½¿ç”¨å†…æ ¸ä¸­å·²å‘½åç©ºé—´çš„sysctlsã€‚ Dockerä¸æ”¯æŒæ›´æ”¹ä¹Ÿä¼šä¿®æ”¹ä¸»æœºç³»ç»Ÿçš„å®¹å™¨å†…çš„sysctlsã€‚ æœ‰å…³å—æ”¯æŒçš„sysctlsçš„æ¦‚è¿°ï¼Œè¯·å‚é˜… <a href="https://docs.docker.com/engine/reference/commandline/run/#configure-namespaced-kernel-parameters-sysctls-at-runtime" target="_blank" rel="noopener noreferrer">åœ¨è¿è¡Œæ—¶é…ç½®å‘½åç©ºé—´çš„å†…æ ¸å‚æ•°ï¼ˆsysctlsï¼‰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨ä»¥é›†ç¾¤æ¨¡å¼éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ—¶ï¼Œæ­¤é€‰é¡¹éœ€è¦Docker Engine 19.03æˆ–æ›´é«˜ç‰ˆæœ¬ ã€‚</p></blockquote> <h3 id="tmpfsçš„-ğŸ”—">tmpfsçš„ <a href="#tmpfs">ğŸ”—</a></h3> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-36" target="_blank" rel="noopener noreferrer">3.6ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p></blockquote> <p>åœ¨å®¹å™¨å†…å®‰è£…ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿã€‚ å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–åˆ—è¡¨ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>tmpfs: /run

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>tmpfs:
  - /run
  - /tmp

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ä»¥ï¼ˆ3-3.5ç‰ˆï¼‰æ’°å†™æ–‡ä»¶ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">ä»¥ç¾¤é›†æ¨¡å¼éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ—¶ï¼Œ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">å°†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¿½ç•¥æ­¤é€‰é¡¹ ã€‚</p></blockquote> <p>åœ¨å®¹å™¨å†…å®‰è£…ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿã€‚ Sizeå‚æ•°æŒ‡å®štmpfså®‰è£…çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ä¸å—é™åˆ¶ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>- type: tmpfs
  target: /app
  tmpfs:
    size: 1000

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="ulimits-ğŸ”—">ulimits <a href="#ulimits">ğŸ”—</a></h3> <p>è¦†ç›–å®¹å™¨çš„é»˜è®¤ulimitã€‚ æ‚¨å¯ä»¥å°†å•ä¸ªé™åˆ¶æŒ‡å®šä¸ºæ•´æ•°ï¼Œä¹Ÿå¯ä»¥å°†è½¯/ç¡¬é™åˆ¶æŒ‡å®šä¸ºæ˜ å°„ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ulimits:
  nproc: 65535
  nofile:
    soft: 20000
    hard: 40000

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="userns-mode-ğŸ”—">userns_mode <a href="#userns_mode">ğŸ”—</a></h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>userns_mode: &quot;host&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å¦‚æœDockerå®ˆæŠ¤ç¨‹åºé…ç½®äº†ç”¨æˆ·åç§°ç©ºé—´ï¼Œåˆ™ç¦ç”¨æ­¤æœåŠ¡çš„ç”¨æˆ·åç§°ç©ºé—´ã€‚ æœ‰å…³ æ›´å¤šä¿¡æ¯ï¼Œ è¯·å‚è§ <a href="https://docs.docker.com/engine/reference/commandline/dockerd/#disable-user-namespace-for-a-container" target="_blank" rel="noopener noreferrer">dockerd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">åœ¨ä»¥ç¾¤é›†æ¨¡å¼éƒ¨ç½²å †æ ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>userns_mode</code> æ—¶ï¼Œ <a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener noreferrer">å°†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¿½ç•¥ è¯¥ é€‰é¡¹ ã€‚</p></blockquote> <h3 id="å·-ğŸ”—">å· <a href="#volumes">ğŸ”—</a></h3> <p>æŒ‚è½½ä¸»æœºè·¯å¾„æˆ–å‘½åå·ï¼ŒæŒ‡å®šä¸ºæœåŠ¡çš„å­é€‰é¡¹ã€‚</p> <p>æ‚¨å¯ä»¥å°†ä¸»æœºè·¯å¾„å®‰è£…ä¸ºå•ä¸ªæœåŠ¡çš„å®šä¹‰çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ— éœ€åœ¨é¡¶çº§ <code>volumes</code> å¯†é’¥ä¸­ è¿›è¡Œå®šä¹‰ ã€‚</p> <p>ä½†æ˜¯ï¼Œå¦‚æœè¦è·¨å¤šä¸ªæœåŠ¡é‡ç”¨å·ï¼Œè¯·åœ¨ <a href="#volume-configuration-reference">é¡¶çº§ <code>volumes</code> é”®ä¸­</a> å®šä¹‰ä¸€ä¸ªå‘½åå· ã€‚ å°†å‘½åå·ä¸ <a href="#volumes-for-services-swarms-and-stack-files">æœåŠ¡ï¼Œç¾¤é›†å’Œå †æ ˆæ–‡ä»¶ä¸€èµ·ä½¿ç”¨</a> ã€‚</p> <blockquote><p>æ›´æ”¹ä¸º <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-3" target="_blank" rel="noopener noreferrer">ç‰ˆæœ¬3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ã€‚</p> <p>é¡¶çº§ <a href="#volume-configuration-reference">å·</a> é”®å®šä¹‰äº†ä¸€ä¸ªå‘½åå·ï¼Œå¹¶ä»æ¯ä¸ªæœåŠ¡çš„ <code>volumes</code> åˆ—è¡¨ä¸­ å¼•ç”¨äº†è¯¥å· ã€‚ è¿™å°†æ›¿æ¢ <code>volumes_from</code> æ—©æœŸç‰ˆæœ¬çš„Composeæ–‡ä»¶æ ¼å¼ã€‚</p></blockquote> <p>æ­¤ç¤ºä¾‹æ˜¾ç¤ºäº† æœåŠ¡ <code>mydata</code> æ­£åœ¨ä½¿ç”¨ çš„å‘½åå·ï¼ˆ ï¼‰ <code>web</code> ï¼Œä»¥åŠä¸ºå•ä¸ªæœåŠ¡ï¼ˆ <code>db</code> service ä¹‹ä¸‹çš„ç¬¬ä¸€ä¸ªè·¯å¾„ <code>volumes</code> ï¼‰ å®šä¹‰çš„ç»‘å®šå®‰è£… ã€‚ è¯¥ <code>db</code> æœåŠ¡è¿˜ä½¿ç”¨ä¸€ä¸ªåä¸º <code>dbdata</code> ï¼ˆ <code>db</code> service ä¸‹çš„ç¬¬äºŒè·¯å¾„ <code>volumes</code> ï¼‰ çš„å‘½åå· ï¼Œä½†æ˜¯ä½¿ç”¨æ—§çš„å­—ç¬¦ä¸²æ ¼å¼å®šä¹‰è¯¥å·ä»¥è£…å…¥å‘½åå·ã€‚ <code>volumes</code> å¦‚å›¾æ‰€ç¤ºï¼Œ å‘½åå·å¿…é¡»åœ¨é¡¶çº§ é”®ä¸‹åˆ—å‡ºã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  web:
    image: nginx:alpine
    volumes:
      - type: volume
        source: mydata
        target: /data
        volume:
          nocopy: true
      - type: bind
        source: ./static
        target: /opt/app/static

  db:
    image: postgres:latest
    volumes:
      - &quot;/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock&quot;
      - &quot;dbdata:/var/lib/postgresql/data&quot;

volumes:
  mydata:
  dbdata:

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><blockquote><p><strong>æ³¨æ„</strong></p> <p>æœ‰å…³å·çš„ä¸€èˆ¬ä¿¡æ¯ï¼Œè¯·å‚é˜… æ–‡æ¡£ä¸­çš„ â€œ <a href="https://docs.docker.com/storage/volumes/" target="_blank" rel="noopener noreferrer">ä½¿ç”¨å·<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å’Œ <a href="https://docs.docker.com/engine/extend/plugins_volume/" target="_blank" rel="noopener noreferrer">å·æ’ä»¶â€<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> éƒ¨åˆ†ã€‚</p></blockquote> <h4 id="çŸ­è¯­æ³•-4">çŸ­è¯­æ³•</h4> <p>ç®€çŸ­è¯­æ³•ä½¿ç”¨é€šç”¨ <code>[SOURCE:]TARGET[:MODE]</code> æ ¼å¼ï¼Œå…¶ä¸­ <code>SOURCE</code> å¯ä»¥æ˜¯ä¸»æœºè·¯å¾„æˆ–å·åã€‚ <code>TARGET</code> æ˜¯å®‰è£…å·çš„å®¹å™¨è·¯å¾„ã€‚ æ ‡å‡†æ¨¡å¼é€‚ç”¨ <code>ro</code> äºåªè¯»å’Œ <code>rw</code> è¯»å†™ï¼ˆé»˜è®¤ï¼‰ã€‚</p> <p>æ‚¨å¯ä»¥åœ¨ä¸»æœºä¸Šå®‰è£…ç›¸å¯¹è·¯å¾„ï¼Œè¯¥ç›¸å¯¹è·¯å¾„ç›¸å¯¹äºæ­£åœ¨ä½¿ç”¨çš„Composeé…ç½®æ–‡ä»¶çš„ç›®å½•è¿›è¡Œæ‰©å±•ã€‚ ç›¸å¯¹è·¯å¾„åº”å§‹ç»ˆä»¥ <code>.</code> æˆ– å¼€å¤´ <code>..</code> ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>volumes:
  # Just specify a path and let the Engine create a volume
  - /var/lib/mysql

  # Specify an absolute path mapping
  - /opt/data:/var/lib/mysql

  # Path on the host, relative to the Compose file
  - ./cache:/tmp/cache

  # User-relative path
  - ~/configs:/etc/configs/:ro

  # Named volume
  - datavolume:/var/lib/mysql

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="é•¿è¯­æ³•-4">é•¿è¯­æ³•</h4> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-32" target="_blank" rel="noopener noreferrer">3.2ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p></blockquote> <p>é•¿æ ¼å¼è¯­æ³•å…è®¸é…ç½®å…¶ä»–ä¸èƒ½ä»¥çŸ­æ ¼å¼è¡¨ç¤ºçš„å­—æ®µã€‚</p> <ul><li><code>type</code> ï¼šæ‰€è¿°å®‰è£…å‹ <code>volume</code> ï¼Œ <code>bind</code> ï¼Œ <code>tmpfs</code> æˆ– <code>npipe</code></li> <li><code>source</code> ï¼šæŒ‚è½½çš„æºï¼Œä¸»æœºä¸Šç”¨äºç»‘å®šæŒ‚è½½çš„è·¯å¾„æˆ– <a href="#volume-configuration-reference">é¡¶çº§ <code>volumes</code> å¯†é’¥ä¸­</a> å®šä¹‰çš„å·çš„åç§° ã€‚ ä¸é€‚ç”¨äºtmpfsæŒ‚è½½ã€‚</li> <li><code>target</code> ï¼šå®‰è£…äº†å·çš„å®¹å™¨ä¸­çš„è·¯å¾„</li> <li><code>read_only</code> ï¼šå°†å·è®¾ç½®ä¸ºåªè¯»çš„æ ‡å¿—</li> <li><code>bind</code> ï¼šé…ç½®å…¶ä»–ç»‘å®šé€‰é¡¹
<ul><li><code>propagation</code> ï¼šç”¨äºç»‘å®šçš„ä¼ æ’­æ¨¡å¼</li></ul></li> <li><code>volume</code> ï¼šé…ç½®å…¶ä»–éŸ³é‡é€‰é¡¹
<ul><li><code>nocopy</code> ï¼šåˆ›å»ºå·æ—¶ç¦ç”¨ä»å®¹å™¨ä¸­å¤åˆ¶æ•°æ®çš„æ ‡å¿—</li></ul></li> <li><code>tmpfs</code> ï¼šé…ç½®å…¶ä»–tmpfsé€‰é¡¹
<ul><li><code>size</code> ï¼štmpfsæŒ‚è½½çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</li></ul></li> <li><code>consistency</code> ï¼šè£…è½½çš„ä¸€è‡´æ€§è¦æ±‚ï¼Œ <code>consistent</code> ï¼ˆä¸»æœºå’Œå®¹å™¨å…·æœ‰ç›¸åŒçš„è§†å›¾ï¼‰ï¼Œ <code>cached</code> ï¼ˆè¯»ç¼“å­˜ï¼Œä¸»æœºè§†å›¾å…·æœ‰æƒå¨æ€§ï¼‰æˆ– <code>delegated</code> ï¼ˆè¯»å†™ç¼“å­˜ï¼Œå®¹å™¨çš„è§†å›¾å…·æœ‰æƒå¨æ€§ï¼‰ä¹‹ä¸€</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  web:
    image: nginx:alpine
    ports:
      - &quot;80:80&quot;
    volumes:
      - type: volume
        source: mydata
        target: /data
        volume:
          nocopy: true
      - type: bind
        source: ./static
        target: /opt/app/static

networks:
  webnet:

volumes:
  mydata:

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><blockquote><p><strong>æ³¨æ„</strong></p> <p>åˆ›å»ºç»‘å®šå®‰è£…æ—¶ï¼Œä½¿ç”¨é•¿è¯­æ³•è¦æ±‚äº‹å…ˆåˆ›å»ºå¼•ç”¨çš„æ–‡ä»¶å¤¹ã€‚ å¦‚æœè¯¥æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨çŸ­è¯­æ³•ç«‹å³åˆ›å»ºè¯¥æ–‡ä»¶å¤¹ã€‚ æœ‰å…³ æ›´å¤šä¿¡æ¯ï¼Œ è¯·å‚è§ <a href="https://docs.docker.com/storage/bind-mounts/#differences-between--v-and---mount-behavior" target="_blank" rel="noopener noreferrer">ç»‘å®šå®‰è£…æ–‡æ¡£<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p></blockquote> <h4 id="æœåŠ¡ï¼Œç¾¤é›†å’Œå †æ ˆæ–‡ä»¶çš„å·">æœåŠ¡ï¼Œç¾¤é›†å’Œå †æ ˆæ–‡ä»¶çš„å·</h4> <blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p>ä½¿ç”¨æœåŠ¡ï¼Œç¾¤é›†å’Œ <code>docker-stack.yml</code> æ–‡ä»¶æ—¶ï¼Œè¯·è®°ä½ï¼Œæ”¯æŒæœåŠ¡çš„ä»»åŠ¡ï¼ˆå®¹å™¨ï¼‰å¯ä»¥éƒ¨ç½²åœ¨ç¾¤é›†ä¸­çš„ä»»ä½•èŠ‚ç‚¹ä¸Šï¼Œå¹¶ä¸”æ¯æ¬¡æ›´æ–°æœåŠ¡æ—¶ï¼Œè¯¥èŠ‚ç‚¹éƒ½å¯ä»¥æ˜¯ä¸åŒçš„èŠ‚ç‚¹ã€‚</p></blockquote> <p>åœ¨æ²¡æœ‰å…·æœ‰æŒ‡å®šæºçš„å‘½åå·çš„æƒ…å†µä¸‹ï¼ŒDockerä¸ºæ”¯æŒæœåŠ¡çš„æ¯ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªåŒ¿åå·ã€‚ åˆ é™¤å…³è”çš„å®¹å™¨åï¼ŒåŒ¿åå·ä¸ä¼šç»§ç»­å­˜åœ¨ã€‚</p> <p>å¦‚æœè¦ä¿ç•™æ•°æ®ï¼Œè¯·ä½¿ç”¨å‘½åå·å’Œæ”¯æŒå¤šä¸»æœºçš„å·é©±åŠ¨ç¨‹åºï¼Œä»¥ä¾¿å¯ä»¥ä»ä»»ä½•èŠ‚ç‚¹è®¿é—®æ•°æ®ã€‚ æˆ–è€…ï¼Œå¯¹æœåŠ¡è®¾ç½®çº¦æŸï¼Œä»¥ä¾¿å°†å…¶ä»»åŠ¡éƒ¨ç½²åœ¨å…·æœ‰è¯¥å·çš„èŠ‚ç‚¹ä¸Šã€‚</p> <p>ä¾‹å¦‚ï¼Œ <a href="https://github.com/docker/labs/blob/master/beginner/chapters/votingapp.md" target="_blank" rel="noopener noreferrer">Docker Labsä¸­votingappç¤ºä¾‹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> çš„ <code>docker-stack.yml</code> æ–‡ä»¶ å®šä¹‰äº†ä¸€ä¸ªç§°ä¸º è¿è¡Œ æ•°æ®åº“çš„æœåŠ¡ã€‚ å®ƒè¢«é…ç½®ä¸ºå‘½åå·ä»¥å°†æ•°æ®æŒä¹…å­˜å‚¨åœ¨ç¾¤é›†ä¸­ï¼Œ<em>å¹¶ä¸”</em> è¢«é™åˆ¶ä¸ºä»…åœ¨ èŠ‚ç‚¹ ä¸Šè¿è¡Œ ã€‚ è¿™æ˜¯è¯¥æ–‡ä»¶ä¸­çš„ç›¸å…³ç‰‡æ®µï¼š <a href="https://github.com/docker/labs/blob/master/beginner/chapters/votingapp.md" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><code>db</code> <code>postgres</code> <code>manager</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  db:
    image: postgres:9.4
    volumes:
      - db-data:/var/lib/postgresql/data
    networks:
      - backend
    deploy:
      placement:
        constraints: [node.role == manager]

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="å·è£…è½½çš„ç¼“å­˜é€‰é¡¹ï¼ˆé€‚ç”¨äºmacçš„dockeræ¡Œé¢ï¼‰">å·è£…è½½çš„ç¼“å­˜é€‰é¡¹ï¼ˆé€‚ç”¨äºMacçš„Dockeræ¡Œé¢ï¼‰</h4> <p>æ‚¨å¯ä»¥åœ¨Composeæ–‡ä»¶ä¸­ä¸ºç»‘å®šå®‰è£…çš„ç›®å½•é…ç½®å®¹å™¨å’Œä¸»æœºçš„ä¸€è‡´æ€§è¦æ±‚ï¼Œä»¥æé«˜è¯»/å†™å·å®‰è£…çš„æ€§èƒ½ã€‚ è¿™äº›é€‰é¡¹è§£å†³äº† <code>osxfs</code> æ–‡ä»¶å…±äº« æ‰€ç‰¹æœ‰çš„é—®é¢˜ ï¼Œå› æ­¤ä»…é€‚ç”¨äºMacçš„Docker Desktopã€‚</p> <p>æ ‡å¿—æ˜¯ï¼š</p> <ul><li><code>consistent</code> ï¼šå®Œå…¨ä¸€è‡´ã€‚ å®¹å™¨è¿è¡Œæ—¶å’Œä¸»æœºå§‹ç»ˆä¿æŒç›¸åŒçš„å®‰è£…è§†å›¾ã€‚ è¿™æ˜¯é»˜è®¤å€¼ã€‚</li> <li><code>cached</code> ï¼šä¸»æœºå¯¹æŒ‚è½½çš„è§‚ç‚¹æ˜¯æƒå¨çš„ã€‚ åœ¨å®¹å™¨ä¸­å¯ä»¥çœ‹åˆ°ä¸»æœºä¸Šæ‰€åšçš„æ›´æ–°ï¼Œè¿™å¯èƒ½ä¼šæœ‰æ‰€å»¶è¿Ÿã€‚</li> <li><code>delegated</code> ï¼šå®¹å™¨è¿è¡Œæ—¶çš„æŒ‚è½½è§†å›¾å…·æœ‰æƒå¨æ€§ã€‚ åœ¨ä¸»æœºä¸Šçœ‹åˆ°å®¹å™¨ä¸­æ‰€åšçš„æ›´æ–°ä¹‹å‰å¯èƒ½ä¼šæœ‰æ‰€å»¶è¿Ÿã€‚</li></ul> <p>è¿™æ˜¯å°†å·é…ç½®ä¸ºçš„ç¤ºä¾‹ <code>cached</code> ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  php:
    image: php:7.1-fpm
    ports:
      - &quot;9000&quot;
    volumes:
      - .:/var/www/project:cached

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>æœ‰å…³è¿™äº›æ ‡å¿—ï¼Œå®ƒä»¬æ‰€è§£å†³çš„é—®é¢˜ä»¥åŠ <code>docker run</code> ä¸ä¹‹å¯¹åº” çš„é—®é¢˜çš„å®Œæ•´è¯¦ç»†ä¿¡æ¯ï¼Œè¯· å‚è§Docker Desktop for Macä¸»é¢˜ <a href="https://docs.docker.com/docker-for-mac/osxfs-caching/" target="_blank" rel="noopener noreferrer">â€œé’ˆå¯¹å·æŒ‚è½½ï¼ˆå…±äº«æ–‡ä»¶ç³»ç»Ÿï¼‰çš„æ€§èƒ½è°ƒæ•´â€<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <h3 id="åŸŸåï¼Œä¸»æœºåï¼Œipcï¼Œmac-addressï¼Œç‰¹æƒï¼Œread-onlyï¼Œshm-sizeï¼Œstdin-openï¼Œttyç”¨æˆ·ï¼Œworking-dir-ğŸ”—">åŸŸåï¼Œä¸»æœºåï¼ŒIPCï¼ŒMAC_ADDRESSï¼Œç‰¹æƒï¼ŒREAD_ONLYï¼Œshm_sizeï¼Œstdin_openï¼ŒTTYç”¨æˆ·ï¼Œworking_dir <a href="#domainname-hostname-ipc-mac_address-privileged-read_only-shm_size-stdin_open-tty-user-working_dir">ğŸ”—</a></h3> <p>å…¶ä¸­æ¯ä¸ªéƒ½æ˜¯ä¸€ä¸ªå€¼ï¼Œç±»ä¼¼äºå…¶ <a href="https://docs.docker.com/engine/reference/run/" target="_blank" rel="noopener noreferrer">docker run<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¯¹åº”é¡¹ã€‚ è¯·æ³¨æ„ï¼Œè¿™ <code>mac_address</code> æ˜¯ä¸€ä¸ªæ—§é€‰é¡¹ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>user: postgresql
working_dir: /code

domainname: foo.com
hostname: foo
ipc: host
mac_address: 02:42:ac:11:65:43

privileged: true

read_only: true
shm_size: 64M
stdin_open: true
tty: true

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="æŒ‡å®šæŒç»­æ—¶é—´-ğŸ”—">æŒ‡å®šæŒç»­æ—¶é—´ <a href="#specifying-durations">ğŸ”—</a></h2> <p>æŸäº›é…ç½®é€‰é¡¹ï¼ˆä¾‹å¦‚çš„ <code>interval</code> å’Œ <code>timeout</code> å­é€‰é¡¹ï¼‰ <a href="#healthcheck"><code>check</code></a> å°†æŒç»­æ—¶é—´ä½œä¸ºå­—ç¬¦ä¸²æ¥å—ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>2.5s
10s
1m30s
2h32m
5h34m56s

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ”¯æŒçš„å•ä½æ˜¯ <code>us</code> ï¼Œ <code>ms</code> ï¼Œ <code>s</code> ï¼Œ <code>m</code> å’Œ <code>h</code> ã€‚</p> <h2 id="æŒ‡å®šå­—èŠ‚å€¼-ğŸ”—">æŒ‡å®šå­—èŠ‚å€¼ <a href="#specifying-byte-values">ğŸ”—</a></h2> <p>ä¸€äº›é…ç½®é€‰é¡¹ï¼ˆä¾‹å¦‚çš„ <code>shm_size</code> å­é€‰é¡¹ï¼‰ <a href="#build"><code>build</code></a> å°†å­—èŠ‚å€¼ä½œä¸ºå­—ç¬¦ä¸²æ¥å—ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>2b
1024kb
2048k
300m
1gb

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ”¯æŒçš„å•ä½æ˜¯ <code>b</code> ï¼Œ <code>k</code> ï¼Œ <code>m</code> å’Œ <code>g</code> ï¼Œå’Œå®ƒä»¬çš„æ›¿ä»£ç¬¦å· <code>kb</code> ï¼Œ <code>mb</code> å’Œ <code>gb</code> ã€‚ ç›®å‰ä¸æ”¯æŒåè¿›åˆ¶å€¼ã€‚</p> <h2 id="å·é…ç½®å‚è€ƒ-ğŸ”—">å·é…ç½®å‚è€ƒ <a href="#volume-configuration-reference">ğŸ”—</a></h2> <p>è™½ç„¶å¯ä»¥ç”³æŠ¥ <a href="#volumes">å·</a> ä¸Šé£ä½œä¸ºæœåŠ¡å£°æ˜çš„ä¸€éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†å…è®¸æ‚¨åˆ›å»ºå¯åœ¨å¤šä¸ªæœåŠ¡ä¸­é‡å¤ä½¿ç”¨ï¼ˆä¸ä¾èµ–äºä¸€ä¸ªåä¸ºå· <code>volumes_from</code> æˆ–ï¼‰ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“æ£€ç´¢å’Œä½¿ç”¨æ³Šåçª—å‘½ä»¤è¡Œæ¥å—è§†APIã€‚ æœ‰å…³ æ›´å¤šä¿¡æ¯ï¼Œ è¯·å‚é˜… <a href="https://docs.docker.com/engine/reference/commandline/volume_create/" target="_blank" rel="noopener noreferrer">docker volume<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å­å‘½ä»¤æ–‡æ¡£ã€‚</p> <p>æœ‰å…³ <a href="https://docs.docker.com/storage/volumes/" target="_blank" rel="noopener noreferrer">å·<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> çš„ä¸€èˆ¬ä¿¡æ¯ï¼Œ è¯·å‚è§ <a href="https://docs.docker.com/storage/volumes/" target="_blank" rel="noopener noreferrer">ä½¿ç”¨å·<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å’Œ <a href="https://docs.docker.com/engine/extend/plugins_volume/" target="_blank" rel="noopener noreferrer">å·æ’ä»¶<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <p>è¿™æ˜¯ä¸€ä¸ªä¸¤ç§æœåŠ¡è®¾ç½®çš„ç¤ºä¾‹ï¼Œå…¶ä¸­æ•°æ®åº“çš„æ•°æ®ç›®å½•ä¸å¦ä¸€ä¸ªæœåŠ¡ä½œä¸ºå·å…±äº«ï¼Œä»¥ä¾¿å¯ä»¥å®šæœŸå¤‡ä»½å®ƒï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;

services:
  db:
    image: db
    volumes:
      - data-volume:/var/lib/db
  backup:
    image: backup-service
    volumes:
      - data-volume:/var/lib/backup/data

volumes:
  data-volume:

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>é¡¶çº§ <code>volumes</code> é”® ä¸‹çš„æ¡ç›® å¯ä»¥ä¸ºç©ºï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨å¼•æ“é…ç½®çš„é»˜è®¤é©±åŠ¨ç¨‹åºï¼ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ <code>local</code> é©±åŠ¨ç¨‹åºï¼‰ã€‚ ï¼ˆå¯é€‰ï¼‰æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹é”®å¯¹å…¶è¿›è¡Œé…ç½®ï¼š</p> <h3 id="å¸æœº-ğŸ”—">å¸æœº <a href="#driver">ğŸ”—</a></h3> <p>æŒ‡å®šè¯¥å·åº”ä½¿ç”¨å“ªä¸ªå·é©±åŠ¨ç¨‹åºã€‚ é»˜è®¤ä¸ºDocker Engineé…ç½®ä¸ºä½¿ç”¨çš„ä»»ä½•é©±åŠ¨ç¨‹åºï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸º <code>local</code> ã€‚ å¦‚æœé©±åŠ¨ç¨‹åºä¸å¯ç”¨ï¼Œåˆ™å¼•æ“åœ¨ <code>docker-compose up</code> å°è¯•åˆ›å»ºå· æ—¶ä¼šè¿”å›é”™è¯¯ ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>driver: foobar

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="driver-opts-ğŸ”—">driver_opts <a href="#driver_opts">ğŸ”—</a></h3> <p>æŒ‡å®šé€‰é¡¹åˆ—è¡¨ä½œä¸ºé”®å€¼å¯¹ï¼Œä»¥ä¼ é€’ç»™è¯¥å·çš„é©±åŠ¨ç¨‹åºã€‚ è¿™äº›é€‰é¡¹å–å†³äºé©±åŠ¨ç¨‹åº-æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒé©±åŠ¨ç¨‹åºçš„æ–‡æ¡£ã€‚ å¯é€‰çš„ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>volumes:
  example:
    driver_opts:
      type: &quot;nfs&quot;
      o: &quot;addr=10.40.0.199,nolock,soft,rw&quot;
      device: &quot;:/docker/example&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="å¤–éƒ¨-ğŸ”—">å¤–éƒ¨ <a href="#external">ğŸ”—</a></h3> <p>å¦‚æœè®¾ç½®ä¸º <code>true</code> ï¼Œåˆ™æŒ‡å®šæ­¤å·æ˜¯åœ¨Composeä¹‹å¤–åˆ›å»ºçš„ã€‚ <code>docker-compose up</code> ä¸ä¼šå°è¯•åˆ›å»ºå®ƒï¼Œå¦‚æœä¸å­˜åœ¨åˆ™å¼•å‘é”™è¯¯ã€‚</p> <p>ä¸º3.3å’Œä¸‹é¢çš„æ ¼å¼çš„ç‰ˆæœ¬ï¼Œ <code>external</code> ä¸èƒ½åŒæ—¶ä½¿ç”¨ä¸å…¶å®ƒå·é…ç½®é”®ï¼ˆ <code>driver</code> ï¼Œ <code>driver_opts</code> ï¼Œ <code>labels</code> ï¼‰ã€‚ å¯¹äº <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-34" target="_blank" rel="noopener noreferrer">3.4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> åŠæ›´é«˜ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-34" target="_blank" rel="noopener noreferrer">ç‰ˆæœ¬ï¼Œ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ­¤é™åˆ¶ä¸å†å­˜åœ¨ ã€‚</p> <p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ <code>[projectname]_data</code> Compose ä¸ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªåä¸ºçš„å·ï¼Œè€Œæ˜¯ æŸ¥æ‰¾ä¸€ä¸ªç®€å•åœ°ç§°ä¸ºçš„ç°æœ‰å· <code>data</code> å¹¶å°†å…¶è£…å…¥ <code>db</code> æœåŠ¡çš„å®¹å™¨ä¸­ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;

services:
  db:
    image: postgres
    volumes:
      - data:/var/lib/postgresql/data

volumes:
  data:
    external: true

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>ä¸å»ºè®®ä½¿ç”¨ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-34" target="_blank" rel="noopener noreferrer">3.4ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ã€‚</p> <p>ä½¿ç”¨ç‰ˆæœ¬3.4æ–‡ä»¶æ ¼å¼å¼ƒç”¨äº†external.name <code>name</code> ã€‚</p></blockquote> <p>æ‚¨è¿˜å¯ä»¥ä¸åœ¨Composeæ–‡ä»¶ä¸­ç”¨äºå¼•ç”¨å·çš„åç§°åˆ†å¼€æŒ‡å®šå·çš„åç§°ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>volumes:
  data:
    external:
      name: actual-name-of-volume

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p>å¦‚æœæ‚¨ä½¿ç”¨ <a href="#deploy">docker stack deploy</a> ä»¥ <a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener noreferrer">ç¾¤ä½“æ¨¡å¼<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¯åŠ¨åº”ç”¨ç¨‹åº ï¼ˆè€Œä¸æ˜¯ <a href="https://docs.docker.com/compose/reference/up/" target="_blank" rel="noopener noreferrer">docker compose up<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ï¼‰ï¼Œ <em>åˆ™ä¼šåˆ›å»º</em> ä¸å­˜åœ¨çš„å¤–éƒ¨å· ã€‚ åœ¨ç¾¤æ¨¡å¼ä¸‹ï¼Œç”±æœåŠ¡å®šä¹‰å·åå°†è‡ªåŠ¨åˆ›å»ºè¯¥å·ã€‚ ç”±äºæœåŠ¡ä»»åŠ¡æ˜¯åœ¨æ–°èŠ‚ç‚¹ä¸Šå®‰æ’çš„ï¼Œå› æ­¤ <a href="https://github.com/docker/swarmkit/blob/master/README.md" target="_blank" rel="noopener noreferrer">swarmkit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> åœ¨æœ¬åœ°èŠ‚ç‚¹ä¸Šåˆ›å»ºå·ã€‚ è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ <a href="https://github.com/moby/moby/issues/29976" target="_blank" rel="noopener noreferrer">moby / mobyï¼ƒ29976<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚<a href="#deploy"></a><a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://docs.docker.com/compose/reference/up/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://github.com/docker/swarmkit/blob/master/README.md" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://github.com/moby/moby/issues/29976" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="æ ‡ç­¾-ğŸ”—-2">æ ‡ç­¾ <a href="#labels-3">ğŸ”—</a></h3> <p>ä½¿ç”¨ <a href="https://docs.docker.com/config/labels-custom-metadata/" target="_blank" rel="noopener noreferrer">Dockeræ ‡ç­¾<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å°†å…ƒæ•°æ®æ·»åŠ åˆ°å®¹å™¨ ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ã€‚</p> <p>å»ºè®®æ‚¨ä½¿ç”¨åå‘DNSè¡¨ç¤ºæ³•ï¼Œä»¥é˜²æ­¢æ ‡ç­¾ä¸å…¶ä»–è½¯ä»¶ä½¿ç”¨çš„æ ‡ç­¾å†²çªã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>labels:
  com.example.description: &quot;Database volume&quot;
  com.example.department: &quot;IT/Ops&quot;
  com.example.label-with-empty-value: &quot;&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>labels:
  - &quot;com.example.description=Database volume&quot;
  - &quot;com.example.department=IT/Ops&quot;
  - &quot;com.example.label-with-empty-value&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="å‘½å-ğŸ”—">å‘½å <a href="#name">ğŸ”—</a></h3> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-34" target="_blank" rel="noopener noreferrer">3.4ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p></blockquote> <p>ä¸ºæ­¤å·è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰åç§°ã€‚ åç§°å­—æ®µå¯ç”¨äºå¼•ç”¨åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å·ã€‚ è¯¥åç§°æŒ‰åŸæ ·ä½¿ç”¨ï¼Œ <strong>ä¸ä¼š</strong> ä¸å †æ ˆåç§°ä¸€èµ·ä½œç”¨åŸŸã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
volumes:
  data:
    name: my-app-data

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>å®ƒä¹Ÿå¯ä»¥ä¸ <code>external</code> å±æ€§ ä¸€èµ·ä½¿ç”¨ ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
volumes:
  data:
    external: true
    name: my-app-data

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="ç½‘ç»œé…ç½®å‚è€ƒ-ğŸ”—">ç½‘ç»œé…ç½®å‚è€ƒ <a href="#network-configuration-reference">ğŸ”—</a></h2> <p>é¡¶çº§ <code>networks</code> å¯†é’¥å¯è®©æ‚¨æŒ‡å®šè¦åˆ›å»ºçš„ç½‘ç»œã€‚</p> <ul><li>æœ‰å…³Composeä½¿ç”¨Dockerç½‘ç»œåŠŸèƒ½å’Œæ‰€æœ‰ç½‘ç»œé©±åŠ¨ç¨‹åºé€‰é¡¹çš„å®Œæ•´è¯´æ˜ï¼Œè¯·å‚é˜…ã€Š <a href="https://docs.docker.com/compose/networking/" target="_blank" rel="noopener noreferrer">ç½‘ç»œæŒ‡å—ã€‹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</li> <li>æœ‰å…³ ç½‘ç»œçš„ <a href="https://github.com/docker/labs/blob/master/README.md" target="_blank" rel="noopener noreferrer">Docker Labs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ•™ç¨‹ï¼Œè¯·ä» <a href="https://github.com/docker/labs/blob/master/networking/README.md" target="_blank" rel="noopener noreferrer">è®¾è®¡å¯æ‰©å±•çš„ä¾¿æºå¼Dockerå®¹å™¨ç½‘ç»œå¼€å§‹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="å¸æœº-ğŸ”—-2">å¸æœº <a href="#driver-1">ğŸ”—</a></h3> <p>æŒ‡å®šè¯¥ç½‘ç»œåº”ä½¿ç”¨å“ªä¸ªé©±åŠ¨ç¨‹åºã€‚</p> <p>é»˜è®¤é©±åŠ¨ç¨‹åºå–å†³äºæ‚¨ä½¿ç”¨çš„Dockerå¼•æ“çš„é…ç½®æ–¹å¼ï¼Œä½†æ˜¯åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒ <code>bridge</code> ä½äºå•ä¸ªä¸»æœºå’Œ <code>overlay</code> Swarmä¸Šã€‚</p> <p>å¦‚æœé©±åŠ¨ç¨‹åºä¸å¯ç”¨ï¼ŒDockerå¼•æ“å°†è¿”å›é”™è¯¯ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>driver: overlay

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="æ¡¥">æ¡¥</h4> <p>Dockeré»˜è®¤ <code>bridge</code> åœ¨å•ä¸ªä¸»æœºä¸Š ä½¿ç”¨ ç½‘ç»œã€‚ æœ‰å…³å¦‚ä½•ä½¿ç”¨ç½‘æ¡¥ç½‘ç»œçš„ç¤ºä¾‹ï¼Œè¯·å‚é˜…å…³äº <a href="https://github.com/docker/labs/blob/master/networking/A2-bridge-networking.md" target="_blank" rel="noopener noreferrer">ç½‘æ¡¥ç½‘ç»œ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> çš„Docker Labsæ•™ç¨‹ ã€‚</p> <h4 id="è¦†ç›–">è¦†ç›–</h4> <p>è¯¥ <code>overlay</code> é©±åŠ¨ç¨‹åºåˆ›å»ºä¸€ä¸ªè·¨å¤šä¸ªèŠ‚ç‚¹å‘½åçš„ç½‘ç»œ <a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener noreferrer">ç¾¤<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</p> <ul><li><p>æœ‰å…³å¦‚ä½•ä»¥ <code>overlay</code> ç¾¤é›†æ¨¡å¼ æ„å»ºå’Œä½¿ç”¨ å¸¦æœ‰æœåŠ¡ çš„ ç½‘ç»œ çš„æœ‰æ•ˆç¤ºä¾‹ ï¼Œè¯·å‚é˜…ã€Š <a href="https://github.com/docker/labs/blob/master/networking/A3-overlay-networking.md" target="_blank" rel="noopener noreferrer">è¦†ç›–ç½‘ç»œå’ŒæœåŠ¡å‘ç°ã€‹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> çš„Docker Labsæ•™ç¨‹ ã€‚</p></li> <li><p>æœ‰å…³æ·±å…¥äº†è§£å…¶å·¥ä½œåŸç†çš„ä¿¡æ¯ï¼Œè¯·å‚è§â€œ <a href="https://github.com/docker/labs/blob/master/networking/concepts/06-overlay-networks.md" target="_blank" rel="noopener noreferrer">è¦†ç›–é©±åŠ¨ç¨‹åºç½‘ç»œä½“ç³»ç»“æ„â€<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ä¸Šçš„ç½‘ç»œæ¦‚å¿µå®éªŒå®¤ ã€‚</p></li></ul> <h4 id="ä¸»æœºæˆ–æ— ">ä¸»æœºæˆ–æ— </h4> <p>ä½¿ç”¨ä¸»æœºçš„ç½‘ç»œå †æ ˆï¼Œæˆ–è€…ä¸ä½¿ç”¨ç½‘ç»œã€‚ ç­‰åŒäº <code>docker run --net=host</code> æˆ– <code>docker run --net=none</code> ã€‚ ä»…åœ¨ä½¿ç”¨ <code>docker stack</code> å‘½ä»¤æ—¶ ä½¿ç”¨ ã€‚ å¦‚æœä½¿ç”¨ <code>docker-compose</code> å‘½ä»¤ï¼Œè¯·æ”¹ç”¨ <a href="#network_mode">network_mode</a> ã€‚</p> <p>å¦‚æœè¦åœ¨é€šç”¨ç‰ˆæœ¬ä¸Šä½¿ç”¨ç‰¹å®šç½‘ç»œï¼Œè¯·ä½¿ç”¨ç¬¬äºŒä¸ªyamlæ–‡ä»¶ç¤ºä¾‹ä¸­æåˆ°çš„[network]ã€‚</p> <p>ä½¿ç”¨å†…ç½®ç½‘ç»œï¼ˆä¾‹å¦‚ <code>host</code> å’Œ <code>none</code> ï¼‰ çš„è¯­æ³• ç•¥æœ‰ä¸åŒã€‚ ä½¿ç”¨åç§° <code>host</code> æˆ– <code>none</code> ï¼ˆDockerå·²ç»è‡ªåŠ¨åˆ›å»ºçš„ï¼‰ å®šä¹‰ä¸€ä¸ªå¤–éƒ¨ç½‘ç»œï¼Œå¹¶å®šä¹‰ä¸€ä¸ª Composeå¯ä»¥ä½¿ç”¨çš„åˆ«åï¼ˆ <code>hostnet</code> æˆ– <code>nonet</code> åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼‰ï¼Œç„¶åä½¿ç”¨è¯¥åˆ«åå‘è¯¥ç½‘ç»œæˆäºˆæœåŠ¡è®¿é—®æƒé™ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
services:
  web:
    networks:
      hostnet: {}

networks:
  hostnet:
    external: true
    name: host

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>services:
  web:
    ...
    build:
      ...
      network: host
      context: .
      ...

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>services:
  web:
    ...
    networks:
      nonet: {}

networks:
  nonet:
    external: true
    name: none

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="driver-opts-ğŸ”—-2">driver_opts <a href="#driver_opts-1">ğŸ”—</a></h3> <p>æŒ‡å®šé€‰é¡¹åˆ—è¡¨ä½œä¸ºé”®å€¼å¯¹ï¼Œä»¥ä¼ é€’ç»™è¯¥ç½‘ç»œçš„é©±åŠ¨ç¨‹åºã€‚ è¿™äº›é€‰é¡¹å–å†³äºé©±åŠ¨ç¨‹åº-æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒé©±åŠ¨ç¨‹åºçš„æ–‡æ¡£ã€‚ å¯é€‰çš„ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>driver_opts:
  foo: &quot;bar&quot;
  baz: 1

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="é™„-ğŸ”—">é™„ <a href="#attachable">ğŸ”—</a></h3> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-32" target="_blank" rel="noopener noreferrer">3.2ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p></blockquote> <p>ä»…åœ¨å°† <code>driver</code> è®¾ç½® ä¸ºæ—¶ä½¿ç”¨ <code>overlay</code> ã€‚ å¦‚æœè®¾ç½®ä¸º <code>true</code> ï¼Œåˆ™é™¤äº†æœåŠ¡ä¹‹å¤–ï¼Œç‹¬ç«‹å®¹å™¨è¿˜å¯ä»¥è¿æ¥åˆ°è¯¥ç½‘ç»œã€‚ å¦‚æœç‹¬ç«‹å®¹å™¨è¿æ¥åˆ°è¦†ç›–ç½‘ç»œï¼Œåˆ™å®ƒå¯ä»¥ä¸ä¹Ÿä»å…¶ä»–Dockerå®ˆæŠ¤ç¨‹åºé™„åŠ åˆ°è¦†ç›–ç½‘ç»œçš„æœåŠ¡å’Œç‹¬ç«‹å®¹å™¨è¿›è¡Œé€šä¿¡ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>networks:
  mynet1:
    driver: overlay
    attachable: true

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="enable-ipv6-ğŸ”—">enable_ipv6 <a href="#enable_ipv6">ğŸ”—</a></h3> <p>åœ¨æ­¤ç½‘ç»œä¸Šå¯ç”¨IPv6ç½‘ç»œã€‚</p> <blockquote><p>æ’°å†™æ–‡ä»¶ç‰ˆæœ¬3ä¸æ”¯æŒ</p> <p><code>enable_ipv6</code> è¦æ±‚æ‚¨ä½¿ç”¨ç‰ˆæœ¬2çš„Composeæ–‡ä»¶ï¼Œå› ä¸ºSwarmæ¨¡å¼å°šä¸æ”¯æŒæ­¤æŒ‡ä»¤ã€‚</p></blockquote> <h3 id="ä¼Šå¸•å§†-ğŸ”—">ä¼Šå¸•å§† <a href="#ipam">ğŸ”—</a></h3> <p>æŒ‡å®šè‡ªå®šä¹‰IPAMé…ç½®ã€‚ è¿™æ˜¯ä¸€ä¸ªå…·æœ‰å¤šä¸ªå±æ€§çš„å¯¹è±¡ï¼Œæ¯ä¸ªå±æ€§éƒ½æ˜¯å¯é€‰çš„ï¼š</p> <ul><li><code>driver</code> ï¼šè‡ªå®šä¹‰IPAMé©±åŠ¨ç¨‹åºï¼Œè€Œä¸æ˜¯é»˜è®¤é©±åŠ¨ç¨‹åºã€‚</li> <li><code>config</code> ï¼šå…·æœ‰é›¶ä¸ªæˆ–å¤šä¸ªé…ç½®å—çš„åˆ—è¡¨ï¼Œæ¯ä¸ªé…ç½®å—åŒ…å«ä»¥ä¸‹ä»»ä¸€é”®ï¼š
<ul><li><code>subnet</code> ï¼šCIDRæ ¼å¼çš„å­ç½‘è¡¨ç¤ºä¸€ä¸ªç½‘æ®µ</li></ul></li></ul> <p>ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ipam:
  driver: default
  config:
    - subnet: 172.28.0.0/16

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p><strong>æ³¨æ„</strong></p> <p><code>gateway</code> ç›®å‰ä»…æ”¯æŒç‰ˆæœ¬2 ç­‰å…¶ä»–IPAMé…ç½® ã€‚</p></blockquote> <h3 id="å†…éƒ¨-ğŸ”—">å†…éƒ¨ <a href="#internal">ğŸ”—</a></h3> <p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDockerè¿˜å°†æ¡¥æ¥ç½‘ç»œè¿æ¥åˆ°å®ƒä»¥æä¾›å¤–éƒ¨è¿æ¥ã€‚ å¦‚æœè¦åˆ›å»ºå¤–éƒ¨éš”ç¦»çš„è¦†ç›–ç½‘ç»œï¼Œå¯ä»¥å°†æ­¤é€‰é¡¹è®¾ç½®ä¸º <code>true</code> ã€‚</p> <h3 id="æ ‡ç­¾-ğŸ”—-3">æ ‡ç­¾ <a href="#labels-4">ğŸ”—</a></h3> <p>ä½¿ç”¨ <a href="https://docs.docker.com/config/labels-custom-metadata/" target="_blank" rel="noopener noreferrer">Dockeræ ‡ç­¾<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å°†å…ƒæ•°æ®æ·»åŠ åˆ°å®¹å™¨ ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ã€‚</p> <p>å»ºè®®æ‚¨ä½¿ç”¨åå‘DNSè¡¨ç¤ºæ³•ï¼Œä»¥é˜²æ­¢æ ‡ç­¾ä¸å…¶ä»–è½¯ä»¶ä½¿ç”¨çš„æ ‡ç­¾å†²çªã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>labels:
  com.example.description: &quot;Financial transaction network&quot;
  com.example.department: &quot;Finance&quot;
  com.example.label-with-empty-value: &quot;&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>labels:
  - &quot;com.example.description=Financial transaction network&quot;
  - &quot;com.example.department=Finance&quot;
  - &quot;com.example.label-with-empty-value&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="å¤–éƒ¨-ğŸ”—-2">å¤–éƒ¨ <a href="#external-1">ğŸ”—</a></h3> <p>å¦‚æœè®¾ç½®ä¸º <code>true</code> ï¼Œåˆ™æŒ‡å®šæ­¤ç½‘ç»œæ˜¯åœ¨Composeä¹‹å¤–åˆ›å»ºçš„ã€‚ <code>docker-compose up</code> ä¸ä¼šå°è¯•åˆ›å»ºå®ƒï¼Œå¦‚æœä¸å­˜åœ¨åˆ™å¼•å‘é”™è¯¯ã€‚</p> <p>ä¸º3.3å’Œä¸‹é¢çš„æ ¼å¼çš„ç‰ˆæœ¬ï¼Œ <code>external</code> ä¸èƒ½åŒæ—¶ä½¿ç”¨ä¸å…¶ä»–ç½‘ç»œé…ç½®é”®ï¼ˆ <code>driver</code> ï¼Œ <code>driver_opts</code> ï¼Œ <code>ipam</code> ï¼Œ <code>internal</code> ï¼‰ã€‚ å¯¹äº <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-34" target="_blank" rel="noopener noreferrer">3.4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> åŠæ›´é«˜ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-34" target="_blank" rel="noopener noreferrer">ç‰ˆæœ¬ï¼Œ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ­¤é™åˆ¶ä¸å†å­˜åœ¨ ã€‚</p> <p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ <code>proxy</code> æ˜¯é€šå¾€å¤–ç•Œçš„é—¨æˆ·ã€‚ <code>[projectname]_outside</code> Compose ä¸ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªåä¸ºçš„ç½‘ç»œ ï¼Œ è€Œæ˜¯ å¯»æ‰¾ä¸€ä¸ªç®€å•ç§°ä¸ºçš„ç°æœ‰ç½‘ç»œ <code>outside</code> ï¼Œå¹¶å°† <code>proxy</code> æœåŠ¡çš„å®¹å™¨ è¿æ¥ åˆ°è¯¥ç½‘ç»œã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;

services:
  proxy:
    build: ./proxy
    networks:
      - outside
      - default
  app:
    build: ./app
    networks:
      - default

networks:
  outside:
    external: true

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><p>ä¸å»ºè®®ä½¿ç”¨ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-35" target="_blank" rel="noopener noreferrer">3.5ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ã€‚</p> <p>ä½¿ç”¨ç‰ˆæœ¬3.5æ–‡ä»¶æ ¼å¼å¼ƒç”¨äº†external.name <code>name</code> ã€‚</p></blockquote> <p>æ‚¨è¿˜å¯ä»¥åœ¨Composeæ–‡ä»¶ä¸­æŒ‡å®šç½‘ç»œåç§°ï¼Œè€Œä¸æ˜¯ç”¨æ¥å¼•ç”¨ç½‘ç»œçš„åç§°ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
networks:
  outside:
    external:
      name: actual-name-of-network

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="å‘½å-ğŸ”—-2">å‘½å <a href="#name-1">ğŸ”—</a></h3> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-35" target="_blank" rel="noopener noreferrer">ç‰ˆæœ¬3.5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p></blockquote> <p>ä¸ºæ­¤ç½‘ç»œè®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰åç§°ã€‚ åç§°å­—æ®µå¯ç”¨äºå¼•ç”¨åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„ç½‘ç»œã€‚ è¯¥åç§°æŒ‰åŸæ ·ä½¿ç”¨ï¼Œ <strong>ä¸ä¼š</strong> ä¸å †æ ˆåç§°ä¸€èµ·ä½œç”¨åŸŸã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
networks:
  network1:
    name: my-app-net

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>å®ƒä¹Ÿå¯ä»¥ä¸ <code>external</code> å±æ€§ ä¸€èµ·ä½¿ç”¨ ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: &quot;3.8&quot;
networks:
  network1:
    external: true
    name: my-app-net

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="configsé…ç½®å‚è€ƒ-ğŸ”—">configsé…ç½®å‚è€ƒ <a href="#configs-configuration-reference">ğŸ”—</a></h2> <p>é¡¶çº§ <code>configs</code> å£°æ˜å®šä¹‰æˆ–å¼•ç”¨ å¯ä»¥æˆäºˆæ­¤å †æ ˆä¸­çš„æœåŠ¡çš„ <a href="https://docs.docker.com/engine/swarm/configs/" target="_blank" rel="noopener noreferrer">é…ç½®<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚ é…ç½®çš„æ¥æºæ˜¯ <code>file</code> æˆ– <code>external</code> ã€‚</p> <ul><li><code>file</code> ï¼šä½¿ç”¨æŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å†…å®¹åˆ›å»ºé…ç½®ã€‚</li> <li><code>external</code> ï¼šå¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™æŒ‡å®šæ­¤é…ç½®å·²åˆ›å»ºã€‚ Dockerä¸ä¼šå°è¯•åˆ›å»ºå®ƒï¼Œå¦‚æœå®ƒä¸å­˜åœ¨ï¼Œ <code>config not found</code> åˆ™ä¼šå‘ç”Ÿé”™è¯¯ã€‚</li> <li><code>name</code> ï¼šDockerä¸­é…ç½®å¯¹è±¡çš„åç§°ã€‚ æ­¤å­—æ®µå¯ç”¨äºå¼•ç”¨åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„é…ç½®ã€‚ è¯¥åç§°æŒ‰åŸæ ·ä½¿ç”¨ï¼Œ <strong>ä¸ä¼š</strong> ä¸å †æ ˆåç§°ä¸€èµ·ä½œç”¨åŸŸã€‚ ä»¥3.5ç‰ˆæ–‡ä»¶æ ¼å¼å¼•å…¥ã€‚</li> <li><code>driver</code> å’Œ <code>driver_opts</code> ï¼šè‡ªå®šä¹‰ç§˜å¯†é©±åŠ¨ç¨‹åºçš„åç§°ï¼Œä»¥åŠä½œä¸ºé”®/å€¼å¯¹ä¼ é€’çš„ç‰¹å®šäºé©±åŠ¨ç¨‹åºçš„é€‰é¡¹ã€‚ ä»¥3.8ç‰ˆæ–‡ä»¶æ ¼å¼å¼•å…¥ï¼Œä»…åœ¨ä½¿ç”¨æ—¶å—æ”¯æŒ <code>docker stack</code> ã€‚</li> <li><code>template_driver</code> ï¼šè¦ä½¿ç”¨çš„æ¨¡æ¿é©±åŠ¨ç¨‹åºçš„åç§°ï¼Œå®ƒæ§åˆ¶æ˜¯å¦ä»¥åŠå¦‚ä½•å°†ç§˜å¯†æœ‰æ•ˆè´Ÿè½½è¯„ä¼°ä¸ºæ¨¡æ¿ã€‚ å¦‚æœæœªè®¾ç½®é©±åŠ¨ç¨‹åºï¼Œåˆ™ä¸ä½¿ç”¨ä»»ä½•æ¨¡æ¿ã€‚ å½“å‰æ”¯æŒçš„å”¯ä¸€é©±åŠ¨ç¨‹åºæ˜¯ <code>golang</code> ï¼Œå®ƒä½¿ç”¨ <code>golang</code> ã€‚ ä»¥3.8ç‰ˆæ–‡ä»¶æ ¼å¼å¼•å…¥ï¼Œä»…åœ¨ä½¿ç”¨æ—¶å—æ”¯æŒ <code>docker stack</code> ã€‚ æœ‰å…³ <a href="https://docs.docker.com/engine/swarm/configs/#example-use-a-templated-config" target="_blank" rel="noopener noreferrer">æ¨¡æ¿åŒ–é…ç½®<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> çš„ç¤ºä¾‹ï¼Œ è¯·å‚é˜… <a href="https://docs.docker.com/engine/swarm/configs/#example-use-a-templated-config" target="_blank" rel="noopener noreferrer">ä½¿ç”¨<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ¨¡æ¿åŒ–é…ç½®ã€‚</li></ul> <p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ <code>my_first_config</code> åˆ›å»ºäº†ï¼ˆå°±åƒ <code>&lt;stack_name&gt;_my_first_config)</code> éƒ¨ç½²å †æ ˆæ—¶ä¸€æ ·ï¼Œå¹¶ä¸” <code>my_second_config</code> å·²ç»å­˜åœ¨äºDockerä¸­ã€‚ï¼‰</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>configs:
  my_first_config:
    file: ./config_data
  my_second_config:
    external: true

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å¤–éƒ¨é…ç½®çš„å¦ä¸€ä¸ªå˜ä½“æ˜¯Dockerä¸­çš„é…ç½®åç§°ä¸æœåŠ¡ä¸­å­˜åœ¨çš„åç§°ä¸åŒæ—¶ã€‚ ä»¥ä¸‹ç¤ºä¾‹ä¿®æ”¹äº†å‰ä¸€ä¸ªç¤ºä¾‹ï¼Œä»¥ä½¿ç”¨åä¸ºçš„å¤–éƒ¨é…ç½® <code>redis_config</code> ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>configs:
  my_first_config:
    file: ./config_data
  my_second_config:
    external:
      name: redis_config

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æ‚¨ä»ç„¶éœ€è¦ <a href="#configs">å°†é…ç½®è®¿é—®æƒé™æˆäºˆ</a> å †æ ˆä¸­çš„æ¯ä¸ªæœåŠ¡ã€‚</p> <h2 id="æœºå¯†é…ç½®å‚è€ƒ-ğŸ”—">æœºå¯†é…ç½®å‚è€ƒ <a href="#secrets-configuration-reference">ğŸ”—</a></h2> <p>é¡¶çº§ <code>secrets</code> å£°æ˜å®šä¹‰æˆ–å¼•ç”¨ å¯ä»¥æˆäºˆæ­¤å †æ ˆä¸­çš„æœåŠ¡çš„ <a href="https://docs.docker.com/engine/swarm/secrets/" target="_blank" rel="noopener noreferrer">æœºå¯†<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚ ç§˜å¯†çš„æ¥æºæ˜¯ <code>file</code> æˆ– <code>external</code> ã€‚</p> <ul><li><code>file</code> ï¼šç§˜å¯†æ˜¯ä½¿ç”¨æŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å†…å®¹åˆ›å»ºçš„ã€‚</li> <li><code>external</code> ï¼šå¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™æŒ‡å®šæ­¤ç§˜å¯†å·²ç»åˆ›å»ºã€‚ Dockerä¸ä¼šå°è¯•åˆ›å»ºå®ƒï¼Œå¦‚æœå®ƒä¸å­˜åœ¨ï¼Œ <code>secret not found</code> åˆ™ä¼šå‘ç”Ÿé”™è¯¯ã€‚</li> <li><code>name</code> ï¼šDockerä¸­ç§˜å¯†å¯¹è±¡çš„åç§°ã€‚ æ­¤å­—æ®µå¯ç”¨äºå¼•ç”¨åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æœºå¯†ã€‚ è¯¥åç§°æŒ‰åŸæ ·ä½¿ç”¨ï¼Œ <strong>ä¸ä¼š</strong> ä¸å †æ ˆåç§°ä¸€èµ·ä½œç”¨åŸŸã€‚ ä»¥3.5ç‰ˆæ–‡ä»¶æ ¼å¼å¼•å…¥ã€‚</li> <li><code>template_driver</code> ï¼šè¦ä½¿ç”¨çš„æ¨¡æ¿é©±åŠ¨ç¨‹åºçš„åç§°ï¼Œå®ƒæ§åˆ¶æ˜¯å¦ä»¥åŠå¦‚ä½•å°†ç§˜å¯†æœ‰æ•ˆè´Ÿè½½è¯„ä¼°ä¸ºæ¨¡æ¿ã€‚ å¦‚æœæœªè®¾ç½®é©±åŠ¨ç¨‹åºï¼Œåˆ™ä¸ä½¿ç”¨ä»»ä½•æ¨¡æ¿ã€‚ å½“å‰æ”¯æŒçš„å”¯ä¸€é©±åŠ¨ç¨‹åºæ˜¯ <code>golang</code> ï¼Œå®ƒä½¿ç”¨ <code>golang</code> ã€‚ ä»¥3.8ç‰ˆæ–‡ä»¶æ ¼å¼å¼•å…¥ï¼Œä»…åœ¨ä½¿ç”¨æ—¶å—æ”¯æŒ <code>docker stack</code> ã€‚</li></ul> <p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ <code>my_first_secret</code> åˆ›å»º <code>&lt;stack_name&gt;_my_first_secret</code> æ—¶æ˜¯åœ¨éƒ¨ç½²å †æ ˆæ—¶ åˆ›å»ºçš„ ï¼Œå¹¶ä¸” <code>my_second_secret</code> å·²ç»å­˜åœ¨äºDockerä¸­ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>secrets:
  my_first_secret:
    file: ./secret_data
  my_second_secret:
    external: true

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å¤–éƒ¨æœºå¯†çš„å¦ä¸€ä¸ªå˜ä½“æ˜¯Dockerä¸­çš„æœºå¯†åç§°ä¸æœåŠ¡ä¸­å­˜åœ¨çš„åç§°ä¸åŒæ—¶ã€‚ ä»¥ä¸‹ç¤ºä¾‹ä¿®æ”¹äº†å‰ä¸€ä¸ªç¤ºä¾‹ï¼Œä»¥ä½¿ç”¨åä¸ºçš„å¤–éƒ¨æœºå¯† <code>redis_secret</code> ã€‚</p> <h3 id="æ’°å†™æ–‡ä»¶v3-5åŠæ›´é«˜ç‰ˆæœ¬-ğŸ”—">æ’°å†™æ–‡ä»¶v3.5åŠæ›´é«˜ç‰ˆæœ¬ <a href="#compose-file-v35-and-above">ğŸ”—</a></h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>secrets:
  my_first_secret:
    file: ./secret_data
  my_second_secret:
    external: true
    name: redis_secret

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="æ’°å†™æ–‡ä»¶v3-4å’Œ-ğŸ”—ä¸‹">æ’°å†™æ–‡ä»¶v3.4å’Œ <a href="#compose-file-v34-and-under">ğŸ”—ä¸‹</a></h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>  my_second_secret:
    external:
      name: redis_secret

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>æ‚¨ä»ç„¶éœ€è¦å‘ å †æ ˆä¸­çš„æ¯ä¸ªæœåŠ¡ <a href="#secrets">æˆäºˆå¯¹æœºå¯†çš„è®¿é—®æƒé™</a> ã€‚</p> <h2 id="å˜é‡æ›¿ä»£-ğŸ”—">å˜é‡æ›¿ä»£ <a href="#variable-substitution">ğŸ”—</a></h2> <p>æ‚¨çš„é…ç½®é€‰é¡¹å¯ä»¥åŒ…å«ç¯å¢ƒå˜é‡ã€‚ Composeä½¿ç”¨ <code>docker-compose</code> è¿è¡Œæ—¶æ‰€åœ¨ çš„Shellç¯å¢ƒä¸­çš„å˜é‡å€¼ ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾å¤–å£³åŒ…å« <code>POSTGRES_VERSION=9.3</code> å¹¶æä¾›ä»¥ä¸‹é…ç½®ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>db:
  image: &quot;postgres:${POSTGRES_VERSION}&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å½“æ‚¨è¿è¡Œ <code>docker-compose up</code> æ­¤é…ç½®ï¼Œæ’°å†™å¤–è§‚ä¸º <code>POSTGRES_VERSION</code> åœ¨å¤–å£³å’Œæ›¿ä»£å®ƒçš„ä»·å€¼çš„ç¯å¢ƒå˜é‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ’°å†™è§£æ <code>image</code> åˆ° <code>postgres:9.3</code> è¿è¡Œé…ç½®ä¹‹å‰ã€‚</p> <p>å¦‚æœæœªè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œåˆ™Composeæ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²ã€‚ åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå¦‚æœ <code>POSTGRES_VERSION</code> æœªè®¾ç½®ï¼Œåˆ™ <code>image</code> é€‰é¡¹çš„å€¼ä¸º <code>postgres:</code> ã€‚</p> <p>æ‚¨å¯ä»¥ä½¿ç”¨ Composeè‡ªåŠ¨æŸ¥æ‰¾ çš„ <a href="https://docs.docker.com/compose/env-file/" target="_blank" rel="noopener noreferrer"><code>.env</code>æ–‡ä»¶<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ä¸ºç¯å¢ƒå˜é‡è®¾ç½®é»˜è®¤å€¼ ã€‚ åœ¨shellç¯å¢ƒä¸­è®¾ç½®çš„å€¼å°†è¦†ç›– <code>.env</code> æ–‡ä»¶ä¸­ è®¾ç½®çš„å€¼ ã€‚</p> <blockquote><p>ä½¿ç”¨docker stack deployæ—¶çš„æ³¨æ„äº‹é¡¹</p> <p>è¯¥ <code>.env file</code> åŠŸèƒ½ä»…åœ¨ä½¿ç”¨ <code>docker-compose up</code> å‘½ä»¤æ—¶æœ‰æ•ˆï¼Œè€Œä¸é€‚ç”¨äº <code>docker stack deploy</code> ã€‚</p></blockquote> <p>è¿™ä¸¤ä¸ª <code>$VARIABLE</code> å’Œ <code>${VARIABLE}</code> è¯­æ³•çš„æ”¯æŒã€‚ æ­¤å¤–ï¼Œå½“ä½¿ç”¨ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-21" target="_blank" rel="noopener noreferrer">2.1æ–‡ä»¶æ ¼å¼æ—¶<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ï¼Œå¯ä»¥ä½¿ç”¨å…¸å‹çš„shellè¯­æ³•æä¾›å†…è”é»˜è®¤å€¼ï¼š</p> <ul><li><code>${VARIABLE:-default}</code> è®¡ç®—ç¯å¢ƒä¸­ <code>default</code> æ˜¯å¦ <code>VARIABLE</code> æœªè®¾ç½®æˆ–ä¸ºç©ºã€‚</li> <li><code>${VARIABLE-default}</code> <code>default</code> ä»… <code>VARIABLE</code> åœ¨ç¯å¢ƒä¸­æœªè®¾ç½®æ—¶ è¯„ä¼°ä¸º ã€‚</li></ul> <p>åŒæ ·ï¼Œä»¥ä¸‹è¯­æ³•å…è®¸æ‚¨æŒ‡å®šå¿…éœ€å˜é‡ï¼š</p> <ul><li><code>${VARIABLE:?err}</code> é€€å‡ºï¼Œå¹¶æ˜¾ç¤ºä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å« åœ¨ç¯å¢ƒ ä¸­ <code>err</code> æ˜¯å¦ <code>VARIABLE</code> è®¾ç½®ä¸º if æˆ–ä¸ºç©ºã€‚</li> <li><code>${VARIABLE?err}</code> é€€å‡ºï¼Œå¹¶æ˜¾ç¤ºä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å« åœ¨ç¯å¢ƒä¸­æœªè®¾ç½®çš„ <code>err</code> if <code>VARIABLE</code> ã€‚</li></ul> <p><code>${VARIABLE/foo/bar}</code> ä¸æ”¯æŒ å…¶ä»–æ‰©å±•çš„Shellæ ·å¼åŠŸèƒ½ï¼Œä¾‹å¦‚ ã€‚</p> <p><code>$$</code> å½“æ‚¨çš„é…ç½®éœ€è¦æ–‡å­—ç¾å…ƒç¬¦å·æ—¶ï¼Œ å¯ä»¥ä½¿ç”¨ ï¼ˆåŒç¾å…ƒç¬¦å·ï¼‰ã€‚ è¿™ä¹Ÿå¯ä»¥é˜²æ­¢Composeæ’å€¼ï¼Œå› æ­¤a <code>$$</code> å…è®¸æ‚¨å¼•ç”¨æ‚¨ä¸æƒ³ç”±Composeå¤„ç†çš„ç¯å¢ƒå˜é‡ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>web:
  build: .
  command: &quot;$$VAR_NOT_INTERPOLATED_BY_COMPOSE&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>å¦‚æœå¿˜è®°å¹¶ä½¿ç”¨å•ä¸ªç¾å…ƒç¬¦å·ï¼ˆ <code>$</code> ï¼‰ï¼Œåˆ™Composeä¼šå°†å€¼è§£é‡Šä¸ºç¯å¢ƒå˜é‡ï¼Œå¹¶è­¦å‘Šæ‚¨ï¼š</p> <p>æœªè®¾ç½®VAR_NOT_INTERPOLATED_BY_COMPOSEã€‚ æ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</p> <h2 id="æ‰©å±•å­—æ®µ-ğŸ”—">æ‰©å±•å­—æ®µ <a href="#extension-fields">ğŸ”—</a></h2> <blockquote><p>ä»¥ <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-34" target="_blank" rel="noopener noreferrer">3.4ç‰ˆ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ–‡ä»¶æ ¼å¼ æ·»åŠ  ã€‚</p></blockquote> <p>å¯ä»¥ä½¿ç”¨æ‰©å±•å­—æ®µé‡æ–°ä½¿ç”¨é…ç½®ç‰‡æ®µã€‚ è¿™äº›ç‰¹æ®Šå­—æ®µå¯ä»¥ä½äºä»»æ„æ ¼å¼ï¼Œåªè¦å®ƒä»¬ä½äºComposeæ–‡ä»¶çš„æ ¹ç›®å½•ä¸­å¹¶ä¸”å…¶åç§°ä»¥ <code>x-</code> å­—ç¬¦åºåˆ— å¼€å¤´å³å¯ ã€‚</p> <blockquote><p><strong>æ³¨æ„</strong></p> <p>ä»3.7æ ¼å¼ï¼ˆå¯¹äº3.xç³»åˆ—ï¼‰å’Œ2.4æ ¼å¼ï¼ˆå¯¹äº2.xç³»åˆ—ï¼‰å¼€å§‹ï¼Œæ‰©å±•å­—æ®µä¹Ÿå¯ä»¥åœ¨æœåŠ¡ï¼Œå·ï¼Œç½‘ç»œï¼Œé…ç½®å’Œå¯†ç å®šä¹‰çš„æ ¹ç›®å½•ä¸­ä½¿ç”¨ã€‚</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.4'
x-custom:
  items:
    - a
    - b
  options:
    max-size: '12m'
  name: &quot;custom&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>è¿™äº›å­—æ®µçš„å†…å®¹è¢«Composeå¿½ç•¥ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ <a href="http://www.yaml.org/spec/1.2/spec.html#id2765878" target="_blank" rel="noopener noreferrer">YAMLé”šç‚¹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å°†å…¶æ’å…¥èµ„æºå®šä¹‰ä¸­ ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å¸Œæœ›å¤šä¸ªæœåŠ¡ä½¿ç”¨ç›¸åŒçš„æ—¥å¿—è®°å½•é…ç½®ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>logging:
  options:
    max-size: '12m'
    max-file: '5'
  driver: json-file

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼ç¼–å†™Composeæ–‡ä»¶ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.4'
x-logging:
  &amp;default-logging
  options:
    max-size: '12m'
    max-file: '5'
  driver: json-file

services:
  web:
    image: myapp/web:latest
    logging: *default-logging
  db:
    image: mysql:latest
    logging: *default-logging

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <a href="http://yaml.org/type/merge.html" target="_blank" rel="noopener noreferrer">YAMLåˆå¹¶ç±»å‹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> éƒ¨åˆ†è¦†ç›–æ‰©å±•å­—æ®µä¸­çš„å€¼ ã€‚ ä¾‹å¦‚ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.4'
x-volumes:
  &amp;default-volume
  driver: foobar-storage

services:
  web:
    image: myapp/web:latest
    volumes: [&quot;vol1&quot;, &quot;vol2&quot;, &quot;vol3&quot;]
volumes:
  vol1: *default-volume
  vol2:
    &lt;&lt; : *default-volume
    name: volume02
  vol3:
    &lt;&lt; : *default-volume
    driver: default
    name: volume-local

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="æ’°å†™æ–‡æ¡£-ğŸ”—">æ’°å†™æ–‡æ¡£ <a href="#compose-documentation">ğŸ”—</a></h2> <ul><li><a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreferrer">ç”¨æˆ·æŒ‡å—<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener noreferrer">å®‰è£…æ’°å†™<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.docker.com/compose/compose-file/compose-versioning/" target="_blank" rel="noopener noreferrer">æ’°å†™æ–‡ä»¶ç‰ˆæœ¬å’Œå‡çº§<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.docker.com/samples/" target="_blank" rel="noopener noreferrer">æ ·å“<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.docker.com/compose/reference/" target="_blank" rel="noopener noreferrer">å‘½ä»¤è¡Œå‚è€ƒ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/solider245/VuePress-blog/edit/gh-pages/docs/æ–‡ç« è½¬è½½/docker/docker-Composeå®˜æ–¹æ•™ç¨‹.md" target="_blank" rel="noopener noreferrer">ä½ è¦æ•™æˆ‘åšäº‹å’¯ï¼Ÿ</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">8/2/2020, 10:00:39 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/Ubuntu å®‰è£… Docker CE.html" class="prev">
        Ubuntu å®‰è£… Docker CE
      </a></span> <span class="next"><a href="/VuePress-blog/æ–‡ç« è½¬è½½/docker/dockerè¿è¡Œshellè„šæœ¬é—®é¢˜.html">
        dockerè¿è¡Œshellè„šæœ¬é—®é¢˜
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/VuePress-blog/assets/js/app.e4354aa1.js" defer></script><script src="/VuePress-blog/assets/js/2.398f4283.js" defer></script><script src="/VuePress-blog/assets/js/152.3c509f41.js" defer></script>
  </body>
</html>
